<!DOCTYPE html>
<html>
	<head lang="cn">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0 minimal-ui">
		<meta name="screen-orientation" content="portrait">
		<meta name="full-screen" content="yes">
		<meta name="browsermode" content="application">
		<meta name="x5-orientation" content="portrait">
		<meta name="x5-fullscreen" content="true">
		<meta name="x5-page-mode" content="app">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="green">
		<meta name="Keywords" content="亚洲旅行网">
		<meta name="Description" content="境外专业旅行服务提供机构">
		<title>订单填写</title>
		<link href="../styles/framework.css" rel="stylesheet" />
		<link href="../styles/style.css" rel="stylesheet" />
		<link href="../styles/tips.css" rel="stylesheet" />
		<link href="css/order.css" rel="stylesheet" />
	</head>
	<body>
		<div id="preloader">
			<div id="status-h">
				<p class="center-text"></p>
			</div>
		</div>
		<div class="header" id="vlm-login">
			<a href="javascript:;" class="header-back" id="uo_back">
                <i class="icons go-back"></i>
            </a>
			<h3>订单填写</h3>
		</div>
		<div class="all-elements input-relative">
			<div class = "container1">
				<div class="order-bg order-plane">
					<!--<ul>-->
						<!--<li class = "order-lis1">-->
							<!--<span class="order-lis1-l">-->
								<!--<i></i>-->
								<!--<span>机票</span>-->
							<!--</span>-->
							<!--<span class="order-lis1-r">-->
								<!--<span>详情</span>-->
								<!--<i></i>-->
							<!--</span>-->
						<!--</li>-->
						<!--<li class = "order-lis2">-->
							<!--<span class="order-lis2-l">-->
								<!--<i></i>-->
								<!--<span class = "order-ml">01-08</span>-->
								<!--<span>周二</span>-->
								<!--<span>浦东T2-洛杉矶</span>-->
							<!--</span>-->
							<!--<span class="order-lis2-r">-->
								<!--<i></i>-->
								<!--<span>11h30m</span>-->
							<!--</span>-->
						<!--</li>-->
						<!--<li class = "order-lis3">-->
							<!--<span class="order-lis3-l">-->
								<!--<i></i>-->
								<!--<span class = "order-ml">01-08</span>-->
								<!--<span>周二</span>-->
								<!--<span>洛杉矶-浦东</span>-->
							<!--</span>-->
							<!--<span class="order-lis3-r">-->
								<!--<i></i>-->
								<!--<span>11h30m</span>-->
							<!--</span>-->
						<!--</li>-->
						<!--<li class = "order-lis4">-->
							<!--<span>-->
								<!--头等舱+往返舱-->
							<!--</span>-->
						<!--</li>-->
					<!--</ul>-->
				</div>
				<div class="order-bg order-hotel">
					<!--<ul>-->
						<!--<li class = "order-hlist1">-->
							<!--<i></i>-->
							<!--<span>酒店</span>-->
						<!--</li>-->
						<!--<li class = "order-hlist2">东京东急涩卓越大酒店</li>-->
						<!--<li class = "order-hlist3">-->
							<!--<span>11月25日-11月26日</span>-->
							<!--<span>共1晚（当地时间为准）</span>-->
						<!--</li>-->
						<!--<li class = "order-hlist4">-->
							<!--<span>房型：经济大床房</span>-->
							<!--<span>房间数：2间</span>-->
						<!--</li>-->
					<!--</ul>-->
				</div>
				<div class="order-bg order-trip">
					<ul>
						<li class = "order-tlist1">
							<span class = "order-tsl1">出行人</span>
							<span class = "order-tsl3">添加出行人</span>
							<span class = "order-tsl2">1/2成人 0/2儿童</span>
						</li>
						<li class = "order-tlist2">
							<i class="tra-delete"></i>
							<div>
								<span>姓/名  BAI/LISA</span>
								<span>护照   12345678910   女</span>
							</div>
							<em></em>
						</li>
					</ul>
				</div>
				<div class="order-bg order-link">
					<ul>
						<li class = "order-llist1">
							<span>联系人</span>
							<em class="con-alike"></em>
							<span class="contact-same">与第一出行人相同</span>
							<i class="hfcont-tip"></i>
						</li>
						<li class = "order-llist2">
							<input type="text"placeholder="姓（如：Zhang）" class="hf_con_lastname"/>
							<span class="order-line"></span>
							<input type="text"placeholder="名（如：Wei）" class="hf_con_firstname"/>
						</li>
						<li class = "order-llist3">
							<span class = "order-ls">
								<span class="order-ls-cell">手机号</span>
								<div class="p_86 tel-btn">
									<span>+86</span>
									<i></i>
								</div>
							</span>
							<span class="order-line"></span>
							<input type="text" placeholder="用于接收通知" class="hf_con_cell"/>
						</li>
						<li class = "order-llist4">
							<span class="fl">E-mail</span>
							<input class="hf_con_email" type="text" placeholder="用于接收通知"/>
						</li>
					</ul>
				</div>
			</div>
			<div class="order-footer">
				<div class="order-num" >
					<span class = "num1">订单总额: </span><span class="card1">￥7816</span>
				</div>
				<p class="order-detail">
					<span class="">明细</span><i class="detail-fale"></i>
				</p>
				<input type="button" value="预定" class = "order-submit"/>
			</div>
		</div>
		<!--   明细块   -->
		<div class="hf_det_mask"></div>
		<div class="hf_detail_fare">
			<p>成人费用 x <span>2</span> <span> ￥1134</span></p>
			<p>儿童费用 x <span>2</span> <span> ￥1134</span></p>
		</div>

		<!--国籍选择开始-->
		<div class="country-cho-wrap">
			<div class="header">
				<a href="javascript:;" class="header-back country-hidden"><i class="icons go-back"></i></a>
				<div class="cl_search">
					<input type="text" placeholder="北京/beijing/Beijing" id="country-input-zone"/>
					<i></i>
				</div>
			</div>

			<!--国籍弹窗开始-->
			<ul class="country-list-searched"></ul>
			<!--国籍弹窗结束-->

			<div class="snap-content" style="padding-top: 45px;">
				<div class="country-wrap" id="country-wrap">
				</div>
			</div>
		</div>
		<!--国籍选择结束-->
	<script src="../js/lib/jquery-1.10.2.min.js"></script>
	<!--填写订单-->
	<script src="../js/lib/jquery.alert.js"></script>
	<script src="../js/lib/vlm.js"></script>
	<script src="../js/lib/template.js"></script>
	<script src="../js/countrytel_list.js"></script>
	<script src="js/hf_orderdata.js"></script>
	<script>
//		$('.order-submit').click(function(){
//			window.location.href = 'order_detail.html';
//		})
	</script>
	<!--模板机票-->
	<script id="order-flight" type="text/template" >
		<ul>
			<li class = "order-lis1">
				<span class="order-lis1-l">
					<i></i>
					<span>机票</span>
				</span>
				<a href="ticket-detail.html">
					<span class="order-lis1-r">
					<span>详情</span>
					<i></i>
				</span>
				</a>
			</li>
			<li class = "order-lis2">
				<span class="order-lis2-l">
					<i></i>
					{% var d1= new Date(),arr=flightInfo.flightLeaveStartDate.substring(0,10).split('-'),arr1=['日','一','二','三','四','五','六']; d1.setFullYear(arr[0],arr[1]-1,arr[2]); %}
					<span class = "order-ml">{%=flightInfo.flightLeaveStartDate.substring(5,10)%}</span>
					<span>{%='周'+arr1[d1.getDay()]%}</span>
					<span class="airport-recycle">{%=flightInfo.segmentsLeave[0].airportNameFrom+'-'+flightInfo.segmentsLeave[0].airportNameTo%}</span>
				</span>
				<span class="order-lis2-r">
					<i></i>
					<span>{%=flightInfo.segmentsLeaveTotalTravelTimeString%}</span>
				</span>
			</li>
			<li class = "order-lis3">
				<span class="order-lis3-l">
					<i></i>
					{% var d1= new Date(),arr=flightInfo.flightReturnStartDate.substring(0,10).split('-'),arr1=['日','一','二','三','四','五','六']; d1.setFullYear(arr[0],arr[1]-1,arr[2]); %}
					<span class = "order-ml">{%=flightInfo.flightReturnStartDate.substring(5,10)%}</span>
					<span>{%='周'+arr1[d1.getDay()]%}</span>
					<span class="airport-recycle">{%=flightInfo.segmentsReturn[0].airportNameFrom+'-'+flightInfo.segmentsReturn[0].airportNameTo%}</span>
				</span>
				<span class="order-lis3-r">
					<i></i>
					<span>{%=flightInfo.segmentsReturnTotalTravelTimeString%}</span>
				</span>
			</li>
			<li class = "order-lis4">
				<span>
					头等舱+往返舱
				</span>
			</li>
		</ul>
	</script>
	<!--模板机票结束-->
	<!--模板酒店开始-->
	<script id="order-hot" type="text/template" >
		<ul>
			<li class = "order-hlist1">
				<i></i>
				<span>酒店</span>
			</li>
			<li class = "order-hlist2">{%=hotelInfo.hotelName%}</li>
			<li class = "order-hlist3">
				<span>11月25日-11月26日</span>
				<span>共1晚（当地时间为准）</span>
			</li>
			<li class = "order-hlist4">
				<span>房型：经济大床房</span>
				<span>房间数：2间</span>
			</li>
		</ul>
	</script>
	<!--模板酒店结束-->
	<script>
		(function () {

			//加载动画
			function package_detail() {

				$(window).load(function () {
					$("#status").fadeOut();
					$("#preloader").delay(400).fadeOut("medium");
				});
			};
			package_detail();

			//初始化
            var data=JSON.parse(localStorage.flightHotelFirstResult);
            console.log(data);

			function init() {
				//机票详情
				var flightdet=template('order-flight',data);
				$('.order-plane').html(flightdet);

				//酒店详情
				var flightdet=template('order-hot',data);
				$('.order-hotel').html(flightdet);
			}
			init();

			//明细showhide
			$('.order-detail').click(function(){
				if($('.hf_detail_fare').css('bottom') == '-50px')
				{
					$('.hf_det_mask').show();
					$('.hf_detail_fare').css('bottom','47px');
				}else{
					$('.hf_det_mask').hide();
					$('.hf_detail_fare').css('bottom','-50px');
				}
			});

			//与第一出行人相同图标
			function firstsame(){
				var bFlag=true;
				$('.con-alike').click(function(){
					if(bFlag){
						$(this).css('backgroundPosition','-37px -52px');
						bFlag=false;
					}else{
						$(this).css('backgroundPosition','-3px -52px');
						bFlag=true;
					}
				});
			}
			firstsame();

			//删除出行人
			$('.tra-delete').click(function(){
				$(this).parents('.order-tlist2').remove();
			});



			//下单
			var orderSub=document.querySelector('.order-submit');
			function hf_order(obj){
				obj.onclick=function(){

					//联系人姓名检验
					var inputlast=$('.hf_con_lastname');
					if(! vlm.Utils.validate.engName(inputlast.val())){
						jAlert('请您输入英文的联系人姓');
						return;
					}
					var inputfir=$('.hf_con_firstname');
					if(! vlm.Utils.validate.engName(inputfir.val())){
						jAlert('请您输入英文的联系人名');
						return;
					}
					// 手机号邮箱检验
					var oMobile = $('.hf_con_cell')[0].value;
					var oEmail = $('.hf_con_email')[0].value;

					if ( ! vlm.Utils.validate.mobileNo(oMobile) )
					{
						jAlert('请输入正确的手机号');
						return;
					}
					if ( ! vlm.Utils.validate.email(oEmail) )
					{
						jAlert('请输入正确的邮箱');
						return;
					}
					var Parmeters = {
						"Parameters": {
							"SetID": 1002001,
							"CacheID": 1013226,
							"CityCodeFrom": "SIN",
							"CityCodeTo": "BKK",
							"DepartDate": "2016-04-25T00:00:00",
							"ReturnDate": "2016-04-27T00:00:00",
							"HotelID": 96,
							"RoomID": 108450,
							"MemberId": "84587",
//							"RoomDetails": [{"Adult": 2, "ChildWithoutBed": [6]}, {"Adult": 1}, {"Adult": 1}],
//							"TravellerInfo": [{
//								"PassengerType": "ADULT",
//								"SexCode": "Ms",
//								"FirstName": "fr1",
//								"LastName": "111",
//								"DateOfBirth": "1990-01-09T00:00:00",
//								"CertificateInfo": {
//									"IdType": 1,
//									"IdCountry": "CN",
//									"IdNumber": "123",
//									"IdActivatedDate": "2017-01-09T00:00:00"
//								},
//								"CountryCode": "CN"
//							}],
							"ContactDetail": {
								"SexCode": "Ms",
								"FirstName": $('.hf_con_firstname').val(),
								"LastName": $('.hf_con_lastname').val(),
                                "Email": $('.hf_con_email').val(),
								"CountryNumber": $('.tel-btn span').html().substring(1),
								"MobilePhone": $('.hf_con_cell').val()
							},
							"CurrencyCode": "CNY",
							"TotalPrice": "9664"
						},
						"ForeEndType": 3,
						"Code": "50100004"
					}

                    //房间信息
                    Parmeters.Parameters.RoomDetails=data.RoomDetails;

                    //出行人
                    var traveller=[];
                    var traAdu={};
                    var traChi={};
                    var room=data.RoomDetails;
                    var traAdultnum=0;
                    var traChildnum=0;
                    for(var i=0;i<room.length; i++)
                    {
                        traAdultnum+=parseInt(room[i].Adult);
                        for(var j=0;j<room[i].Adult;j++)
                        {
							traAdu.PassengerType='ADULT';
							traveller.push(traAdu);
                        }
						for(var k=0;k<room[i].ChildWithoutBed.length;k++)
						{
							traChi.PassengerType='CHILD';
							traveller.push(traChi);
						}

                    }
                    traNum=traAdultnum+traChildnum;
                    Parmeters.Parameters.TravellerInfo=traveller;
					console.log(Parmeters);
					vlm.loadJson("", JSON.stringify(Parmeters), hotel_flight_back);
				};
			}
			hf_order(orderSub);

			//下单回调函数
			function hotel_flight_back(ret){

				var json=ret;
				console.log(json);
				if(json.success)
				{
					alert(1);
					window.localStorage.BookingRefNo=json.BookingRefNo;
					window.localStorage.BookingID=json.BookingID;
				}
			}



		})();
	</script>

	</body>
</html>