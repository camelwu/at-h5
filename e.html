<!DOCTYPE html>
<html lang="cn">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

		<title>MVC框架功能</title>
		<meta name="Keywords" content="亚洲旅行网">
		<meta name="description" content="基础mvc框架展示">
		<meta name="author" content="camel.wu">

		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="user-scalable=no,initial-scale=1.0,maximum-scale=1.0 minimal-ui"/>
		<!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
		<link rel="shortcut icon" href="/favicon.ico">
		<link rel="apple-touch-icon" href="/apple-touch-icon.png">
	</head>

	<body>
		<div>
			<header>
				<h1>e</h1>
			</header>
			<nav>
				<p>
					<a href="/">Home</a>
				</p>
				<p>
					<a href="/contact">Contact</a>
				</p>
			</nav>

			<div id="issue">

			</div>

			<footer>
				<p>
					&copy; Copyright  by think
				</p>
			</footer>
		</div>
	</body>
<script src="js/lib/jquery.js"></script>
<script src="js/lib/vcm.js"></script>
<script src="js/lib/vlm.js"></script>
<script src="js/lib/lazyLoad.js"></script>
<script>
// 初始化MVC对象
var MVC = MVC || function(){
	if(!arguments.length)return;
    this.ctrl.apply(this, arguments);
};
MVC.prototype = {
	constructor:MVC,
	apiUrl:"http://127.0.0.1/test.php",
	// 初始化MVC数据模型
	model : function(){
		//内部对象
		var M = {};
		//服务器端获取数据，通常Ajax方式并存储，直接作为同步数据并写在页面中，减少服务器端异步请求操作
		M.data = {};
		//配置数据，页面加载时即提供
		M.conf = {};
		//返回操作方法
		return {
			getData:function(m){
				return M.data[m];
			},
			getConf:function(c){
				return M.conf[c];
			},
			setData:function(m,v){
				M.data[m]=v;
				return this;
			},
			setConf:function(c,v){
				M.conf[c]=v;
				return this;
			}
		};
	}(),
	// 初始化MVC视图层                                                                                                                        
	view : function(){
		//模型数据层对象操作方法引用
		var M = this.model;
		//内部视图创建方法对象
		var V = {
			createList:function(){},
			formateString : function(str, data) {
				var html = '';
				if ( data instanceof Array) {
					for (var i = 0, len = data.length; i < len; i++) {
						html += arguments.callee(str, data[i]);
					}
					return html;
				} else {
					return str.replace(/\{#(\w+)#}/g, function(match, key) {
						return typeof data === 'string' ? data : ( typeof data[key] === 'undefined' ? '' : data[key]);
					});
				}
			}
		};
		//获取视图接口方法
		return function(v){
			//根据视图名称返回视图，
			V[v]();
		};
	}(),
	// 初始化MVC控制器
	ctrl : function(){
		//模型数据层对象操作方法引用                                                                                                                 
		var M = this.model,
		//视图数据层对象操作方法引用
			V = this.view,options = arguments[0];
		//容器
		this.container = document.getElementById(options.id);
		//操作
		this.operater = options.operater;
		//设置数据
		var config = options.conf;
		for(var i in config){
			M.setConf(i,config[i]);
		}
		
		console.log(M.getConf(i));
		//控制器创建方法对象
		var C = {}||options.operater;
		for(var p in C){
			C[p] && C[p]();
		}
	}
};


	var c = new vcm(),
	json=json||function(){
		var oDate=new Date(),y=oDate.getFullYear(),m=oDate.getMonth()+1,d=oDate.getDate(),
		//把url字符串变成json
			json={},url=window.location.href,arr=url.split('?'),arr2=arr[1].split('&');
	    for(var i=0;i<arr2.length;i++){
	        var arr3=arr2[i].split('=');
	        json[arr3[0]]=arr3[1];
	    }
	    //添加额外json数据
        json.rank=json.rank||'priceasc';
        json.CityName=json.CityName||'Singapore';
        json.NumRoom=json.NumRoom||'1';
        json.NumChild=json.NumChild||'1';
        json.NumAdult=json.NumAdult||'1';
        json.Category=json.Category||'';
        json.StarRating=json.StarRating||'';
        json.LocationList=json.LocationList||'';
        json.InterCheckInDate=json.InterCheckInDate||y+'-'+m+'-'+d;
        json.InterCheckOutDate=json.InterCheckOutDate||y+'-'+m+'-'+(d+1);
        //
	    return json;
	};
	//c.loadJson("http://10.2.22.239:8888/api/GetServiceApiResult", JSON.stringify(data), mycallback);
	var obj={
		api:"http://10.2.22.239:8888/api/GetServiceApiResult",
		conf:{
			name:"hotelList",
			id:"issue",
			data:{
            "Parameters": "{\"CultureName\":\"zh-CN\",\"PartnerCode\":\"1000\",\"CountryISOCode\":\"SG\",\"CityName\":\""+json.InterCityName+"\",\"CheckInDate\":\""+json.InterCheckInDate+"T00:00:00\",\"CheckOutDate\":\""+json.InterCheckOutDate+"T00:00:00\",\"NumRoom\":"+json.NumRoom+",\"NumAdult\":"+json.NumAdult+",\"NumChild\":"+json.NumChild+",\"InstantConfirmation\":true,\"AllOccupancy\":true,\"PageIndex\":1,\"PageSize\":20,\"sorttype\":\""+json.rank+"\",\"Category\":\""+json.Category+"\",\"StarRating\":\""+json.StarRating+"\",\"LocationList\":\""+json.LocationList+"\"}",
            "Code": "0007",
            "ForeEndType": 3
        	},
        	operater:"c.loadJson"
        }
	}
	,d = new MVC(obj);
	console.log("mvc="+d.model);
	function loadjson(){}
</script>
</html>
