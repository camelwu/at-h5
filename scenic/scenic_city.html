<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0 minimal-ui"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="green">
    <meta name="Keywords" content="亚洲旅行网">
    <meta name="Description" content="境外专业旅行服务提供机构">
    <meta name="screen-orientation" content="portrait">
    <meta name="x5-orientation" content="portrait">
    <meta name="full-screen" content="yes">
    <meta name="x5-fullscreen" content="true">

    <title>城市列表 - 亚洲旅行网</title>
    <link href="../styles/framework.css" rel="stylesheet">
    <link href="../styles/style.css" rel="stylesheet">
    <link href="../scenic/css/scenic_city.css" rel="stylesheet">
    <link href="../styles/tips.css"	rel="stylesheet">
</head>
<body>
<div class="all-elements">
    <div id="headerview" style="height: 44px;">
        <div id="ui-view-1" class="t-header">
            <span class="js-backpage t-header-icon fl t-header-iconsize cp"></span>
            <div class="t-search-view t-search-viewsize">
                <input class="t-search-inputbox" placeholder="北京/beijing/bj/bjs/中国"/>
            </div>
        </div>
    </div>
    <div class="sc-content">

            <div class="gui-tab-view" id="ui-view-2">
                <ul class="gui-tab-mod">
                    <li data-key="1" class="gui-tab-current cp">国内城市</li>
                    <li data-key="2" class="cp">海外城市</li>
                    <i class="gui-tab-scrollbar gui-tab"></i>
                </ul>
            </div>

            <ul id="js_inland" class="gui-city-itmes gui-hidden">
                <li>
                    <span class="gui-city-t">当前</span>
                    <ul class="city-tags">
                        <li class="current">我的位置</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                    </ul>
                </li>
                <li>
                    <span class="gui-city-t">历史选择</span>
                    <ul class="city-tags">
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                    </ul>
                </li>
                <li>
                    <span class="gui-city-t">热门城市</span>
                    <ul id="js_InHotCity" class="city-tags">
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                    </ul>
                </li>
            </ul>

            <ul id="js_oversea" class="gui-city-itmes">
                <li>
                    <span class="gui-city-t">当前</span>
                    <ul class="city-tags">
                        <li class="current">我的位置</li>
                        <li>北京</li>
                    </ul>
                </li>
                <li>
                    <span class="gui-city-t">历史选择</span>
                    <ul class="city-tags">
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                    </ul>
                </li>
                <li>
                    <span class="gui-city-t">热门城市</span>
                    <ul id="js_ExHotCity" class="city-tags">
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                        <li>北京</li>
                    </ul>
                </li>
            </ul>
       
    </div>
    <div id="ui-view-3">
        <ul id="CharColumn" class="tags-cut">


        </ul>
    </div>
</div>
<div id="citysear_page" class="all-elements" style="display: none;">
    <div style="height: 44px;z-index: 100">
        <div class="t-header" >
            <span class="t-header-icon fl t-header-iconsize cp"></span>
            <div class="t-search-view t-searchBox-viewsize">
                <input id="city_search" class="t-search-inputbox" placeholder="全球城市" style="width: 70%;"/>
                <span class="sctop-cha">x</span>
            </div>
            <div class="sctop-quit">取消</div>
        </div>
    </div>
    <div class="sc-content" style="z-index: 99">
        <ul class="sccity-list">
            <li>亿uahfsua </li>
            <li>亿uah大概fsua </li>
            <li>亿u爱国a </li>
            <li>亿uahfsua </li>
            <li>亿uah吧ua </li>
            <li>亿uahfsua </li>
            <li>亿uah大概fsua </li>
            <li>亿u爱国a </li>
            <li>亿uahfsua </li>
            <li>亿uah吧ua </li>
            <li>亿uah吧ua </li>
            <li>亿uahfsua </li>
            <li>亿uah大概fsua </li>
            <li>亿u爱国a </li>
            <li>亿uahfsua </li>
            <li>亿uah吧ua </li>
        </ul>
    </div>
</div>
<script src="../js/lib/jquery.js"></script>
<script src="../js/lib/vlm.js"></script>
<script src="../js/lib/jquery.alert.js"></script>
<script src="../js/lib/template.js"></script>
<script src="js/scenic_pub.js"></script>


<script id="tpl_GetHotCity" type="text/template">
    {% for(var i=0,len=data.destCities.length;i<len;i++){ %}
    <li data-key="{%=data.destCities[i].cityCode%}">{%=data.destCities[i].cityName%}</li>
    {% } %}
</script>


<script>
    (function(){
        //hotcity listcity callbackcode
        var val = vlm.parseUrlPara(window.location.href);
        var callback = MT.GetQueryString("callback");
        var callbackcity = MT.getCity(val.citycode,callback);
        var callback_url = MT.GetRequestUrl(callback);
        console.log(callback_url);

        MT.bindclickBackPage = function(){
            $(".js-backpage").click(function(){
//               window.location.href = callback;
                history.go(-1);
            });
        }

        /**
         * 获得国外热门城市
         */
        MT.getExHotCity = function(){
            var Param=
            {
                "Parameters": {
                    "SubProduct": "All"
                },
                "ForeEndType": 3,
                "Code": callbackcity.CallbackCity.city.oversea.hotcity
            }

            MT.ajaxJson("",JSON.stringify(Param),MT.CallbackExHotCity,MT.ajaxAnimIn,MT.ajaxAnimOut);
        }

        /**
         * 获得国外热门城市的回调方法
         * @param data
         * @constructor
         */
        MT.CallbackExHotCity = function(data){
            var json=eval('('+data+')');
            console.log(json);
            if(json.success){
                var data=json,tpl_GetExHotCity = template("tpl_GetHotCity",data);

                $("#js_ExHotCity").html(tpl_GetExHotCity).find("li").click(MT.ClickTags);


            }else {
                console.log(json);
                jAlert(json.message,"提示");
            }

        }

        /**
         * 获得城市列表
         */
        MT.getCityList = function(){
            var Param=
            {
                "Parameters": {
                    "SubProduct": "All"
                },
                "ForeEndType": 3,
                "Code": callbackcity.CallbackCity.city.oversea.citylist
            }

            MT.ajaxJson("",JSON.stringify(Param),MT.CallbackCityList,MT.ajaxAnimIn,MT.ajaxAnimOut);
        }

        /**
         * 获得城市列表的回调方法
         * @param data
         * @constructor
         */
        MT.CallbackCityList = function(data){
            var json=eval('('+data+')');
            console.log(json);
            if(json.success){
                var data=json,tpl_str,tpl_title,tpl_ul;
                var newArray = MT.SplitCitiesArray(json.data.destCities.sort(MT.ByCities));
//                var docf = document.createDocumentFragment();
                for (var i = 0;i<newArray.length;i++){
                    var title =newArray[i][0].cityCode.substr(0,1);
                    tpl_str = $("<li id='"+title+"'></li>");
                    $("<span  class='gui-city-t'></span>").html(title).appendTo(tpl_str);
                    tpl_ul = $("<ul class='city-tags'></ul>");
                    tpl_ul.appendTo(tpl_str);
                    for (var j = 0;j<newArray[i].length;j++){
                       var li_child= $("<li data-key='"+newArray[i][j].cityCode+"'></li>").click(MT.ClickTags);
                        li_child.html(newArray[i][j].cityName).appendTo(tpl_ul);
                    }
                    $("#js_oversea").append(tpl_str);
                }

                MT.CharColumn("CharColumn",newArray);

            }else {
                console.log(json);
                jAlert(json.message,"提示");
            }

        }

        MT.ClickTags = function(e){
            var cc = $(this).attr("data-key");
            var url = callback;
            if(url == ""){
                return false;
            }
            window.location.href = "../"+url+"?DestCityCode="+cc;
        }

        /**
         * 城市列表字母列表
         * @param ulId
         * @param newArray
         * @constructor
         */
         MT.CharColumn = function(ulId,newArray){
             var ul = $("#"+ulId),childli,childspan;
             $("<li data-key='cur' data-value='当前'>当前</li>").click(MT.ClickChar).appendTo(ul);
             $("<li data-key='hot' data-value='热门'>热门</li>").click(MT.ClickChar).appendTo(ul);

             for (var i = 0;i<newArray.length;i++){
                 var title =newArray[i][0].cityCode.substr(0,1);
                 childli = $("<li data-key='"+title+"' data-value='"+title+"'></li>").click(MT.ClickChar);
                 childspan = $("<span class='tags' data-value='"+title+"'><span> ").html(title);
                 childspan.appendTo(childli);
                 childli.appendTo(ul);
             }
         }

        MT.ClickChar = function(e){

            var id = $(this).attr("data-key");
            var pos = $("#"+id).offset().top;
            $("html,body").animate({ scrollTop: pos }, 400);
//            console.log(id);
        }


        //tab切换
        MT.tabScroll();
        //加载国外热门城市
        MT.getExHotCity();
        //加载城市列表
        MT.getCityList();
        //给返回绑定click事件
        MT.bindclickBackPage();


    })();
</script>
</body>
</html>