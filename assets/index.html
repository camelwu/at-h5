<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0 minimal-ui">
  <meta name="screen-orientation" content="portrait">
  <meta name="full-screen" content="yes">
  <meta name="browsermode" content="application">
  <meta name="x5-orientation" content="portrait">
  <meta name="x5-fullscreen" content="true">
  <meta name="x5-page-mode" content="app">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="green">
  <meta name="Keywords" content="亚程旅行网">
  <meta name="Description" content="境外专业旅行服务提供机构">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/splash/splash-icon.png">
  <link rel="apple-touch-icon-precomposed" sizes="180x180" href="images/splash/splash-icon-big.png">
  <link rel="apple-touch-startup-image" href="images/splash/splash-screen.png" media="screen and (max-device-width: 320px)">
  <link rel="apple-touch-startup-image" href="images/splash/splash-screen@2x.png" media="(max-device-width: 480px) and (-webkit-min-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="images/splash/splash-screen-six.png" media="(device-width: 375px)">
  <link rel="apple-touch-startup-image" href="images/splash/splash-screen-six-plus.png" media="(device-width: 414px)">
  <link rel="apple-touch-startup-image" sizes="640x1096" href="images/splash/splash-screen@3x.png">
  <link rel="apple-touch-startup-image" sizes="1024x748" href="images/splash/splash-screen-ipad-landscape" media="screen and (min-device-width : 481px) and (max-device-width : 1024px) and (orientation : landscape)" />
  <link rel="apple-touch-startup-image" sizes="768x1004" href="images/splash/splash-screen-ipad-portrait.png" media="screen and (min-device-width : 481px) and (max-device-width : 1024px) and (orientation : portrait)" />
  <link rel="apple-touch-startup-image" sizes="1536x2008" href="images/splash/splash-screen-ipad-portrait-retina.png" media="(device-width: 768px)	and (orientation: portrait)	and (-webkit-device-pixel-ratio: 2)" />
  <link rel="apple-touch-startup-image" sizes="1496x2048" href="images/splash/splash-screen-ipad-landscape-retina.png" media="(device-width: 768px)	and (orientation: landscape)	and (-webkit-device-pixel-ratio: 2)" />
  <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
  <title>首页 - 亚程旅行网</title>
  <script src="js/lib/logRecord.js"></script>
  <link href="styles/reset.css" rel="stylesheet" type="text/css">
  <link href="styles/tips.css" rel="stylesheet">
  <link href="css/index.css" rel="stylesheet">
</head>

<body>
<div id="preloader">
  <div id="status"></div>
</div>

<div class="all_elements" id="app">
  <div class="content no_header">
    <!--头部banner开始-->
    <div class="slider-container">
      <ul class="homepage_slider clearfix"  id="banner">
        <li v-for="banner in bannerList" class="fl">
          <a :href="banner.bannerChangeLink">
            <img :src="banner.bannerPicUrl" class="responsive_image" alt="img">
          </a>
        </li>
      </ul>
      <div class="banner_num_wrap">
        <ul class="banner_num"></ul>
      </div>
    </div>
    <!--头部banner结束-->
  </div>
  <!--column开始-->
  <ul class="column_wrap clearfix">
    <li v-for="column in columnList" class="adaptive_item">
      <a :href="column.href">
        <img class="res_image" :src="column.icon" alt="img">
        <span class="center_text">{{column.title}}</span>
        <!--或<span class="center_text" v-text="item.title"></span>-->
      </a>
    </li>
  </ul>
  <!--column结束-->

  <!--当月热玩海外门票开始-->
  <div class="container">
    <div class="recommends" id="recommend">
      <ul class="recommends_tab clearfix">
        <li class="fl">
          <a href="index-hotplay.html"><img src="images/index/hot_play.jpg" class="hot_sea"></a>
        </li>
        <li class="fr">
          <a href="index-seaticket.html"><img src="images/index/sea_ticket.jpg" class="hot_sea"></a>
        </li>
      </ul>
    </div>
  </div>
  <!--当月热玩海外门票结束-->
  <!--玩家推荐-->
  <div class="player_recommend">
    <div class="player_rec_title">
      <h5 class="play_rec_text">
        <span class="player_line"></span>玩家推荐<span class="player_line right"></span>
      </h5>
    </div>
    <div class="container" id="tuijian" style="">
      <div v-for="item in recommendList">
        <div class="half_top">
          <a :href="item.productHref">
            <div class="rec_price">
              <span class="rec_price_tit">
                <i>¥</i>{{item.productPrice}}<i> 起</i>
              </span>
            </div>
            <img src="images/loading_def_big.png" :data-src="item.productPicUrl" alt="img" width="100%">
          </a>
        </div>
        <h5 class="to_rec_tit">{{item.productName}}</h5>
        <p class="to_recommend">{{item.productDesc}}</p>
      </div>

    </div>
  </div>
  <div class="footer">
    <p>Copyright @ 2016</p>
    <p>北京祺迹国际旅行社有限公司 | 京ICP备 16028783号-1</p>
    <p>北京朝阳区五里桥一街非中心32号楼3层</p>
    <p>4008-909-202/010-58535627</p>
  </div>
</div>
<div id="menu"></div>
<script src="js/lib/jquery.js"></script>
<script src="js/lib/plugins.js"></script>
<script src="js/lib/jquery.alert.js"></script>
<script src="js/lib/vlm.js"></script>
<!--<script src="js/lib/template.js"></script>-->
<script src="js/lib/vue/vue@2.0.8.js"></script>

<script>
  (function() {
    var linkurl = {
      1: "./hotel/hotel_detail.html?HotelID=",
      2: "./flight/ticket_seat_choose.html?setId=",
      3: "./scenic/scenic_detail.html?packageID=",
      4: "./tour/packages_detail.html?packageID="
    };
    // 控制底部 footer 展示。
    vlm.init();
    $(document).ready(function() {
      // FastClick 是防止 click 的 300ms 等待
      FastClick.attach(document.body);
    });
    var app = new Vue({
      el: '#app',
      data: {
        bannerList: [{
          // 默认图片
          url: 'images/loading_def_big.png'
        }],

        columnList:[{
          href: './hotel/index.html',
          icon: './images/index/hotel_guide.png',
          title: '酒店',
        }, {
          href: './flight/f_index.html',
          icon: './images/index/flight_guide.png',
          title: '机票',
        }, {
          href: './scenic/index.html',
          icon: './images/index/scenic_guide.png',
          title: '景点',
        }, {
          href: './hotel_flight_tour/index.html',
          icon: './images/index/fht_guide.png',
          title: '自由行',
        }, {
          href: './tour/index.html',
          icon: './images/index/tour_guide.png',
          title: '酒+景',
        }],

        playerRecommendList: [],
      },

      methods: {},
      computed: {
        // computed 是计算属性，用于对 data 求值
        // computed 也是响应式的，data 变化，computed 也会相应重新计算
        recommendList: function () {
          var playerRecommendList = this.playerRecommendList;

          var recommendList = playerRecommendList.map(function (item, index) {
            var productType = item.productType;
            var productHref = linkurl[productType] + item.productID;

            if (productType === 4) {
              productHref += '&productPrice=' + item.productPrice + '&status=1';
            }
            return {
              productHref: productHref,
              productPrice:item.productPrice,
              productPicUrl:item.productPicUrl,
              productName:item.productName,
              productDesc:item.productDesc
            }
          });

          return recommendList
        }
      },
      mounted: function () {
        var _this = this;

        //banner
        function LoadBanner() {
//        var tpl0 = ['<li class="fl"><a href="{%=bannerChangeLink%}">', '<img src="{%=bannerPicUrl%}" class="responsive_image" alt="img">', '</a></li>'].join('');
          var tmp = {
            "Parameters": {
              "BannerType": 1
            },

            "ForeEndType": 3,
            "Code": "001302"
          };
          vlm.loadJson("", JSON.stringify(tmp), function(json) {
            if (json.success) {
              var data = json.data;
              _this.bannerList = data.bannerList;
              Vue.nextTick(function () {
                bannerTab();
              });
//            var html_b = template(tpl0, data.bannerList);
//            $("#banner").html(html_b);
            } else {
              console.log(json);
              jAlert("数据格式错误", "提示");
            }
          });
        }
        //playerRecommend
        function PlayerRecommend() {
//        var tpl1 = ['<div class="half_top"><a href="{%=linkurl[productType]%}{%=productID%}{% if(productType==4){ %}&productPrice={%=productPrice%}&status=1{% } %}"><div class="rec_price"><span class="rec_price_tit"><i>¥</i>{%=productPrice%}<i> 起</i></span></div><img src="images/loading_def_big.png" data-src="{%=productPicUrl%}" alt="img" width="100%"></a></div>', '<h5 class="to_rec_tit">{%=productName%}</h5>', '<p class="to_recommend">{%=productDesc%}</p>'].join('');
          var tmp = {
            "Parameters": {
              "PageNo": 1,
              "PageSize": 10
            },
            "ForeEndType": 3,
            "Code": "001303"
          };
          vlm.loadJson("", JSON.stringify(tmp), function(json) {
            console.log(json);
            if (json.success) {
              var data = json.data;
              _this.playerRecommendList = data.playerRecommendList;

//            html_tj = template(tpl1, data.playerRecommendList);
//            $("#tuijian").html(html_tj);

              Vue.nextTick(function () {
                //默认图片
                var images = $("#tuijian").find('img');
                var error_url = 'images/loading_def_big.png';
                for (var i = 0; i < images.length; i++) {

                  (function(index) {
                    var re_url = images[i].getAttribute('data-src');
                    loadImage(re_url, error_url, function() {
                      images[index].setAttribute('src', re_url);

                    }, function() {
                      images[index].setAttribute('src', error_url);
                    });

                    function loadImage(url, error_url, callback, errorFunc) {
                      var img = new Image();
                      img.src = url;
                      img.onload = function() {
                        img.onload = null;
                        callback();
                      };
                      img.onerror = function() {
                        img.onerror = null;
                        errorFunc();
                      }
                    }
                  })(i);
                }
              })


            } else {
              console.log(json);
              jAlert("数据格式错误", "提示");
            }
          });
        }

        //bannerTab
        function bannerTab(){
          var startX,startY, endX,endY;
          var i= 0,timer=null,timerTimeout=null;bFlag=false;viewWidth=$(window).width();
          for (var j = 0; j < $('.homepage_slider li').length; j++) {
            $('.banner_num').append('<li><span></span></li>')
          }
          $('.banner_num li').first().addClass('active');
          var firstimg=$('.homepage_slider li').first().clone();
          firstimg.css('width',viewWidth);
          $('.homepage_slider li').css('width',viewWidth);

          $(window).on('resize',function(){
            viewWidth=$(window).width();
            $('.homepage_slider li').css('width',viewWidth);
            firstimg.css('width',viewWidth);
            $('.homepage_slider').width($('.homepage_slider li').length*($('.homepage_slider li').width()));
            $('.homepage_slider').stop().animate({left:-i*viewWidth},{easing:"linear",duration:500,complete:function() {
              bFlag=false;
            }});
          });

          $('.homepage_slider').append(firstimg).width($('.homepage_slider li').length*($('.homepage_slider li').width()));

          // 滑动
          $('.slider-container').on('touchstart',function(event) {
            var touch = event.originalEvent.targetTouches[0];
            startX = touch.pageX,
              startY = touch.pageY;
          });

          $('.slider-container').on('touchmove',function(event){
            var touch = event.originalEvent.targetTouches[0];
            endX = touch.pageX,
              endY = touch.pageY;
            if( bFlag){
              return;
            }
            if(Math.abs(startY - endY) <= 5){
              bFlag=true;
            }

            clearInterval(timer);
            if ((startX - endX) >= 5) {
              i++;
              if (i==$('.homepage_slider li').length) {
                i=1; //这里不是i=0
                $('.homepage_slider').css({left:0}); //保证无缝轮播，设置left值
              };
              $('.homepage_slider').stop().animate({left:-i*viewWidth},{easing:"linear",duration:500,complete:function(){
                bFlag=false;
              }});
              if (i==$('.homepage_slider li').length-1) { //设置小圆点指示
                $('.banner_num li').eq(0).addClass('active').siblings().removeClass('active');
              }else{
                $('.banner_num li').eq(i).addClass('active').siblings().removeClass('active');
              }
            }else if((startX - endX) < -5){
              i--;
              if (i == -1) {
                i=$('.homepage_slider li').length-2;
                $('.homepage_slider').css({left:-($('.homepage_slider li').length-1)*viewWidth});
              }
              $('.homepage_slider').stop().animate({left:-i*viewWidth},{easing:"linear",duration:500,complete:function(){
                bFlag=false;
              }});
              $('.banner_num li').eq(i).addClass('active').siblings().removeClass('active');
            }

            clearTimeout(timerTimeout);
            timerTimeout=setTimeout(function(){
              timer_play();
            },1500);

          });

          //定时器自动播放
          timer_play();
          function timer_play(){
            clearInterval(timer);
            timer=setInterval(function(){
              i++;
              if (i==$('.homepage_slider li').length) {
                i=1;
                $('.homepage_slider').css({left:0});
              };
              $('.homepage_slider').stop().animate({left:-i*viewWidth},{easing:"linear",duration:500,complete:function(){
                bFlag=false;
              }});
              if (i==$('.homepage_slider li').length-1) {
                $('.banner_num li').eq(0).addClass('active').siblings().removeClass('active');
              }else{
                $('.banner_num li').eq(i).addClass('active').siblings().removeClass('active');
              }
            },4000)
          }

        }

        LoadBanner();
        PlayerRecommend()
      }
    });
  })();
</script>
</body>
</html>
