/*! asiatravel FE team at-h5-nodejs-----2016-05-19T15:21:43 */
function TicketDate(a){Calender.call(this,a)}TicketDate.prototype=new Calender,TicketDate.prototype.linkColor=function(a,b){var c,d,e=_CalF.$(".live",this.dd);if("Return"==a){for(var f=0;f<e.length;f++)e[f].querySelector(".live_txt")&&"入住"==e[f].querySelector(".live_txt").innerHTML&&(c=f),e[f].querySelector(".live_txt")&&"离店"==e[f].querySelector(".live_txt").innerHTML&&(d=f);for(var g=c;d>g;g++)_CalF.addClass("yellow",e[g])}else for(var h=0;h<e.length;h++){var i=/(\d{1,2})/g.exec(e[h].innerHTML);i&&(e[h].getAttribute("data-day")==b?e[h].innerHTML='<span class="live_circle">'+i[0]+"</span>":e[h].innerHTML=null!=i[0]?i[0]:""),"今天"==e[h].innerHTML&&b==e[h].getAttribute("data-day")&&(e[h].innerHTML='<span class="live_circle">今天</span>')}return!1},TicketDate.prototype._word={h:["入住","离店"],f:["入住","离店","去+返"]},TicketDate.prototype.inputEvent=function(){var a=this,b=new Date,c=b.getFullYear(),d=b.getMonth();b.getDate();_CalF.bind(this.input,"click",function(){a.createContainer();for(var b=0;b<a.num;b++)if(b==a.num-1){var e=new Date(c,d+b,1);a.drawLastDate(e)}else{var e=new Date(c,d+b,1);if("Oneway"==a.type)a.drawDate(e),a.linkColor("Oneway",a.singleDate);else{var f=a.doubleDate.start,g=a.doubleDate.end;a.time={},f!=g?(a.time[f]="入住",a.time[g]="离店"):a.time[f]="去+返",a.drawDate(e)}}})},TicketDate.prototype.initialize=function(a){this.type=a.type,this.id=a.id,this.num=a.num,this.sClass1=a.sClass1,this.id2=a.id2,this.fn=a.fn,this.fn2=a.fn2,this.op=0,this.input=_CalF.$("#"+this.id),this.inputEvent(),this.outClick(),"Oneway"==this.type?this.singleDate=a.time.start:this.doubleDate=a.dateObj,a.range&&(this.range=a.range)},TicketDate.prototype.createContainer=function(a){var b=_CalF.$("#"+this.id+"-date");b&&b.parentNode.removeChild(b);var c=this.container=document.createElement("div");if(c.id=this.id+"-date",c.style.position="absolute",c.style.zIndex=98,"input"===this.input.tagName){var d=_CalF.getPos(this.input);c.style.left=d.left+"px",c.style.top=d.bottom-1+"px",_CalF.bind(c,"click",this.stopPropagation)}else{c.style.background="#f5f4f9",c.style.overflow="auto",c.style.width=c.style.height="100%",c.style.left="0",c.style.top="0",c.style.paddingBottom="118px";var e=this.header=document.createElement("div");e.id=this.id+"-header",e.className="header tour-date-header",e.innerHTML='<a href="javascript:void(0);" class="header-back"><i class="icons go-back"></i></a><h3>选择日期</h3>',document.body.appendChild(e);var f=document.createElement("div");f.className="calendar",f.style.marginTop="49px",f.innerHTML=this._tempweek.join(""),c.appendChild(f);var g=this.tiper=document.createElement("div");g.id=this.id+"-tiper",g.className="tipers",g.innerHTML="请选择入住日期","Oneway"==this.type?void 0:c.appendChild(g)}document.body.appendChild(c)},TicketDate.prototype.drawDate=function(a){var b,c,d,e,f,g,h,i,j,k,l=[],m=new Date,n=m.getFullYear(),o=m.getMonth(),p=m.getDate(),q="",r="";for(this.dateWarp=b=document.createElement("div"),b.className="calendar",b.innerHTML=this._template.join(""),this.year=e=a.getFullYear(),this.month=f=a.getMonth()+1,this.date=g=a.getDate(),this.titleDate=c=_CalF.$(".title-date",b)[0],tims=this.time,k=document.createTextNode(e+"年"+f+"月"),c.appendChild(k),d=_CalF.$("dd",b)[0],h=new Date(e,f,0).getDate(),i=new Date(e,f-1,1).getDay(),j=0;i>j;j++)l.push("<a>&nbsp;</a>");for(j=1;h>=j;j++)r=parseInt(j)<10?"0"+parseInt(j):parseInt(j),q=parseInt(f)<10?"0"+parseInt(f):parseInt(f),n>e?l.push('<a class="disabled">'+j+"</a>"):e==n?o+1>f?l.push('<a class="live disabled">'+j+"</a>"):f==o+1?p>j?l.push('<a class="live disabled">'+j+"</a>"):(tims&&tims[e+"-"+q+"-"+r]&&"Return"==this.type?pstr='<a class="live" data-day="'+e+"-"+q+"-"+r+'"><span class="live_circle">'+j+'</span><span class="live_txt">'+tims[e+"-"+q+"-"+r]+"</span></a>":tims&&tims[e+"-"+q+"-"+r]&&"Oneway"==this.type?pstr='<a class="live" data-day="'+e+"-"+q+"-"+r+'"><span class="live_circle">'+j+"</span></a>":pstr='<a class="live" data-day="'+e+"-"+q+"-"+r+'">'+j+"</a>",j==p?l.push('<a class="live" data-day="'+e+"-"+q+"-"+r+'">今天</a>'):l.push(pstr)):f==o+2?(tims&&tims[e+"-"+q+"-"+r]&&"Return"==this.type?pstr='<a class="live" data-day="'+e+"-"+q+"-"+r+'"><span class="live_circle">'+j+'</span><span class="live_txt">'+tims[e+"-"+q+"-"+r]+"</span></a>":tims&&tims[e+"-"+q+"-"+r]&&"Oneway"==this.type?pstr='<a class="live" data-day="'+e+"-"+q+"-"+r+'"><span class="live_circle">'+j+"</span></a>":pstr='<a class="live" data-day="'+e+"-"+q+"-"+r+'">'+j+"</a>",l.push(pstr)):l.push('<a class="live" data-day="'+e+"-"+q+"-"+r+'">'+j+"</a>"):e>n&&l.push('<a class="live" data-day="'+e+"-"+q+"-"+r+'">'+j+"</a>");d.innerHTML=l.join(""),this.container.appendChild(b);var s=!!window.ActiveXObject&&!window.XMLHttpRequest;s&&b.appendChild(this.createIframe()),this.linkOn(),"Oneway"==this.type?document.querySelector("#chooseDate-single-header")?document.querySelector("#chooseDate-single-header").onclick=function(a){var a=a||window.event,b=a.target||a.srcElement,c=null,d=null;("A"==b.tagName&&"header-back"==b.className||"I"==b.tagName&&"icons go-back"==b.className)&&(c=document.querySelector(".header"),d=document.querySelector("#date-range-date"),document.body.removeChild(c),document.body.removeChild(d))}:document.querySelector("#dateIcon-header")&&(document.querySelector("#dateIcon-header").onclick=function(a){var a=a||window.event,b=a.target||a.srcElement,c=null,d=null;("A"==b.tagName&&"ticket-header-back"==b.className||"I"==b.tagName&&"icons ticket-go-back"==b.className)&&(c=document.querySelector("#dateIcon-header"),d=document.querySelector("#dateIcon-date"),document.body.removeChild(c),document.body.removeChild(d))}):document.querySelector("#ori-des-Date-header")?document.querySelector("#ori-des-Date-header").onclick=function(a){var a=a||window.event,b=a.target||a.srcElement,c=null,d=null;("A"==b.tagName&&"ticket-header-back"==b.className||"I"==b.tagName&&"icons ticket-go-back"==b.className)&&(c=document.querySelector("#ori-des-Date-header"),d=document.querySelector("#ori-des-Date-date"),document.body.removeChild(c),document.body.removeChild(d))}:document.querySelector("#dateIcon-header")&&(document.querySelector("#dateIcon-header").onclick=function(a){var a=a||window.event,b=a.target||a.srcElement,c=null,d=null;("A"==b.tagName&&"ticket-header-back"==b.className||"I"==b.tagName&&"icons ticket-go-back"==b.className)&&(c=document.querySelector("#dateIcon-header"),d=document.querySelector("#dateIcon-date"),document.body.removeChild(c),document.body.removeChild(d))})},TicketDate.prototype.linkOn=function(){var a,b=_CalF.$(".live",this.dd),c=b.length,d=this;for(a=0;c>a;a++)b[a].index=a,b[a].onclick=function(a){"input"===d.input.tagName?($(this).css("border","1px solid #ff6a2f").css("z-index","9999999"),$(this).siblings().css("border","").css("z-index","")):this.className.indexOf("disabled")>-1||("Oneway"==d.type?d.linkOver(a):0==d.op?(null!=d.timer&&(window.clearTimeout(d.timer),d.timer=null),d.tiper.innerHTML="请选择"+d._word.f[1]+"日期",d.linkReset(this.index),$(this).html('<span class="live_circle">'+this.innerHTML+'</span><span class="live_txt">'+d._word.f[d.op]+"</span>"),d.op++,d.cache=this.getAttribute("data-day"),d.doubleDate.start=this.getAttribute("data-day")):1==d.op&&this.getAttribute("data-day")!=d.cache?(null!=d.timer&&(window.clearTimeout(d.timer),d.timer=null),d.doubleDate.end=this.getAttribute("data-day"),$(this).html('<span class="live_circle">'+this.innerHTML+'</span><span class="live_txt">'+d._word.f[d.op]+"</span>"),d.tiper.style.display="none",d.linkOver(),d.linkColor("Return")):1==d.op&&this.getAttribute("data-day")==d.cache&&(null!=d.timer&&(window.clearTimeout(d.timer),d.timer=null),d.tiper.style.display="none",d.doubleDate.end=this.getAttribute("data-day"),this.querySelector(".live_txt").innerHTML=d._word.f[2],d.linkOver()))};this.linkColor("Return"),this.range&&"Oneway"==this.type&&this.range.length>=2&&this.linkRange("Oneway")},TicketDate.prototype.linkOver=function(a){function b(a){if(a){var b,c,d=new Date(a.replace(/-/g,"/")).getDay();switch(d){case 0:b="周日";break;case 1:b="周一";break;case 2:b="周二";break;case 3:b="周三";break;case 4:b="周四";break;case 5:b="周五";break;case 6:b="周六"}return c=a.split("-"),c[1]=c[1]<10?"0"+parseInt(c[1]):parseInt(c[1]),c[2]=c[2]<10?"0"+parseInt(c[2]):parseInt(c[2]),'<span class="dateNumber">'+c[1]+"月"+c[2]+"日</span> <span>"+b+"</span>"}}var c,d=$("#"+this.id+"-date .live_circle"),e=(d.length,this),f=[],g=_CalF.$("input",e.input);if(g.length||(g=_CalF.$("."+this.sClass1,document)),"Oneway"!=this.type){var h=_CalF.$("#"+this.id2,e.input);if("INPUT"==g[0].tagName)for(c=0;2>c;c++)f.push(d[c].parentNode.getAttribute("data-day")),g[c].value=d[c].parentNode.getAttribute("data-day");else 1==d.length?(f.push(d[0].parentNode.getAttribute("data-day")),f.push(d[0].parentNode.getAttribute("data-day")),g[0].innerHTML=b(d[0].parentNode.getAttribute("data-day")),e.doubleChosenDateOne=d[0].parentNode.getAttribute("data-day"),g[1]&&(e.doubleChosenDateTwo=d[0].parentNode.getAttribute("data-day"),g[1].innerHTML=b(d[0].parentNode.getAttribute("data-day")))):(f.push(d[0].parentNode.getAttribute("data-day")),f.push(d[1].parentNode.getAttribute("data-day")),g[0].innerHTML=b(d[0].parentNode.getAttribute("data-day")),e.doubleChosenDateOne=d[0].parentNode.getAttribute("data-day"),g[1]&&(e.doubleChosenDateTwo=d[1].parentNode.getAttribute("data-day"),g[1].innerHTML=b(d[1].parentNode.getAttribute("data-day"))));h&&(h.innerHTML=Math.round((new Date(f[1])-new Date(f[0]))/864e5))}else{var a=a||window.event,i=a.target||a.srcElement;"A"==i.tagName?(e.singleDate=i.getAttribute("data-day"),e.linkColor("Oneway",e.singleDate),"INPUT"==g[0].tagName?g[0].value=e.singleDate:g[0].innerHTML=e.singleDate):"SPAN"==i.tagName&&(e.singleDate=i.parentNode.getAttribute("data-day"),e.linkColor("Oneway",e.singleDate),"INPUT"==g[0].tagName?g[0].value=e.singleDate:g[0].innerHTML=e.singleDate)}e.timer=window.setTimeout(function(){e.op>=1?e.op=0:null,e.removeDate(),e.header.parentNode&&e.header.parentNode.removeChild(e.header),"function"==typeof e.fn&&(e.fn(),window.clearTimeout(e.timer),e.timer=null)},1e3)},TicketDate.prototype.linkRange=function(a){var b,c,d=_CalF.$(".live",this.dd);if(this.range&&"Oneway"==a&&this.range.length>=2){b=new Date(this.range[0].replace(/-/g,"/")),c=new Date(this.range[1].replace(/-/g,"/"));for(var e=0;e<d.length;e++)null!=d[e].getAttribute("data-day")&&(new Date(d[e].getAttribute("data-day").replace(/-/g,"/"))<b||new Date(d[e].getAttribute("data-day").replace(/-/g,"/"))>c)&&(d[e].className=d[e].className+" disabled")}},TicketDate.prototype.linkReset=function(a){var b=this,c=$(".live_circle"),d=_CalF.$(".live",this.dd);if(0==b.op){for(var e=0;e<c.length;e++){var f=c[e].parentNode.getAttribute("data-day"),g=f.split("-");c[e].parentNode.innerHTML=g[g.length-1]}for(e=0;a>e;e++)_CalF.addClass("disabled",d[e]);for(e=a+30;e<d.length;e++)_CalF.addClass("disabled",d[e]);return!1}};