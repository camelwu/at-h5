/*! asiatravel FE team at-h5-nodejs-----2016-05-19T15:21:43 */
!function(){function a(){$(window).load(function(){$("#status").fadeOut(),$("#preloader").delay(400).fadeOut("medium")})}function b(){function a(){if(window.location.search){var a=window.location.search.substring(1),b=a.split("&");g=b[0].split("=")[1];var c=b[2].split("=")[1],d=JSON.parse(window.localStorage.info),e=({start:d.CheckInDate.replace(/T.*/,""),end:d.CheckOutDate.replace(/T.*/,"")},d.CheckInDate.split("T")[0].split("-")),f=d.CheckOutDate.split("T")[0].split("-");switch(c){case"0":$("#flight-air").remove();break;case"1":new Scroller({id:"content3_CheckInDate",type:"dateTime",cont:"content3_CheckInDate",startDate:new Date(e[0],e[1],e[2]),num:2}),new Scroller({id:"content4_CheckInDate",type:"dateTime",cont:"content4_CheckInDate",startDate:new Date(f[0],f[1],f[2]),num:1});break;case"2":$("#content3").remove();new Scroller({id:"content3_CheckInDate",type:"dateTime",cont:"content3_CheckInDate",startDate:new Date(e[0],e[1],e[2]),num:2});break;case"3":$("#content4").remove();new Scroller({id:"content4_CheckInDate",type:"dateTime",cont:"content4_CheckInDate",startDate:new Date(f[0],f[1],f[2]),num:1})}h=b[3].split("=")[1],i=h,$(".all_num i").html(i),j=b[4].split("=")[1]}}function b(a){function b(a){var b=a;b.success?(localStorage.bookingID=b.data.bookingID,localStorage.bookingRefNo=b.data.bookingRefNo,window.location.href="../payment/payment.html?bookingRefNo="+b.data.bookingRefNo+"&type=Tour"):jAlert(b.message)}a.onclick=function(){if("rgb(221, 221, 221)"!=this.style.backgroundColor){this.style.backgroundColor="#ff9313";for(var a=document.querySelectorAll(".per_data"),c=document.querySelectorAll("#personal_data .list_inp2"),d=c[0].value,f=c[1].value,h=c[2].value,l=c[3].value,m=(document.querySelector(".all_num i").innerHTML,{Parameters:{PackageID:localStorage.packageID,CheckinDate:k.CheckInDate,CheckoutDate:k.CheckOutDate,HotelID:g,RoomID:j,ContactDetails:{Salutation:"Mr",FirstName:f,LastName:d,Email:l,ContactNo:{CountryCode:"65",PhoneNo:h},MemberID:localStorage.memberid},ChargeDetails:{CurrencyCode:"CNY",TotalPrice:i}},ForeEndType:3,Code:"0204"}),n=[],o=0;o<a.length;o++){var p={};if(p.Adult=k.roomDetails[o].adult,k.roomDetails[0].childWithBed){for(var q=[],r=0;r<k.roomDetails[0].childWithBed.length;r++)q.push(7);p.ChildwithBed=q}if(k.roomDetails[0].childWithOutBed){for(var s=[],t=0;t<k.roomDetails[0].childWithOutBed.length;t++)s.push(7);p.ChildwithoutBed=s}n.push(p)}m.Parameters.RoomDetails=n;for(var u=[],o=0;o<k.tours.length;o++){var v={};v.TourID=k.tours[o].tourID,v.TravelDate=k.tours[o].travelDate,v.TourSession="None",u.push(v),m.Parameters.Tours=u}for(var w=[],o=0;o<a.length;o++){for(var x=a[o].querySelectorAll(".trave-li-adu"),y=0;y<x.length;y++){var z=x[y].querySelectorAll(".list-adult"),A=z[0].value,B=z[1].value;if(!vlm.Utils.validate.engName(A))return void jAlert("请您输入英文的旅行人姓名");if(!vlm.Utils.validate.engName(B))return void jAlert("请您输入英文的旅行人姓名");var C={};C.RoomSeqNo=o+1,C.TravelerType="Adult",C.Salutation="Mr",C.FirstName=B,C.LastName=A,w.push(C)}for(var D=a[o].querySelectorAll(".trave-li-child"),t=0;t<D.length;t++){var E=a[o].querySelectorAll(".list-child"),F=E[0].value,G=E[1].value;if(!vlm.Utils.validate.engName(F))return void jAlert("请您输入英文的旅行人姓名");if(!vlm.Utils.validate.engName(G))return void jAlert("请您输入英文的旅行人姓名");var C={};C.RoomSeqNo=t+1,C.TravelerType="Child",C.Salutation="None",C.FirstName=G,C.LastName=F,C.DOB="2009-2-1",w.push(C)}}m.Parameters.Travelers=w,m.Parameters.Travelers[0].NationalityCode=$("#trave0 .country-btn").attr("data-code");var H=$(".list_inp_name");if(!vlm.Utils.validate.engName(H.eq(0).val()))return void jAlert("请您输入英文的联系人姓名");if(!vlm.Utils.validate.engName(H.eq(1).val()))return void jAlert("请您输入英文的联系人姓名");var I=$("#list_con_tel")[0].value,J=$("#list_con_email")[0].value;if(!vlm.Utils.validate.mobileNo(I))return void jAlert("请输入正确的手机号");if(!vlm.Utils.validate.email(J))return void jAlert("请输入正确的邮箱");var K=JSON.parse(window.localStorage.info),L=K.CheckInDate,M=K.CheckOutDate;if("block"==$("#flight-air").css("display")){var N={};if("block"==$("#content3").css("display")){var O=document.querySelector("#content3 .input_flight input").value,P=document.querySelector("#content3_CheckInDate").value,Q=P?P.split("-"):L;(O="")?N.ArrivalFlightNo="None":(N.ArrivalFlightNo=O,Q.indexOf("T")>-1?N.ArrivalDateTime=Q:N.ArrivalDateTime=Q[0]+"-"+Q[1]+"-"+Q[2]+"T"+Q[3]+":"+Q[4]+":00")}if("block"==$("#content4").css("display")){var R=document.querySelector("#content4 .input_flight input").value,S=document.querySelector("#content4_CheckInDate").value,T=S?S.split("-"):M;(R="")?N.ArrivalFlightNo="None":(N.DepartFlightNo=R,T.indexOf("T")>-1?N.DepartDateTime=T:N.DepartDateTime=T[0]+"-"+T[1]+"-"+T[2]+"T"+T[3]+":"+T[4]+":00")}m.Parameters.FlightDetails=N}e(),vlm.loadJson("",JSON.stringify(m),b)}}}var d={Parameters:{PackageID:localStorage.packageID},ForeEndType:3,Code:"0202"};vlm.loadJson("",JSON.stringify(d),c);for(var l=(window.location.search.substring(1).split("&")[5].split("=")[1],k.roomDetails.length),m=0;l>m;m++){var n=document.createElement("div");n.className="per_data",n.innerHTML='<span class="title"><i>房间'+(m+1)+"</i></span><ul></ul>",$("#per-room-wrap")[0].appendChild(n);for(var o=document.querySelectorAll(".per_data"),p=parseInt(k.roomDetails[m].adult),q=0;p>q;q++){var r=document.createElement("section");r.className="li_section_box",r.innerHTML='<li><span class="list_tit">成人'+(q+1)+'：</span><b class="add_icon"><a href="javascript:;" data-c-id="'+q+'" class="add-passager'+q+"\" ></a></b></span></li><ul id='trave"+q+'\'><li class="trave-li trave-li-adu"><span class="list_tit2 ">姓：</span><span class="list_con2"><input class="list_inp2 list-adult" type="text" placeholder="Zhang" data-elementName="firstName" /></span><span class="list_tit2 ">名：</span><span class="list_con2 name-inp"><input class="list_inp2 list-adult" type="text" placeholder="Xiaohua" data-elementName="lastName" /></span></li></ul>',o[m].querySelector("ul").appendChild(r),$(".add-passager"+q).on("click",function(){var a=$(this).attr("data-c-id");vlm.f_choice("trave"+a,"ht","traver","",!1,!1,null,null,null,null)})}var s=0,t=0,u=0;k.roomDetails[m].childWithOutBed&&(t=parseInt(k.roomDetails[m].childWithOutBed.length)),k.roomDetails[m].childWithBed&&(u=parseInt(k.roomDetails[m].childWithBed.length)),s=t+u;for(var v=0;s>v;v++){var r=document.createElement("section");r.className="li_section_box",r.innerHTML='<li><span class="list_tit">儿童'+(v+1)+'：</span><b class="add_icon"><a href="javascript:;" data-c-id="'+v+'" class="add-cpassage'+v+"\"></a></b></span></li><ul id='traveC"+v+'\'><li class="trave-li trave-li-child"><span class="list_tit2 ">姓：</span><span class="list_con2"><input class="list_inp2 list-child" type="text" placeholder="Zhang" data-elementName="firstName"  /></span><span class="list_tit2 ">名：</span><span class="list_con2"><input class="list_inp2 list-child" type="text" placeholder="Xiaohua" data-elementName="lastName" /></span></li></ul></section>',o[m].querySelector("ul").appendChild(r),$(".add-cpassage"+v).on("click",function(){var a=$(this).attr("data-c-id");vlm.f_choice("traveC"+a,"ht","traver","",!1,!1,null,null,null,null)})}}var w=$('<li class="clearFix countries-wrap"><b class="icons open-pho-tour"></b><span class="list_country fl">国籍：</span><div class="country-btn"  data-code="CN" data-tel-code="86">中国</div></li>');w.appendTo($("#trave0")),a(),$(".add-contact").click(function(){vlm.f_choice("contact","ht","contact","",!1,!1,null,null,null,null)}),b(f);var x=document.querySelector(".order-notice-btn"),y=!0;x.onclick=function(){y?(x.style.background="url(../images/ui/icons1.png) -26.6rem -0.4rem",x.style.backgroundSize="40rem 12rem",f.style.backgroundColor="#ddd",b(f),y=!1):(x.style.background="url(../images/ui/icons1.png) -23.7rem -0.4rem",x.style.backgroundSize="40rem 12rem",f.style.backgroundColor="#fdb330",f.style.color="#fff",y=!0)}}function c(a){var b=a;if(b.success){var c=b.data.packageName,d=b.data.packageRefNo;$(".sce-introduce-txt")[0].innerHTML=c+'<span class="sce-introduce-span">(产品编号：'+d+")</span>",$(".package-tit").html(c)}else jAlert(b.message)}function d(a){var b=a;if(b.success){var c=b.data,d=JSON.parse(localStorage.week),e=JSON.parse(localStorage.noon);c=$.extend({weekday:d,noon:e},c);for(var f,g=0;g<c.hotels[0].rooms.length;g++)c.hotels[0].rooms[g].roomID==j&&(f=g);var h,i,k=["<li>费用明细</li>","{% for(var i=0; i<hotels[0].rooms["+f+"].prices.length;i++){  if(hotels[0].rooms["+f+'].prices[i].category=="ADULT"){ %}',"<li>","<div>成人</div>","<div>￥{%=hotels[0].rooms["+f+"].prices[i].amountInCNY%}×{%=hotels[0].rooms["+f+"].prices[i].quantity%}人</div>","</li>","{% } else if(hotels[0].rooms["+f+'].prices[i].category=="CHILD"){ %}',"<li>","<div>儿童</div>","<div>￥{%=hotels[0].rooms["+f+"].prices[i].amountInCNY%}×{%=hotels[0].rooms["+f+"].prices[i].quantity%}人</div>","</li>","{% } %}","{% } %}"].join("");h="T"==l.CheckInDate.substr(9,1)?l.CheckInDate.substr(0,9):l.CheckInDate.substr(0,10),i="T"==l.CheckOutDate.substr(9,1)?l.CheckOutDate.substr(0,9):l.CheckOutDate.substr(0,10);var m=['<div class="sce-introduce-txt">{%=hotels[0].hotelName%}</div>',"{% for(var i=0;i<hotels[0].rooms.length;i++){ if(hotels[0].rooms[i].roomID=="+j+"){ %}",'<div class="detail-span">房型 {%=hotels[0].rooms[i].roomName%}'+l.roomDetails.length+"间</div>","{% } %}","{% } %}",'<div class="detail-span">'+h+" 至 "+i+" "+l.nightNum+"晚</div>"].join(""),n=["{% for(var i=0;i<tourInfos.length;i++){ %}","<div>",'<div class="sce-introduce-txt">{%=tourInfos[i].tourName%}</div>',"{% if(tourInfos[i].travelDateSpecified){ %}",'<div class="detail-span">游玩时间 {%=tourInfos[i].travelDate.substr(0,10)%} {%=weekday[i]%} {%=noon[i]%}</div>',"{% } %}",'<div class="detail-span">成人票 '+l.adultNum+"张</div>","{% if(JSON.parse(localStorage.info).childNum != 0){ %}",'<div class="detail-span">儿童票 '+l.childNum+"张</div>","{% } %}","</div>","{% } %}"].join(""),o=template(k,c),p=template(m,c),q=template(n,c);$("#fillDetail").html(o),$("#hotel_detail").html(p),$("#tour_detail").html(q),vlm.init()}else jAlert(b.message,"提示")}function e(){var a=new Date,b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),e=a.getHours(),f=a.getMinutes(),g=a.getSeconds();localStorage.orderTime=b+"-"+c+"-"+d+" "+e+":"+f+":"+g}var f=document.querySelector(".reserve"),g="",h=0,i=0,j="";a();var k=JSON.parse(localStorage.info);b();var l=JSON.parse(localStorage.info),m={Parameters:{PackageID:l.packageID,CheckinDate:l.CheckInDate,CheckoutDate:l.CheckOutDate,HotelID:g,RoomDetails:l.roomDetails,Tours:l.tours},ForeEndType:3,Code:"0208"};vlm.loadJson("",JSON.stringify(m),d),$(".open-close").click(function(){$("#detailBox").toggle(),$(".icons.de-close").toggleClass("de-open")})}();