/*! asiatravel FE team at-h5-nodejs-----2016-05-19T15:21:43 */
var roomUpGrade={CultureName:"zh-CN",eventHandler:function(a,b,c){return document.addEventListener?this.addHandler=function(a,b,c){a.addEventListener(b,c,!1)}:document.attachEvent?this.addHandler=function(a,b,c){a.attachEvent("on"+b,function(){c.call(a)})}:this.addHandler=function(a,b,c){a["on"+b]=c},this.addHandler(a,b,c),this},tAjax:function(a,b,c,d,e){var f={Parameters:b,ForeEndType:d,Code:c};return vlm.loadJson("",JSON.stringify(f),e),this},resetData:function(){var a=arguments[0],b=function(a){var b="";switch(a[0]){case"0":b="";break;case"1":b="一";break;case"2":b="二";break;case"3":b="三";break;case"4":b="四";break;case"5":b="五";break;case"6":b="六";break;default:b=""}return b},c=arguments[0].starRating;return a.starRating=b(c),a},dateDeal:function(){var a=/\d{4}[\/-](\d{1,2})[\/-](\d{1,2}).*/,b=a.exec(this.curParaObj.CheckInDate),c=a.exec(this.curParaObj.CheckOutDate),d=b[1]+"-"+b[2],e=c[1]+"-"+c[2],f=new Date(b[0].replace("-","/").replace("-","/").replace("T00:00:00","")),g=new Date(c[0].replace("-","/").replace("-","/").replace("T00:00:00","")),h=Math.abs(g-f)/1e3/60/60/24;return document.querySelector(".date-in").innerHTML=d.replace("-","月")+"日入住",document.querySelector(".date-out").innerHTML=e.replace("-","月")+"日离店",document.querySelector(".day-number").innerHTML="共"+h+"晚",this},addEvent:function(a){$(".hotelPic").click(function(){$(".gallery").hide(0),$(".portfolio-wide").hide(0)}),$(".swipebox").swipebox({useCSS:!0,hideBarsDelay:0})},callBack:function(){var a=roomUpGrade,b=["{% var imgs = tourInfos,htls=roomUpGrade.resetData(hotels[0]);imgl = imgs.length; if(imgl==0){ %}",'<a class="top-pic"><img src="../images/hotelDetailerrorpic.png" real-src="{%=htls.hotelPictureURL%}" class="hotelPic" alt="image"></a>',"{% }else{ %}",'<a href="{%=imgs[0].tourPictureURL%}" class="top-pic swipebox" title="1/{%=(imgl)%}"><img class="hotelPic" src="../images/hotelDetailerrorpic.png" real-src="{%=htls.hotelPictureURL%}"></a>','<div style="display: none;">',"{% for(var i=1;i < imgl;i++){ %}",'<a href="{%=imgs[i].tourPictureURL%}" class="swipebox" title="{%=(i+1)%}/{%=(imgl)%}"><img src="{%=imgs[i].tourPictureURL%}" alt="image"></a>',"{% } %}","</div>","{% } %}",'<ul id="hd_list" class="d-list">',"<li>",'<p class="d-score">','<b class="d-icon4"></b> {%=htls.location%}</p>',"</li>","<li>",'<p class="d-score">{%=htls.starRating%}星级</p>','{% if(data["freeWifi"]){ %}<b class="d-icon2"></b>{% } %}','<a href="{%=htls.moreInfoLink%}" class="d-icon1"></a>',"</li>","<li>",'<p class="d-p3 date-in">3月22入住</p><p class="d-p3 date-out" style="margin-left: 5px;">3月30离店</p>','<p class="d-p2 day-number">共8晚</p>',"</li>","<li style=height:auto>",'<ul class="room-list" id="room-list">',"</ul>","</li>","</ul>"].join(""),c=['<li class="hd-hotel" data-roomId="{%=roomID%}">','<img class="hd-choose" src="../images/ui/choose.png">','<div class="d-div3">','<p class="d-p5">{% if(includedBreakfast){ %}',"{%=roomName%}(含早)","{% }else{ %}","{%=roomName%}(无早)","{% } %}","</p>","</div>",'<p class="hd-price">',"<span>+￥</span>","<span>{%=markUp%}/间</span>","</p>","</li>"].join(""),d=arguments[0],a=roomUpGrade;if(d.success)if(0==d.data.hotels.length)jAlert("抱歉暂时没有数据","提示");else{var e=d.data.hotels[0].rooms,f=template(b,d.data),g=template(c,e);a.dataInfo=d.data,a.roomsData=e,$("#preloader").fadeOut(),$("#sc-content").html(f),$("#room-list").html(g);var h=d.data.bookingFormInfo.travelersInput;a.chooseRoom(h),a.dateDeal().delayLoadImage().addEvent(h)}else $("#preloader").fadeOut(),jAlert(d.message,"提示")},delayLoadImage:function(a){function b(a,b){var c=new Image;c.src=a,c.onload=function(){c.onload=null,b()}}var c=document.getElementsByClassName("hotelPic")[0],d=c.getAttribute("real-src");return b(d,function(){c.setAttribute("src",d)}),this},chooseRoom:function(a){for(var b=document.getElementsByClassName("hd-hotel"),c=(document.getElementsByClassName("hd-choose"),roomUpGrade),d=0;d<b.length;d++)!function(e){b[d].onclick=function(){for(var b=this.getAttribute("data-roomId"),d=0,e=0;e<c.roomsData.length;e++)if(c.roomsData[e].roomID==b){d=c.roomsData[e].totailPrice;break}document.location.href="fill-in-order-new.html"+document.location.search+"&totailPrice="+d+"&roomID="+b+"&travelersInput="+a}}(d);return this},createTags:function(){var a=this,b=JSON.parse(window.localStorage.getItem("info")),c=document.location.search.substring(0,document.location.search.indexOf("&")).replace(/\?/,"");return b.hotelID=c.substring(c.indexOf("=")+1),a.curParaObj=b,a.tAjax(a.requestUrl,b,"0208",3,a.callBack),this},init:function(){this.createTags()}};roomUpGrade.init();