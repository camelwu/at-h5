/*! asiatravel FE team at-h5-nodejs-----2016-05-19T16:09:38 */
function TicketDate(a){Calender.call(this,a)}TicketDate.prototype=new Calender,TicketDate.prototype.linkColor=function(a,b){var c,d,e=_CalF.$(".live",this.dd);if("Return"==a&&void 0==b){for(var f=0;f<e.length;f++)e[f].querySelector(".live_txt")&&"去程"==e[f].querySelector(".live_txt").innerHTML&&(c=f),e[f].querySelector(".live_txt")&&"返程"==e[f].querySelector(".live_txt").innerHTML&&(d=f);for(var g=c;d>g;g++)_CalF.addClass("yellow",e[g])}else for(var h=0;h<e.length;h++){var i=/(\d{1,2})/g.exec(e[h].innerHTML);e[h].getAttribute("data-day")==b?e[h].innerHTML='<span class="live_circle">'+i[0]+"</span>":i&&(e[h].innerHTML=null!=i[0]?i[0]:"")}return!1},TicketDate.prototype.linkRange=function(a,b){var c,d,e=_CalF.$(".live",this.dd);if(this.range.length){c=new Date(this.range[0].replace("-","/")),d=new Date(this.range[1].replace("-","/"));for(var f=0;f<e.length;f++)null!=e[f].getAttribute("data-day")&&(new Date(e[f].getAttribute("data-day").replace("-","/"))<c||new Date(e[f].getAttribute("data-day").replace("-","/"))>d)&&(e[f].className=e[f].className+" disabled")}},TicketDate.prototype.initialize=function(a){this.type=a.type,this.id=a.id,this._word=a._word,this.num=a.num,this.sClass1=a.sClass1,this.id2=a.id2,this.fn=a.fn,this.fn2=a.fn2,this.time=a.time,this.range=a.range,this.op=0,this.input=_CalF.$("#"+this.id),this.inputEvent(),this.outClick()},TicketDate.prototype.createContainer=function(a){var b=_CalF.$("#"+this.id+"-date"),c=this;b&&b.parentNode.removeChild(b);var d=this.container=document.createElement("div");if(d.id=this.id+"-date",d.style.position="absolute",d.style.zIndex=98,"input"===this.input.tagName){var e=_CalF.getPos(this.input);d.style.left=e.left+"px",d.style.top=e.bottom-1+"px",_CalF.bind(d,"click",this.stopPropagation)}else{d.style.background="#f5f4f9",d.style.overflow="auto",d.style.width=d.style.height="100%",d.style.left="0",d.style.top="0",d.style.paddingBottom="118px";var f=this.header=document.createElement("div");f.id=this.id+"-header",f.className="header",f.style.top=0,"Oneway"==this.type?f.style.height="45px":void 0,f.innerHTML="Oneway"==this.type?'<a id="close_list" href="javascript:void(0);" class="header-back"><i class="icons go-back"></i></a><h3>选择日期</h3>':'<a href="javascript:void(0);" class="icons header-back"></a><h3>选择日期</h3><p class="choose-week-tip">选择日期为出发地日期</p>',document.body.appendChild(f);var g=document.createElement("div");g.className="calendar",g.style.marginTop=("Oneway"==this.type,"3.68rem"),g.innerHTML=this._tempweek.join(""),d.appendChild(g);var h=this.tiper=document.createElement("div");h.id=this.id+"-tiper",h.className="tipers",h.innerHTML="请选择"+c._word.tip[0]+"日期","Oneway"==this.type?void 0:d.appendChild(h)}document.body.appendChild(d)},TicketDate.prototype.drawDate=function(a){var b,c,e,f,g,h,i,j,k,l,n=[],o=new Date,p=o.getFullYear(),q=o.getMonth(),r=o.getDate();for(this.dateWarp=b=document.createElement("div"),b.className="calendar",b.innerHTML=this._template.join(""),this.year=f=a.getFullYear(),this.month=g=a.getMonth()+1,this.date=h=a.getDate(),this.titleDate=c=_CalF.$(".title-date",b)[0],tims=this.time,l=document.createTextNode(f+"年"+g+"月"),c.appendChild(l),e=_CalF.$("dd",b)[0],i=new Date(f,g,0).getDate(),j=new Date(f,g-1,1).getDay(),k=0;j>k;k++)n.push("<a>&nbsp;</a>");for(k=1;i>=k;k++)p>f?n.push('<a class="disabled">'+k+"</a>"):f==p?q+1>g?n.push('<a class="live disabled">'+k+"</a>"):g==q+1?r>k?n.push('<a class="live disabled">'+k+"</a>"):(m=10>g?"0"+g:g,d=10>k?"0"+k:k,tims[f+"-"+m+"-"+d]&&"Return"==this.type?pstr='<a class="live" data-day="'+f+"-"+g+"-"+k+'"><span class="live_circle">'+k+'</span><span class="live_txt">'+tims[f+"-"+m+"-"+d]+"</span></a>":tims[f+"-"+m+"-"+d]&&"Oneway"==this.type?pstr='<a class="live" data-day="'+f+"-"+g+"-"+k+'"><span class="live_circle">'+k+"</span></a>":pstr='<a class="live" data-day="'+f+"-"+g+"-"+k+'">'+k+"</a>",k==r?n.push('<a class="live" data-day="'+f+"-"+g+"-"+k+'">今天</a>'):n.push(pstr)):n.push('<a class="live" data-day="'+f+"-"+g+"-"+k+'">'+k+"</a>"):f>p&&n.push('<a class="live" data-day="'+f+"-"+g+"-"+k+'">'+k+"</a>");e.innerHTML=n.join(""),this.container.appendChild(b);var s=!!window.ActiveXObject&&!window.XMLHttpRequest;s&&b.appendChild(this.createIframe()),this.linkOn(),this.linkRange()},TicketDate.prototype.linkOn=function(){var a,b=_CalF.$(".live",this.dd),c=b.length,d=this;for(a=0;c>a;a++)b[a].index=a,b[a].onclick=function(a){"input"===d.input.tagName?($(this).css("border","1px solid #ff6a2f").css("z-index","9999999"),$(this).siblings().css("border","").css("z-index","")):this.className.indexOf("disabled")>-1||("Oneway"==d.type?d.linkOver(a):0==d.op?(d.tiper.innerHTML="请选择"+d._word.tip[1]+"日期",d.linkReset(this.index),$(this).html('<span class="live_circle">'+this.innerHTML+'</span><span class="live_txt">'+d._word.tip[d.op]+"</span>"),d.op++,d.cache=this.getAttribute("data-day")):1==d.op&&this.getAttribute("data-day")!=d.cache?($(this).html('<span class="live_circle">'+this.innerHTML+'</span><span class="live_txt">'+d._word.tip[d.op]+"</span>"),d.op>=1?d.op=0:null,d.tiper.style.display="none",d.linkOver(),d.linkColor("Return")):1==d.op&&this.getAttribute("data-day")==d.cache&&(d.tiper.innerHTML=d._word.tip[1]+"日期需大于"+d._word.tip[0]+"日期"))};this.linkColor("Return")},TicketDate.prototype.linkOver=function(a){var b=$("#"+this.id+"-date .live_circle"),c=(b.length,this),d=[],e=_CalF.$("input",c.input);if(e.length||(e=document.querySelector("#"+this.id)?_CalF.$("."+this.sClass1,document.querySelector("#"+this.id)):_CalF.$("."+this.sClass1,document)),"Oneway"!=this.type){var f=_CalF.$("#"+this.id2,c.input),g={};"INPUT"==e[0].tagName?(d.push(b[0].parentNode.getAttribute("data-day")),d.push(b[1].parentNode.getAttribute("data-day")),g.start=b[0].parentNode.getAttribute("data-day"),e[1]&&(g.end=b[1].parentNode.getAttribute("data-day")),"function"==typeof c.fn2&&c.fn2(g)):(d.push(b[0].parentNode.getAttribute("data-day")),d.push(b[1].parentNode.getAttribute("data-day")),g.start=b[0].parentNode.getAttribute("data-day"),e[0].innerHTML=b[0].parentNode.getAttribute("data-day"),e[1]&&(e[1].innerHTML=b[1].parentNode.getAttribute("data-day"),g.end=b[1].parentNode.getAttribute("data-day"))),f&&(f.innerHTML=Math.round((new Date(d[1])-new Date(d[0]))/864e5))}else{var a=a||window.event,h={},i=a.target||a.srcElement,j="";"A"==i.tagName?(j=i.getAttribute("data-day"),c.linkColor("Oneway",j),h.start=i.getAttribute("data-day"),e[0].innerHTML=j):"SPAN"==i.tagName&&(j=i.parentNode.getAttribute("data-day"),h.start=i.parentNode.getAttribute("data-day"),c.linkColor("Oneway",j),e[0].innerHTML=j),"function"==typeof c.fn2&&c.fn2(h)}c.timer=window.setTimeout(function(){c.removeDate(),c.header.parentNode&&c.header.parentNode.removeChild(c.header),"function"==typeof c.fn&&(c.fn(),window.clearTimeout(c.timer),c.timer=null)},100)},TicketDate.prototype.linkReset=function(a){var b=this,c=$(".live_circle"),d=_CalF.$(".live",this.dd);if(0==b.op){for(var e=0;e<c.length;e++){var f=c[e].parentNode.getAttribute("data-day"),g=f.split("-");c[e].parentNode.innerHTML=g[g.length-1]}for(e=0;a>e;e++)_CalF.addClass("disabled",d[e]);for(e=a+30;e<d.length;e++)_CalF.addClass("disabled",d[e]);return!1}};