/*! asiatravel FE team at-h5-nodejs-----2016-05-19T16:09:38 */
var ticketSingle={CultureName:"zh-CN",requestUrl:"",dateInit:function(a){var b={start:this.backParaObj.DepartDate};new TicketDate({id:"dateIcon",num:13,time:b,sClass1:"num-wrap",type:"Oneway",fn:this.dateChangeRender});document.querySelector(".single-ticket-input").innerHTML=this.returnWeek(a.DepartDate)},addHandler:function(a,b,c){document.addEventListener?this.addHandler=function(a,b,c){a.addEventListener(b,c,!1)}:document.attachEvent?this.addHandler=function(a,b,c){a.attachEvent("on"+b,function(){c.call(a)})}:this.addHandler=function(a,b,c){a["on"+b]=c},this.addHandler(a,b,c)},dateChangeRender:function(){var a=ticketSingle,b=document.querySelector(".num-wrap").getAttribute("data-date"),c=/(\d{4})-(\d{1,2}-\d{1,2})/g,d=c.exec(b),e=function(a){var c,d=new Date(b.replace(/-/g,"/")).getDay();switch(d){case 0:c="周日";break;case 1:c="周一";break;case 2:c="周二";break;case 3:c="周三";break;case 4:c="周四";break;case 5:c="周五";break;case 6:c="周六"}return c};d[1]=parseInt(d[1])<10?"0"+parseInt(d[1]):parseInt(d[1]),d[2]=parseInt(d[2])<10?"0"+parseInt(d[2]):parseInt(d[2]),document.querySelector(".single-ticket-input").innerHTML=d[1]+"&nbsp;<span>"+e((new Date).getFullYear()+"-"+d[1]+"-"+d[2])+"</span>",a.backParaObj.DepartDate=b;var f=vlm.setUrlPara("","DepartDate",a.backParaObj.DepartDate);window.location.href=f},tAjax:function(a,b,c,d,e,f){var g={Parameters:b,ForeEndType:d,Code:c};a=a?a:"",f?vlm.loadJson(a,JSON.stringify(g),e,!1,!1,f):vlm.loadJson(a,JSON.stringify(g),e)},storageUtil:{set:function(a,b){var c=window.localStorage;c.setItem(a,JSON.stringify({data:b}))},get:function(a){var b=window.localStorage,c=b.getItem(a),d=JSON.parse(c);return JSON.stringify(d.data)}},returnWeek:function(a){var b,c=new Date(a.replace(/-/g,"/")).getDay();switch(c){case 0:b="周日";break;case 1:b="周一";break;case 2:b="周二";break;case 3:b="周三";break;case 4:b="周四";break;case 5:b="周五";break;case 6:b="周六"}return array=a.split("-"),array[1]=array[1]<10?"0"+parseInt(array[1]):parseInt(array[1]),array[2]=array[2]<10?"0"+parseInt(array[2]):parseInt(array[2]),array[1]+"-"+array[2]+" <span>"+b+"</span>"},parseUrlPara:function(a,b){var b=b||!1,c=/([^=&?]+)=([^=&?]+)/g,d={};return a.replace(c,function(){var a=arguments;d[a[1]]=b?decodeURIComponent(a[2]):a[2]}),d},preAndNex:function(){var a=document.querySelectorAll(".unit"),b=this;ticketSingle.addHandler(a[0],"click",function(){var c,d=document.querySelector(".num-wrap").getAttribute("data-date"),e=new Date(d.replace(/-/g,"/"));c=new Date(e.setDate(e.getDate()-1));var f=c.getMonth()+1<10?"0"+parseInt(c.getMonth()+1):c.getMonth()+1,g=c.getDate()<10?"0"+parseInt(c.getDate()):c.getDate();c=c.getFullYear()+"-"+f+"-"+g;(new Date).getFullYear()+1+"/"+((new Date).getMonth()+1)+"/"+(new Date).getDate();if(new Date(c.replace(/-/g,"/")+" 23:59:59")>=new Date){var h=ticketSingle.returnWeek(c);a[0].className="unit previous-day",document.querySelector(".single-ticket-input").innerHTML=h,b.backParaObj.DepartDate=c,b.backParaObj.pageNo=1,b.backParaObj.pageSize=10,document.querySelector("#preloader").style.display="block";var i=vlm.setUrlPara("","DepartDate",c);window.location.href=i}else a[0].className="unit previous-day disabled-date-choose"}),ticketSingle.addHandler(a[1],"click",function(c){var d,e=document.querySelector(".num-wrap").getAttribute("data-date"),f=new Date(e.replace(/-/g,"/"));d=new Date(f.setDate(f.getDate()+1));var g,h,i=d.getMonth()+1<10?"0"+parseInt(d.getMonth()+1):d.getMonth()+1,j=d.getDate()<10?"0"+parseInt(d.getDate()):d.getDate();d=d.getFullYear()+"-"+i+"-"+j;var k=(new Date).getFullYear()+1+"/"+((new Date).getMonth()+1)+"/"+(new Date).getDate();new Date(d.replace(/-/g,"/")+" 00:00:00")>new Date&&new Date(d.replace(/-/g,"/"))<new Date(k+" 00:00:00")?(g=ticketSingle.returnWeek(d),a[0].className="unit previous-day",document.querySelector(".single-ticket-input").innerHTML=g,b.backParaObj.DepartDate=d,b.backParaObj.pageNo=1,b.backParaObj.pageSize=10,document.querySelector("#preloader").style.display="block",h=vlm.setUrlPara("","DepartDate",d),window.location.href=h):new Date(d.replace(/-/g,"/")+" 00:00:00")-new Date(k+" 00:00:00")==0?(g=ticketSingle.returnWeek(d),a[0].className="unit previous-day",document.querySelector(".single-ticket-input").innerHTML=g,b.backParaObj.DepartDate=d,b.backParaObj.pageNo=1,b.backParaObj.pageSize=10,document.querySelector("#preloader").style.display="block",a[1].className="unit next-day disabled-date-choose",h=vlm.setUrlPara("","DepartDate",d),window.location.href=h):a[1].className="unit next-day disabled-date-choose"})},renderHandler:function(a){var b,a=a,c=ticketSingle,d=document.querySelector(".air-tickets-detail-wrapper"),e=document.querySelector(".flight-result-tip"),f="";f=c.isClearAll,b=window.localStorage,document.querySelector("#preloader").style.display="none",a.success&&200==a.code&&a.data.flightInfos.length>0?(document.querySelector(".tip-button-para").style.display="none",e.style.display="none",c.lastBackData=a,c.pageNo=a.data.pageNo,c.pageCount=a.data.pageCount,b.setItem("flightListData",JSON.stringify(a.data.flightInfos)),c.changeFlightList(a,f),c.eventHandler(),c.taxDeal(a.data.flightInfos)):0==a.success&&a.message.indexOf("greater")>-1?(document.querySelector(".no-flight-word").innerHTML="未搜到航班信息，请扩大搜索范围!",document.querySelector(".tip-button-para").style.display="block",d.innerHTML="",e.style.display="block",c.timer7=window.setTimeout(function(){e.style.display="none",window.clearTimeout(c.timer7),c.timer7=null},3e3)):(e.style.display="none",c.isClearAll=!0,d.innerHTML="",document.querySelector(".tip-button-para").style.display="block")},taxDeal:function(a){for(var b=[],c=[],d=[],e=[],f=0;f<a.length;f++)0==a[f].totalTaxAmountADT?c.push(a[f]):b.push(a[f]);d=a.sort(function(a,b){return parseFloat(a.totalFareAmountExc)-parseFloat(b.totalFareAmountExc)}),e=d.reverse(),this.cacheTypeData={taxData:b,freeTaxData:c,priceDesc:d,priceAsic:e}},checkTip:function(){for(var a=document.querySelectorAll(".detail-list li"),b="",c=document.querySelectorAll("#time-modal li"),d="",e=document.querySelectorAll("#price-modal li"),f="",g=0;g<a.length;g++)a[g].className.indexOf("active")>-1&&(b+=g);for(var h=0;h<c.length;h++)c[h].className.indexOf("active")>-1&&(d+=h);for(var i=0;i<e.length;i++)e[i].className.indexOf("active")>-1&&(f+=i);return{left:b,middle:d,right:f}},timeCut:function(a){var b=/\d{4}-\d{2}-\d{2}T(\d{2}):(\d{2}):\d{2}/g,c=b.exec(a);return c[1]+":"+c[2]},returnTransferCity:function(a){var b="";return a.length<2?b="":2==a.length?b='<span class="air-port-word">转'+a[0].cityNameTo+"</span>":a.length>=3&&(b='<span class="air-port-word">中转'+(a.length-1)+"次</span>"),b},changeFlightList:function(a,b){if(a){var c,a=a,d=ticketSingle,e=document.querySelector(".air-tickets-detail-wrapper"),f="",g="",h="",i="";e.innerHTML=1==b?"":e.innerHTML;var j=function(){var b="";return b+="domestic"==d.backParaObj.interNationalOrDomestic?'<div class="price-tax single-side"><div class="price-info price-info-domestic"><span class="price-icon">￥</span><span class="single-price-pull-right">'+a.data.flightInfos[k].totalFareAmountADT+"</span></div></div>":"true"==d.backParaObj.hasTax?'<div class="price-tax single-side"><div class="price-info"><span class="price-icon">￥</span><span class="single-price-pull-right">'+a.data.flightInfos[k].totalFareAmountExc+'</span></div><div class="single-price-tax-info"><span class="tax-word">含税总价</div></div>':'<div class="price-tax single-side"><div class="price-info"><span class="price-icon">￥</span><span class="single-price-pull-right">'+a.data.flightInfos[k].totalFareAmountADT+'</span></div><div class="single-price-tax-info"><span class="tax-word">税费</span> ￥'+a.data.flightInfos[k].totalTaxAmountADT+"</div>"};c="";for(var k=0;k<a.data.flightInfos.length;k++)f=1==a.data.flightInfos[k].isReturnShareFlight?'&nbsp;|&nbsp;<span class="green-tip">共享</span>&nbsp;|':"",g=1==a.data.flightInfos[k].isLeaveStop?' | <span class="green-tip">经停</span>':"",i=a.data.flightInfos[k].flightLeaveSpacingDay>=1?"+"+a.data.flightInfos[k].flightLeaveSpacingDay+"天":"",h=d.returnTransferCity(a.data.flightInfos[k].segmentsLeave),c+='<li class="air-tickets-detail seat-detail" data-set-id="'+a.data.flightInfos[k].setID+'"><div class="time-airport" ><div class = "go" ><div class = "go-info" ><div class="start-time-info" ><span class= "time-number" >'+d.timeCut(a.data.flightInfos[k].flightLeaveStartDate)+'</span><span class="air-port-word">'+a.data.flightInfos[k].segmentsLeave[0].airportNameFrom+a.data.flightInfos[k].segmentsLeave[0].termDepart+'</span ></div><div class="total-time-info"><span class="time-hour-minute">'+parseInt(a.data.flightInfos[k].segmentsLeaveTotalTravelTime/60)+"h"+a.data.flightInfos[k].segmentsLeaveTotalTravelTime%60+'m</span><span class="arrow-time"></span>'+h+'</div ><div class= "end-time-info" ><span class="tip-add-days" >'+i+'</span><span class="time-number">'+d.timeCut(a.data.flightInfos[k].flightLeaveEndDate)+'</span ><span class= "air-port-word" >'+a.data.flightInfos[k].segmentsLeave[a.data.flightInfos[k].segmentsLeave.length-1].airportNameTo+a.data.flightInfos[k].segmentsLeave[0].termArrive+'</span></div ></div><p class="small-info"></span >'+a.data.flightInfos[k].segmentsLeave[0].operatingCarrierName+a.data.flightInfos[k].segmentsLeave[0].operatingCarrierCode+a.data.flightInfos[k].segmentsLeave[0].flightNo+"&nbsp;|&nbsp;"+a.data.flightInfos[k].segmentsLeave[0].cabinClassName+f+g+"</p></div ></div>"+j()+"</li>";e.innerHTML+=c,this.loadMoreHandler(a.data.pageNo,a.data.pageCount),this.eventHandler()}},loadMoreHandler:function(a,b){var c=document.getElementById("loadMore");c.innerHTML="点击加载更多",c.style.display="block",a==b&&(c.innerHTML="没有更多数据了")},loadMoreBtnEvent:function(){var a=document.getElementById("loadMore");this.addHandler(a,"click",function(){ticketSingle.loadMoreData()})},callRender:function(a){var b={},c=ticketSingle;switch(b.IsDirectFlight="unlimitedPlane"==a.directFly?"false":"true",b.IsHideSharedFlight="hideShareFlight"==a.IsHideSharedFlight?"false":"true",b.DepartStartHour=a.filterTime.substr(0,2),b.DepartEndHour=a.filterTime.substr(2,2),b.CabinClass=a.CabinClass,b.pageNo=1,b.pageSize=10,a.paraMiddle){case"directFirst":b.PriorityRule=1;break;case"lowPriceFirst":b.PriorityRule=2;break;case"shortTimeFirst":b.PriorityRule=3;break;case"earlyAsLate":b.IsDesc="true";break;case"lateAsEarly":b.IsDesc="false";break;default:b.PriorityRule=0}for(var d in b)c.backParaObj[d]=b[d];document.querySelector("#preloader").style.display="block",c.tAjax(this.requestUrl,c.backParaObj,"3001",3,c.renderHandler);var e=c.checkTip();c.initLeftState.left!=e.left?document.querySelector("#fo_sc i").className="red-tip":document.querySelector("#fo_sc i").className="",c.initLeftState.middle!=e.middle?document.querySelector("#fo_ra i").className="red-tip":document.querySelector("#fo_ra i").className="",c.initLeftState.right!=e.right?document.querySelector("#fo_lo i").className="red-tip":document.querySelector("#fo_lo i").className=""},alertNoFlightNotice:function(a,b){var c,d=document.createElement("div"),e=document.querySelector(".all-elements"),f=ticketSingle,g="single"==b?"direction-single":"direction-double";d.className="no-flight-notice",d.innerHTML='<header class="big-title"><i class="fl close-no-flight"></i><span class="set-place">'+a.fromCity+'</span><i class="'+g+'"></i><span class="to-place">'+a.toCity+'</span></header><div class="tip-button-para"><p class="no-flight-word">没有找到符合条件的航班!</p></div>',e.appendChild(d),c=document.querySelector(".close-no-flight"),f.addHandler(c,"click",function(){e.removeChild(d)})},eventHandler:function(){for(var a=document.querySelectorAll(".seat-detail"),b=ticketSingle,c=document.querySelector("#r-shadow"),d=document.querySelector("#filter-modal"),e=document.querySelector("#time-modal"),f=document.querySelector("#price-modal"),g=0;g<a.length;g++)this.addHandler(a[g],"click",function(){b.storageUtil.set("currentListPara",b.backParaObj),document.location.href="ticket_seat_choose.html?setId="+this.getAttribute("data-set-id")+"&RouteType="+b.backParaObj.RouteType+"&hasTax="+b.backParaObj.hasTax+"&CabinClass="+b.backParaObj.CabinClass+"&NumofAdult="+b.backParaObj.NumofAdult+"&NumofChild="+b.backParaObj.NumofChild+"&interNationalOrDomestic="+b.backParaObj.interNationalOrDomestic});this.addHandler(c,"click",function(){"0px"==d.style.bottom?(d.style.transition="all 300ms ease-in",d.style.webkitTransition="all 300ms linear",d.style.bottom="-126%"):"0px"==e.style.bottom?(e.style.transition="all 300ms ease-in",e.style.webkitTransition="all 300ms linear",e.style.bottom="-126%"):"0px"==f.style.bottom&&(f.style.transition="all 300ms ease-in",f.style.webkitTransition="all 300ms linear",f.style.bottom="-126%"),this.style.display="none"})},taxHandler:function(){var a=document.querySelector("#price-modal");this.addHandler(a,"click",function(a){var b=document.querySelector("#r-shadow"),c=ticketSingle,a=a||window.event,d=d||a.srcElement,e=d.parentNode.querySelectorAll("li"),f={data:{flightInfos:[]}};if("noTax"==d.getAttribute("data-i"))if(0==c.cacheTypeData.freeTaxData.length)jAlert("当前航班均含税，换种条件试试!","",function(){});else{f.data.flightInfos=c.cacheTypeData.freeTaxData,c.changeFlightList(f,!0);for(var g=0,h=e.length;h>g;g++)e[g].className=e[g]==d?"price-modal-item active":"price-modal-item"}else if("hasTax"==d.getAttribute("data-i")){f.data.flightInfos=c.cacheTypeData.taxData,c.changeFlightList(f,!0);for(var g=0,h=e.length;h>g;g++)e[g].className=e[g]==d?"price-modal-item active":"price-modal-item"}else if("priceHighToLow"==d.getAttribute("data-i")){f.data.flightInfos=c.cacheTypeData.priceDesc,c.changeFlightList(f,!0);for(var g=0,h=e.length;h>g;g++)e[g].className=e[g]==d?"price-modal-item active":"price-modal-item"}else if("priceLowToHigh"==d.getAttribute("data-i")){f.data.flightInfos=c.cacheTypeData.priceAsic,c.changeFlightList(f,!0);for(var g=0,h=e.length;h>g;g++)e[g].className=e[g]==d?"price-modal-item active":"price-modal-item"}this.style.transition="all 300ms ease-in",this.style.webkitTransition="all 300ms linear",this.style.bottom="-126%",b.style.display="none"})},loadMoreData:function(){var a=ticketSingle,b=document.getElementById("loadMore");a.pageNo>=a.pageCount?($("#loadMore").fadeOut(1e3),jAlert('<div class="no-more-flight-tip">没有更多航班信息了</div>',"",function(){})):a.pageNo<a.pageCount&&(a.isClearAll=!1,a.backParaObj.pageNo++,b.innerHTML="正在加载...",a.tAjax(this.requestUrl,a.backParaObj,"3001",3,a.renderHandler,!0))},handler1:function(a){var b=ticketSingle;b.backParaObj=a,document.querySelector("#preloader").style.display="block",b.tAjax(b.requestUrl,b.backParaObj,"3001",3,b.renderHandler)},handler2:function(a){var b=ticketSingle;b.backParaObj=a,b.changeFlightList(b.lastBackData,!0)},fixColor:function(){var a=(new Date).getFullYear()+1+"/"+((new Date).getMonth()+1)+"/"+(new Date).getDate(),b=document.querySelectorAll(".unit");new Date(this.backParaObj.DepartDate+" 00:00:00")-new Date(a+" 00:00:00")==0&&(b[1].className="unit next-day disabled-date-choose")},init:function(){var a=this.parseUrlPara(document.location.search,!0);document.querySelector(".set-place").innerHTML=a.fromCity,document.querySelector(".to-place").innerHTML=a.toCity,document.querySelector(".num-wrap").setAttribute("data-date",a.DepartDate),this.tripType=a.interNationalOrDomestic,a.NumofAdult=parseInt(a.NumofAdult),a.NumofChild=parseInt(a.NumofChild),a.PriorityRule=parseInt(a.PriorityRule),a.pageNo=parseInt(a.pageNo),a.pageSize=parseInt(a.pageSize),this.backParaObj=a,this.isClearAll=!0,this.tAjax(this.requestUrl,a,"3001",3,this.renderHandler),this.fixColor(),this.dateInit(a),this.preAndNex(),conditionalFiltering.init(this.tripType,this.backParaObj.RouteType,this.backParaObj,this.handler1,this.handler2,this),this.eventHandler(),this.taxHandler(),this.initLeftState=this.checkTip(),this.loadMoreBtnEvent()}};ticketSingle.init();