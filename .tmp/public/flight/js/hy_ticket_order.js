/*! asiatravel FE team at-h5-nodejs-----2016-05-19T16:09:38 */
var ticketOrder={requestUrl:"",addHandler:function(a,b,c){document.addEventListener?ticketOrder.addHandler=function(a,b,c){a.addEventListener(b,c,!1)}:document.attachEvent?ticketOrder.addHandler=function(a,b,c){a.attachEvent("on"+b,function(){c.call(a)})}:ticketOrder.addHandler=function(a,b,c){a["on"+b]=c},ticketOrder.addHandler(a,b,c)},loadingFade:function(){$(window).load(function(){$("#status-f").fadeOut(),$("#preloader").delay(400).fadeOut("medium")})},telSlider:function(){$(".custom-select").each(function(){var a=$(this).attr("class"),b=($(this).attr("id"),$(this).attr("name"),'<div class="'+a+'">');b+='<span class="custom-select-trigger">'+$(this).attr("placeholder")+"</span>",b+='<div class="custom-options">',$(this).find("option").each(function(){b+='<span class="custom-option '+$(this).attr("class")+'" data-value="'+$(this).attr("value")+'">'+$(this).html()+"</span>"}),b+="</div></div>",$(this).wrap('<div class="custom-select-wrapper"></div>'),$(this).hide(),$(this).after(b)}),$(".custom-option:first-of-type").hover(function(){$(this).parents(".custom-options").addClass("option-hover")},function(){$(this).parents(".custom-options").removeClass("option-hover")}),$(".custom-select-trigger").on("click",function(){$(this).parents(".custom-select").toggleClass("opened")}),$(".custom-option").on("click",function(){$(this).parents(".custom-select-wrapper").find("select").val($(this).data("value")),$(this).parents(".custom-options").find(".custom-option").removeClass("selection"),$(this).addClass("selection"),$(this).parents(".custom-select").removeClass("opened"),$(this).parents(".custom-select").find(".custom-select-trigger").text($(this).text())})},storageUtil:{set:function(a,b){var c=window.localStorage;c.setItem(a,JSON.stringify({data:b}))},get:function(a){var b=window.localStorage,c=b.getItem(a),d=JSON.parse(c);return null!=d?d.data:void 0}},timeCut:function(a){var b=/\d{4}-\d{2}-\d{2}T(\d{2}):(\d{2}):\d{2}/g,c=b.exec(a);return c[1]+":"+c[2]},addEvent:function(){for(var a=document.querySelector(".close-buy-tip"),b=document.querySelector(".tip-word"),c=(document.querySelector(".back-meal-close"),document.querySelector(".go-line-outer")),d=document.querySelector("#confirm-button"),e=document.querySelector(".summary-cost-shadow-two"),f=document.querySelector(".detail-tangle"),g=document.querySelector(".summary-cost-modal"),h=document.querySelector(".summary-cost-shadow-one"),i=document.querySelector(".trigger-button"),j=(document.querySelector(".trigger-button2 "),document.querySelector(".add-Passenger"),document.querySelector(".contact-person"),document.querySelector("#passenger-list")),k=document.querySelectorAll(".next-icon"),l=(document.querySelectorAll(".icon-add"),JSON.parse(window.localStorage.ticketSearchedInfo).data.NumofAdult),m=JSON.parse(window.localStorage.ticketSearchedInfo).data.NumofChild,n=this,o=0;o<k.length;o++)this.addHandler(k[o],"click",function(){document.location.href="../user/user-choiceAir.html?type=edit&NumofAdult="+n.costFinaListData.NumofAdult+"&NumofChild="+n.costFinaListData.NumofChild});this.addHandler(i,"click",function(){$("#preloader").show(),$("#status-f").show(),$("#status-f").delay(400).fadeOut("medium"),$("#preloader").delay(400).fadeOut("medium"),document.querySelector(".summary-cost-shadow-two").style.display="block",document.querySelector(".ticket-detail-modal").style.display="block"}),$(".match span.trigger-button2").on("click",function(){$("#preloader").show(),$("#status-f").show(),$("#status-f").delay(400).fadeOut("medium"),$("#preloader").delay(400).fadeOut("medium"),document.querySelector(".summary-cost-shadow-two").style.display="block",document.querySelector(".ticket-detail-modal").style.display="block"}),this.addHandler(d,"click",function(){var a=a||window.event,b=(a.target||a.srcElement,ticketOrder),c={};b.backParaObj=b.reverseInformation;window.localStorage.travellerInfo_selected;if(!window.localStorage.travellerInfo_selected)return void jAlert("请选择"+l+"名成人,"+m+"名儿童!","提示");var d=JSON.parse(window.localStorage.travellerInfo_selected),e={},f=j.querySelectorAll("LI"),g=[],h=0,i=0;if(f)for(var k=0;k<f.length;k++)for(var n=f[k].querySelector(".passport-number").value,o=0;o<d.length;o++)d[o].CertificateInfo.IdNumber==n&&g.push(d[o]);for(var p=0;p<g.length;p++)"ADULT"==g[p].PassengerType&&h++,"CHILD"==g[p].PassengerType&&i++;if(h!=l||i!=m)return void jAlert("请选择"+l+"名成人,"+m+"名儿童!","提示");if(b.backParaObj.TravellerInfo=g,c=window.localStorage.contact_selected?JSON.parse(window.localStorage.contact_selected):{ContactNumber:"",CountryNumber:"",Email:"",FirstName:"",LastName:"",MobilePhone:"",SexCode:"Mr"},e.FirstName=document.querySelector("#first-name").value,e.LastName=document.querySelector("#last-name").value,e.Email=document.querySelector("#email-label").value,e.MobilePhone=document.querySelector("#tel-num").value,e.CountryNumber=document.querySelector("#country-code").innerHTML.substring(1),""==e.FirstName)return void jAlert("请输入姓!","提示");if(""==e.LastName)return void jAlert("请输入名!","提示");if(""==e.Email)return void jAlert("请输入邮箱!","提示");if(""==e.Email)return void jAlert("请输入邮箱!","提示");if(!/^(\w-*_*\.*)+@(\w-?)+(\.\w{2,})+$/.test(e.Email))return void jAlert("请输入正确格式邮箱!","提示");if(""==e.MobilePhone)return void jAlert("请输入手机号!","提示");if(!/^1\d{10}$/.test(e.MobilePhone))return void jAlert("请输入正确格式手机号!","提示");for(var q in e)c[q]=e[q];window.localStorage.contact_selected=JSON.stringify(c),b.backParaObj.ContactDetail=c,$("#preloader").show(),$("#status-f").show(),b.tAjax(b.requestUrl,b.backParaObj,"3002",3,function(a){$("#preloader").hide(),$("#status-f").hide();var b=ticketOrder,d=document.querySelector(".order-result-tip"),a=a;if(a.success&&200==a.code){var e={};e.orderTime=new Date,e.TotalPrice=b.reverseInformation.TotalPrice,e.CurrencyCode=b.reverseInformation.CurrencyCode,e.NumofAdult=b.reverseInformation.WapOrder.NumofAdult,e.NumofChild=b.reverseInformation.WapOrder.NumofChild,e.RouteType=b.reverseInformation.WapOrder.RouteType,e.flightInfo=b.orderFlightData,e.TravellerInfo=g,e.ContactDetail=c,e.bookingID=a.data.bookingID,e.bookingRefNo=a.data.bookingRefNo,b.storageUtil.set("orderResultInfo",e),document.location.href="../payment/payment.html?bookingRefNo="+e.bookingRefNo+"&type=Flight"}else a.message.indexOf("失败")>-1&&a.message.indexOf("重新")>-1?jConfirm("预订失败,需要重新预订?","提示",function(a){1==a&&window.history.go(-2)},"确定","取消"):a.message.indexOf("过期")>-1?jConfirm("航班信息过期,需要重新预订?","提示",function(a){1==a&&window.history.go(-2)},"确定","取消"):(d.innerHTML=a.message,d.style.display="block",b.timer7=window.setTimeout(function(){d.style.display="none",window.clearTimeout(b.timer7),b.timer7=null},3e3))})}),this.addHandler(a,"click",function(a){var a=a||window.event,b=a.target||a.srcElement;"I"==b.tagName&&(document.querySelector(".summary-cost-shadow-two").style.display="none",document.querySelector(".buy-tip").style.display="none")}),this.addHandler(b,"click",function(a){var a=a||window.event;document.all?a.cancelBubble=!0:a.stopPropagation(),jTiper('<p style="padding:15px 15px 0 15px;margin-bottom:0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0 15px;margin-bottom:0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0 15px;margin-bottom:0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0 15px;margin-bottom:0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0 15px;margin-bottom:0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0 15px;margin-bottom:0">退改签规则，以航司为准!</p>',"退改签说明",function(){})}),this.addHandler(document,"click",function(a){var a=a||window.event,b=a.target||a.srcElement;"popup_overlay"==b.id?document.querySelector("#popup_container")&&(document.body.removeChild(document.querySelector("#popup_container")),document.body.removeChild(document.querySelector("#popup_overlay"))):"summary-cost-shadow-two"==b.className&&(b.style.display="none",document.querySelector(".buy-ticket-notice").style.display="none")}),c&&this.addHandler(c,"click",function(a){document.querySelector(".summary-cost-shadow-two").style.display="block",document.querySelector(".ticket-detail-modal").style.display="block"}),this.addHandler(e,"click",function(a){this.style.display="none",document.querySelector(".ticket-detail-modal").style.display="none"}),this.addHandler(f,"click",function(a){function b(){g.className="summary-cost-modal summary-cost-modal-hide",h.style.display="none",f.className="detail clearfixs detail-tangle"}function c(){g.className="summary-cost-modal summary-cost-modal-show",h.style.display="block",f.className="detail clearfixs detail-tangle opened"}g.style.webkitTransition="all 300ms","summary-cost-modal summary-cost-modal-show"==g.className?b():c()})},countrySlider:function(){var a=document.querySelector(".country-trigger"),b=this;a.onclick=function(){var a=document.createElement("div"),c=function(){var a=document.querySelector("#country-input-zone"),b=document.querySelector(".country-list-searched-order"),c=(document.querySelector(".country-list-init-show"),[]),d=/[A-Za-z]{2,}|[\u4e00-\u9fa5]{1,}/,e=a.value,f="";if(Array.prototype.distinct=function(){for(var a=function(b,c){var d=!0;if(!b||!c)return!1;for(var e in b){if(!c[e])return!1;if("object"==typeof b[e])d=a(b[e],c[e]);else if(b[e]!==c[e])return!1}return d},b=[],c={},d=0,e=this.length;e>d;d++)a(c[typeof this[d]+this[d]],this[d])||(b.push(this[d]),c[typeof this[d]+this[d]]=this[d]);return b},d.test(e)){for(var g=String(e).toLowerCase(),h=0;h<arrCountry.length;h++){var i=String(arrCountry[h].CountryEN).toLowerCase();(i.indexOf(g)>-1||arrCountry[h].CountryName.indexOf(e)>-1)&&c.push(arrCountry[h])}if(c=c.distinct(),c.length){for(var j=0;j<c.length;j++)f+='<li data-tel-code="'+c[j].TelCode+'" data-Country-code="'+c[j].CountryCode+'">'+c[j].CountryName+"</li>";b.innerHTML=f,b.style.display="block"}else f+="<li>无搜索结果</li>",b.style.display="none"}};a.className="all-elements country-cho-wrap-order",a.innerHTML='<div class="header country-list-header"><a href="javascript:void(0)" class="icons header-back country-hidden"></a><div class="cl_search"><input type="text" placeholder="中国/China/zhongguo" id="country-input-zone"/><i></i></div></div><ul class="country-list-searched country-list-searched-order"></ul><div class="snap-content country-list country-list-init-show" style="padding-top: 45px"><div class="country-wrap" id="country-wrap"><ul class="country-list counter-list-to-order"></ul></div></div>',document.body.appendChild(a);var d=document.querySelector("#country-input-zone"),e=document.querySelector(".country-hidden"),f=document.querySelector(".counter-list-to-order"),g="";Array.prototype.distinct=function(){for(var a=function(b,c){var d=!0;if(!b||!c)return!1;for(var e in b){if(!c[e])return!1;if("object"==typeof b[e])d=a(b[e],c[e]);else if(b[e]!==c[e])return!1}return d},b=[],c={},d=0,e=this.length;e>d;d++)a(c[typeof this[d]+this[d]],this[d])||(b.push(this[d]),c[typeof this[d]+this[d]]=this[d]);return b},arrCountry=arrCountry.distinct();for(var h=0,i=arrCountry.length;i>h;h++)g+='<li data-tel-code="'+arrCountry[h].TelCode+'" data-code="'+arrCountry[h].CountryCode+'">'+arrCountry[h].CountryName+"</li>";f.innerHTML=g,d.addEventListener?d.addEventListener("input",c,!1):d.attachEvent("onpropertychange",c),e.onclick=function(){document.querySelector(".country-cho-wrap-order")&&document.body.removeChild(document.querySelector(".country-cho-wrap-order"))},b.addCountryCodeHandler()}},addCountryCodeHandler:function(){var a=document.querySelector(".country-cho-wrap-order"),b=document.querySelector("#country-input-zone");a.onclick=function(a){var a=a||window.event,c=a.target||a.srcElement,d=document.querySelector("#country-code"),e=this;"LI"==c.tagName&&(b.value=c.innerHTML,d.innerHTML="+"+c.getAttribute("data-tel-code"),e.timer9=window.setTimeout(function(){d.innerHTML="+"+c.getAttribute("data-tel-code"),window.clearTimeout(e.timer9),e.timer9=null,document.body.removeChild(e)},1e3))}},tAjax:function(a,b,c,d,e){var f=this,g={Parameters:b,ForeEndType:d,Code:c};a=a?a:f.requestUrl,vlm.loadJson(a,JSON.stringify(g),e)},returnDate:function(a){var b=/(\d{4})-(\d{2})-(\d{2})T\d{2}:\d{2}:\d{2}/.exec(a),c=b[1]+"-"+b[2]+"-"+b[3],d=new Date(c.replace(/-/g,"/")).getDay(),e="";switch(d){case 0:e="周日";break;case 1:e="周一";break;case 2:e="周二";break;case 3:e="周三";break;case 4:e="周四";break;case 5:e="周五";break;case 6:e="周六";break;default:return""}return array=a.split("-"),array[1]=array[1]<10?"0"+parseInt(array[1]):parseInt(array[1]),array[2]=array[2]<10?"0"+parseInt(array[2]):parseInt(array[2]),'<span class="date">'+b[1]+"-"+b[2]+"-"+b[3]+'</span><span class="order-week">'+e+"</span>"},addContent:function(a){function b(a){var b="",c="";return a.segmentsReturn?(c=a.segmentsLeave.length>1?a.segmentsLeave[a.segmentsLeave.length-1].airportNameFrom:a.segmentsLeave[0].airportNameTo,b+='<p class="go-line  go-line-return"><i class="icon-go"></i>'+l.returnDate(a.flightLeaveStartDate)+'</span><span class="fix-width">'+a.segmentsLeave[0].airportNameFrom+'</span><span class="line-order">-</span><span class="order-city-end fix-width">'+c+'</span><span class="hour">'+parseInt(a.segmentsLeaveTotalTravelTime/60)+"h"+a.segmentsLeaveTotalTravelTime%60+'m</span><span class="icon-clock"></span></p>'):(c=a.segmentsLeave.length>1?a.segmentsLeave[a.segmentsLeave.length-1].airportNameFrom:a.segmentsLeave[0].airportNameTo,b+='<p class="go-line" style="padding-left:0;">'+l.returnDate(a.flightLeaveStartDate)+'</span><span class="fix-width">'+a.segmentsLeave[0].airportNameFrom+'</span><span class="line-order">-</span><span class="order-city-end fix-width">'+c+'</span><span class="trigger-button right-arrow"></span><span class="hour">'+parseInt(a.segmentsLeaveTotalTravelTime/60)+"h"+a.segmentsLeaveTotalTravelTime%60+'m</span><span class="icon-clock"></span></p>'),b}function c(a){var b="",c="";return a.segmentsReturn&&(c=a.segmentsReturn.length>1?a.segmentsReturn[a.segmentsReturn.length-1].airportNameFrom:a.segmentsReturn[0].airportNameTo,b+='<p class="go-line go-line-return"><i class="icon-go-return"></i>'+l.returnDate(a.flightReturnStartDate)+'</span><span class="fix-width">'+a.segmentsReturn[0].airportNameFrom+'</span><span class="line-order">-</span></span><span class="fix-width" style="margin-left: 0">'+c+'</span><i class="icon-clock"></i><span class="hour">'+parseInt(a.segmentsReturnTotalTravelTime/60)+"h"+a.segmentsReturnTotalTravelTime%60+"m</span></p>"),b}function d(a){var b=null!=a.segmentsReturn?"往返票价":"单程票价",c="";return c+='<div class="seat-condition"><div class="left"><span>'+a.segmentsLeave[0].cabinClassName+"</span><p><span>"+b+"</span>&nbsp;￥<span>"+parseInt(m(a.totalFareAmountADT))+"</span><span>&nbsp;税费</span>￥<span>"+parseInt(m(a.totalTaxAmountADT))+'</span></p></div> <div class="right"> <p><span class="tag">￥<strong>'+parseInt(m(a.totalFareAmountExc))+'</strong></span></p><p><span class="tip-word">退改签说明</span></p></div></div>'}function e(a){var b="";return b+=a.segmentsReturn?'<li class="detail-start"><div class="top-line"><span class="icon-go"></span>'+l.returnDate(a.flightLeaveStartDate)+'<span class="start">'+a.cityNameFrom+'</span><span class="line">-</span><span class="end">'+a.cityNameTo+'</span><span class="detail-hour">'+parseInt(a.segmentsLeaveTotalTravelTime/60)+"h"+a.segmentsLeaveTotalTravelTime%60+"m</span></div>"+g(a.segmentsLeave)+"</div></li>":'<li class="detail-start"><div class="top-line top-pad-no">'+l.returnDate(a.flightLeaveStartDate)+'<span class="start">'+a.cityNameFrom+'</span><span class="line">-</span><span class="end">'+a.cityNameTo+'</span><span class="detail-hour">'+parseInt(a.segmentsLeaveTotalTravelTime/60)+"h"+a.segmentsLeaveTotalTravelTime%60+"m</span></div>"+g(a.segmentsLeave)+"</div></li>"}function f(a){var b="";return a.segmentsReturn&&(b+='<li class="detail-start"><div class="top-line"><span class="icon-back"></span>'+l.returnDate(a.flightReturnStartDate)+'<span class="start">'+a.cityNameTo+'</span><span class="line">-</span><span class="end">'+a.cityNameFrom+'</span><span class="detail-hour">'+parseInt(a.segmentsReturnTotalTravelTime/60)+"h"+a.segmentsReturnTotalTravelTime%60+"m</span></div>"+g(a.segmentsReturn)+"</div></li>"),b}function g(a){if(a)for(var b="",c="",d="",e=ticketOrder,f=0;f<a.length;f++)c=void 0!=a[f+1]?'<div class="transit-city-hour">中转'+a[f].cityNameTo+"</div>":"",d=Math.floor((new Date(a[f].arriveDate.replace(/-/g,"/"))-new Date(a[f].departDate.replace(/-/g,"/")))/1e3/60/60/24)>=1?Math.floor((new Date(a[f].arriveDate.replace(/-/g,"/"))-new Date(a[f].departDate.replace(/-/g,"/")))/1e3/60/60/24)+"天":"",b+='<div class="go-trip start"><div class="time-airport-info"><div class="start-time-info"><span class="time-number">'+e.timeCut(a[f].departDate)+'</span><span class="air-port-word">'+a[f].airportNameFrom+a[f].termDepart+'</span></div><div class="total-time-info detail-time-info"><span class="time-hour-minute"></span><span class="arrow-time"></span></div><div class="end-time-info"><span class="tip-add-days-seat">'+d+'</span><span class="time-number">'+e.timeCut(a[f].arriveDate)+'</span><span class="air-port-word-right">'+a[f].airportNameTo+a[f].termArrive+'</span></div></div><div class="bottom-word"><span>'+a[f].airCorpName+"</span><span>|</span><span>"+a[f].flightNo+"</span><span>|</span><span>"+a[f].planeName+"</span></div></div>"+c;return b}var h=document.querySelector(".order-top"),i=document.querySelector(".detail-outer"),j="",k="",l=this,m=(this.storageUtil.get("reverseInformationCache"),function(a){return String(a).indexOf(".")>-1?2==String(a).substring(String(a).indexOf(".")).length?String(a)+"0":String(a).substring(0,String(a).indexOf(".")+3):String(a)+".00"});a.segmentsReturn?(j+='<div class="go-line-outer-sub">'+b(a)+'<p class="go-line go-line-return-middle"><span class="trigger-button right-arrow"></span></p>'+c(a)+"</div>",k+=d(a),h.innerHTML=j+k):(j+='<div class="go-line-outer-sub match">'+b(a)+c(a)+'<p class="go-line go-line-return-middle"><span class="trigger-button2 right-arrow"></span></p></div>',k+=d(a),h.innerHTML=j+k),i.innerHTML=e(a)+f(a)},costFinaList:function(){var a=document.querySelector(".second-line"),b={},c=document.querySelector(".total-price-number strong"),d="",e=this.storageUtil.get("curFlightListData"),f=this.reverseInformation,g=function(a){return String(a).indexOf(".")>-1?2==String(a).substring(String(a).indexOf(".")).length?String(a)+"0":String(a).substring(0,String(a).indexOf(".")+3):String(a)+".00"},h=document.querySelector(".total-person-price"),i=0;b.totalFareAmountADT=e.totalFareAmountADT,b.totalFareAmountCHD=e.totalFareAmountCHD,b.totalFareAmountExc=e.totalFareAmountExc,b.totalTaxAmountADT=e.totalTaxAmountADT,b.totalTaxAmountCHD=e.totalTaxAmountCHD,b.NumofAdult=parseInt(f.WapOrder.NumofAdult),b.NumofChild=parseInt(f.WapOrder.NumofChild),this.costFinaListData=b,d+="<p>成人票<span>￥<span>"+g(b.totalFareAmountADT)+"</span> x"+b.NumofAdult+" 人</span></p>",d+="<p>税费<span>￥<span>"+g(b.totalTaxAmountADT)+"</span> x"+b.NumofAdult+" 人</span></p>",this.orderFlightData.totalFareAmountCHD?(d+=0!=b.NumofChild?"<p>儿童票<span>￥<span>"+g(b.totalFareAmountCHD)+"</span> x"+b.NumofChild+" 人</span></p>":"",d+=0!=b.NumofChild?"<p>税费<span>￥<span>"+g(b.totalTaxAmountCHD)+"</span> x"+b.NumofChild+" 人</span></p>":"",i=b.NumofAdult+b.NumofChild):i=b.NumofAdult,a.innerHTML=d,c.innerHTML=parseInt(g(b.totalFareAmountExc*b.NumofAdult+(b.totalFareAmountCHD+b.totalTaxAmountCHD)*b.NumofChild)),h.innerHTML=i+"人总价"},init:function(){var a=this.storageUtil.get("reverseInformationCache");this.reverseInformation=a,this.telSlider(),this.loadingFade(),this.orderFlightData=this.storageUtil.get("curFlightListData"),this.addContent(this.orderFlightData),this.addEvent(),this.costFinaList()}};ticketOrder.init();