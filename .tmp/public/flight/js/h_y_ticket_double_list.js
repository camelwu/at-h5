/*! asiatravel FE team at-h5-nodejs-----2016-05-19T16:09:38 */
var ticketDouble={CultureName:"zh-CN",requestUrl:"",dateInit:function(a){var b=document.querySelectorAll(".ticket-double-date"),c={};b[0].innerHTML=ticketDouble.returnWeek(a.DepartDate),b[1].innerHTML=ticketDouble.returnWeek(a.ReturnDate),c[a.DepartDate]="去程",c[a.ReturnDate]="返程";new TicketDate({id:"dateIcon",num:13,time:c,sClass1:"date-wrap-double",type:"Return",dateObj:{start:this.backParaObj.DepartDate,end:this.backParaObj.ReturnDate},fn:this.dateChangeRender})},returnWeek:function(a){var b,c,d=new Date(a.replace(/-/g,"/")).getDay();switch(d){case 0:b="周日";break;case 1:b="周一";break;case 2:b="周二";break;case 3:b="周三";break;case 4:b="周四";break;case 5:b="周五";break;case 6:b="周六"}return c=a.split("-"),c[1]=c[1]<10?"0"+parseInt(c[1]):parseInt(c[1]),c[2]=c[2]<10?"0"+parseInt(c[2]):parseInt(c[2]),"<span>"+c[1]+"-"+c[2]+"</span> <span>"+b+"</span>"},tAjax:function(a,b,c,d,e,f){var g={Parameters:b,ForeEndType:d,Code:c};a=a?a:"",f?vlm.loadJson(a,JSON.stringify(g),e,!1,!1,f):vlm.loadJson(a,JSON.stringify(g),e)},addHandler:function(a,b,c){document.addEventListener?ticketDouble.addHandler=function(a,b,c){a.addEventListener(b,c,!1)}:document.attachEvent?ticketDouble.addHandler=function(a,b,c){a.attachEvent("on"+b,function(){c.call(a)})}:ticketDouble.addHandler=function(a,b,c){a["on"+b]=c},ticketDouble.addHandler(a,b,c)},reDate:function(a){var b=/(\d{1,2})月(\d{1,2})日/g,c=b.exec(a),d=function(){var a,b=new Date((new Date).getFullYear()+"/"+c[1]+"/"+c[2]).getDay();switch(b){case 0:a="周日";break;case 1:a="周一";break;case 2:a="周二";break;case 3:a="周三";break;case 4:a="周四";break;case 5:a="周五";break;case 6:a="周六"}return a};return c[1]=parseInt(c[1])<10?"0"+parseInt(c[1]):parseInt(c[1]),c[2]=parseInt(c[2])<10?"0"+parseInt(c[2]):parseInt(c[2]),"<span>"+c[1]+"-"+c[2]+"</span>&nbsp;<span>"+d()+"</span>"},dateChangeRender:function(){var a=ticketDouble,b=document.querySelectorAll(".date-wrap-double"),c=b[0].querySelector(".dateNumber").innerHTML,d=b[1].querySelector(".dateNumber").innerHTML;document.querySelector(".start-date").innerHTML=a.reDate(c),document.querySelector(".end-date").innerHTML=a.reDate(d),a.backParaObj.DepartDate=(new Date).getFullYear()+"-"+document.querySelector(".start-date").querySelectorAll("span")[0].innerHTML,a.backParaObj.ReturnDate=(new Date).getFullYear()+"-"+document.querySelector(".end-date").querySelectorAll("span")[0].innerHTML,a.backParaObj.pageNo=1,a.backParaObj.pageSize=10,document.querySelector("#preloader").style.display="block";var e=vlm.setUrlPara("","DepartDate",a.backParaObj.DepartDate),f=vlm.setUrlPara(e,"ReturnDate",a.backParaObj.ReturnDate);window.location.href=f},parseUrlPara:function(a,b){var b=b||!1,c=/([^=&?]+)=([^=&?]+)/g,d={};return a.replace(c,function(){var a=arguments;d[a[1]]=b?decodeURIComponent(a[2]):a[2]}),d},checkTip:function(){for(var a=document.querySelectorAll(".detail-list li"),b="",c=document.querySelectorAll("#time-modal li"),d="",e=document.querySelectorAll("#price-modal li"),f="",g=0;g<a.length;g++)a[g].className.indexOf("active")>-1&&(b+=g);for(var h=0;h<c.length;h++)c[h].className.indexOf("active")>-1&&(d+=h);for(var i=0;i<e.length;i++)e[i].className.indexOf("active")>-1&&(f+=i);return{left:b,middle:d,right:f}},eventHandler:function(){for(var a=document.querySelectorAll(".seat-detail"),b=ticketDouble,c=document.querySelector("#r-shadow"),d=document.querySelector("#filter-modal"),e=document.querySelector("#time-modal"),f=document.querySelector("#price-modal"),g=0;g<a.length;g++)this.addHandler(a[g],"click",function(){document.location.href="ticket_seat_choose.html?setId="+this.getAttribute("data-set-id")+"&RouteType="+b.backParaObj.RouteType+"&hasTax="+b.backParaObj.hasTax+"&CabinClass="+b.backParaObj.CabinClass+"&NumofAdult="+b.backParaObj.NumofAdult+"&NumofChild="+b.backParaObj.NumofChild+"&interNationalOrDomestic="+b.backParaObj.interNationalOrDomestic});this.addHandler(c,"click",function(){"0px"==d.style.bottom?(d.style.transition="all 300ms ease-in",d.style.webkitTransition="all 300ms linear",d.style.bottom="-126%"):"0px"==e.style.bottom?(e.style.transition="all 300ms ease-in",e.style.webkitTransition="all 300ms linear",e.style.bottom="-126%"):"0px"==f.style.bottom&&(f.style.transition="all 300ms ease-in",f.style.webkitTransition="all 300ms linear",f.style.bottom="-126%"),this.style.display="none"})},timeCut:function(a){var b=/\d{4}-\d{2}-\d{2}T(\d{2}):(\d{2}):\d{2}/g,c=b.exec(a);return c[1]+":"+c[2]},alertNoFlightNotice:function(a,b){var c,d=document.createElement("div"),e=document.querySelector(".all-elements"),f=ticketDouble,g="Oneway"==b?"direction-single":"direction-double";d.className="no-flight-notice",d.innerHTML='<header class="big-title"><i class="fl close-no-flight"></i><span class="set-place">'+a.fromCity+'</span><i class="'+g+'"></i><span class="to-place">'+a.toCity+'</span></header><div class="tip-button-para"><p class="no-flight-word">没有找到符合条件的航班！ </p></div>',e.appendChild(d),c=document.querySelector(".close-no-flight"),f.addHandler(c,"click",function(){e.removeChild(d)})},returnTransferCity:function(a){var b="";return a.length<2?b="":2==a.length?b='<span class="air-port-word">转'+a[0].cityNameTo+"</span>":a.length>=3&&(b='<span class="air-port-word">中转'+(a.length-1)+"次</span>"),b},taxDeal:function(a){for(var b=[],c=[],d=[],e=[],f=0;f<a.length;f++)0==a[f].totalTaxAmountADT?c.push(a[f]):b.push(a[f]);d=a.sort(function(a,b){return parseFloat(a.totalFareAmountExc)-parseFloat(b.totalFareAmountExc)}),e=d.reverse(),this.cacheTypeData={taxData:b,freeTaxData:c,priceDesc:d,priceAsic:e}},taxHandler:function(){var a=document.querySelector("#price-modal");this.addHandler(a,"click",function(a){var b=document.querySelector("#r-shadow"),c=ticketDouble,a=a||window.event,d=d||a.srcElement,e=d.parentNode.querySelectorAll("li"),f={data:{flightInfos:[]}};if("noTax"==d.getAttribute("data-i"))if(0==c.cacheTypeData.freeTaxData.length)jAlert("当前航班均含税，换种条件试试!","",function(){});else{f.data.flightInfos=c.cacheTypeData.freeTaxData,c.changeFlightList(f,!0);for(var g=0,h=e.length;h>g;g++)e[g].className=e[g]==d?"price-modal-item active":"price-modal-item"}else if("hasTax"==d.getAttribute("data-i")){f.data.flightInfos=c.cacheTypeData.taxData,c.changeFlightList(f,!0);for(var g=0,h=e.length;h>g;g++)e[g].className=e[g]==d?"price-modal-item active":"price-modal-item"}else if("priceHighToLow"==d.getAttribute("data-i")){f.data.flightInfos=c.cacheTypeData.priceDesc,c.changeFlightList(f,!0);for(var g=0,h=e.length;h>g;g++)e[g].className=e[g]==d?"price-modal-item active":"price-modal-item"}else if("priceLowToHigh"==d.getAttribute("data-i")){f.data.flightInfos=c.cacheTypeData.priceAsic,c.changeFlightList(f,!0);for(var g=0,h=e.length;h>g;g++)e[g].className=e[g]==d?"price-modal-item active":"price-modal-item"}this.style.transition="all 300ms ease-in",this.style.webkitTransition="all 300ms linear",this.style.bottom="-126%",b.style.display="none"})},loadMoreHandler:function(a,b){var c=document.getElementById("loadMore");c.innerHTML="点击加载更多",c.style.display="block",a==b&&(c.innerHTML="没有更多数据了")},loadMoreBtnEvent:function(){var a=document.getElementById("loadMore");this.addHandler(a,"click",function(){ticketDouble.loadMoreData()})},changeFlightList:function(a,b){function c(a){var b=a.data.flightInfos[j].segmentsLeave,c=g.returnTransferCity(a.data.flightInfos[j].segmentsLeave),d=a.data.flightInfos[j].flightLeaveSpacingDay>=1?"+"+a.data.flightInfos[j].flightLeaveSpacingDay+"天":"",e="",f=1==a.data.flightInfos[j].isLeaveStop?' | <span class="green-tip">经停</span>':"",h=1==a.data.flightInfos[j].isReturnShareFlight?'&nbsp;|&nbsp;<span class="green-tip">共享</span>':"";return e+='<div class="go"><div class="go-info"><div class="start-time-info start-time-info-double"><span class="start-icon"></span><span class="time-number">'+g.timeCut(b[0].departDate)+'</span><span class="air-port-word">'+b[0].airportNameFrom+b[0].termDepart+'</span></div><div class="total-time-info"><span class="time-hour-minute">'+parseInt(a.data.flightInfos[j].segmentsLeaveTotalTravelTime/60)+"h"+a.data.flightInfos[j].segmentsLeaveTotalTravelTime%60+'m</span><span class="arrow-time"></span><span class="air-port-word">'+c+'</span></div><div class="end-time-info"><span class="tip-add-days">'+d+'</span><span class="time-number">'+g.timeCut(b[b.length-1].arriveDate)+'</span><span class="air-port-word">'+b[b.length-1].airportNameTo+b[b.length-1].termArrive+'</span></div></div><p class="small-info-double ">'+b[0].operatingCarrierName+b[0].operatingCarrierCode+b[0].flightNo+"<span>&nbsp;|&nbsp;</span>"+b[0].cabinClassName+f+h+"</p></div>"}function d(a){var b=a.data.flightInfos[j].segmentsReturn,c=g.returnTransferCity(a.data.flightInfos[j].segmentsReturn),d=a.data.flightInfos[j].flightReturnSpacingDay>=1?"+"+a.data.flightInfos[j].flightReturnSpacingDay+"天":"",e="",f=1==a.data.flightInfos[j].isReturnStop?' | <span class="green-tip">经停</span>':"",h=1==a.data.flightInfos[j].isReturnShareFlight?'&nbsp;|&nbsp;<span class="green-tip">共享</span>':"";return e+='<div class="go"><div class="go-info"><div class="start-time-info start-time-info-double"><span class="end-icon"></span><span class="time-number">'+g.timeCut(b[0].departDate)+'</span><span class="air-port-word">'+b[0].airportNameFrom+b[0].termDepart+'</span></div><div class="total-time-info"><span class="time-hour-minute">'+parseInt(a.data.flightInfos[j].segmentsReturnTotalTravelTime/60)+"h"+a.data.flightInfos[j].segmentsReturnTotalTravelTime%60+'m</span><span class="arrow-time"></span><span class="air-port-word">'+c+'</span></div><div class="end-time-info"><span class="tip-add-days">'+d+'</span><span class="time-number">'+g.timeCut(b[b.length-1].arriveDate)+'</span><span class="air-port-word">'+b[b.length-1].airportNameTo+b[b.length-1].termArrive+'</span></div></div><p class="small-info-double ">'+b[0].operatingCarrierName+b[0].operatingCarrierCode+b[0].flightNo+"<span>&nbsp;|&nbsp;</span>"+b[0].cabinClassName+f+h+"</p></div>"}function e(a){var b="";return b+="domestic"==g.backParaObj.interNationalOrDomestic?'<div class="price-tax">    <div class="price-info price-info-domestic"><span class="price-icon">￥</span><span class="price-num">'+a.totalFareAmountADT+'</span><span class="word-tip">往返</span><br></div>    </div>':"true"==g.backParaObj.hasTax?'<div class="price-tax">    <div class="price-info"><span class="price-icon">￥</span><span class="price-num">'+a.totalFareAmountExc+'</span><span class="word-tip">往返</span><br></div>    <div class="price-tax-info tax-word-pull-left"><span class="tax-word">含税总价</span></div>        </div>':'<div class="price-tax">    <div class="price-info"><span class="price-icon">￥</span><span class="price-num">'+a.totalFareAmountADT+'</span><span class="word-tip">往返</span><br></div>    <div class="price-tax-info"><span class="tax-word">税费</span>￥'+a.totalTaxAmountADT+"</div>        </div>"}var f,g=this,h=document.querySelector(".air-tickets-detail-wrapper"),i="";h.innerHTML=1==b?"":h.innerHTML;for(var j=0;j<a.data.flightInfos.length;j++)i="",f=document.createElement("li"),f.className="air-tickets-detail seat-detail",f.setAttribute("data-set-id",a.data.flightInfos[j].setID),i+='<div class="time-airport">'+c(a)+d(a)+"</div>"+e(a.data.flightInfos[j]),f.innerHTML=i,h.appendChild(f);this.loadMoreHandler(a.data.pageNo,a.data.pageCount),g.eventHandler()},callRender:function(a){var b={},c=ticketDouble;switch(b.IsDirectFlight="unlimitedPlane"==a.directFly?"false":"true",b.IsShareFlight="hideShareFlight"==a.shareFlight?"false":"true",b.DepartStartHour=a.filterTime.substr(0,2),b.DepartEndHour=a.filterTime.substr(2,2),b.CabinClass=a.CabinClass,b.pageNo=1,b.pageSize=10,a.paraMiddle){case"directFirst":b.PriorityRule=1;break;case"lowPriceFirst":b.PriorityRule=2;break;case"shortTimeFirst":b.PriorityRule=3;break;default:b.PriorityRule=0}b.HasTax="hasTax"==a.paraRight?"true":"false";for(var d in b)c.backParaObj[d]=b[d];document.querySelector("#preloader").style.display="block",c.tAjax(this.requestUrl,c.backParaObj,"3001",3,c.renderHandler);var e=c.checkTip();c.initLeftState.left!=e.left?document.querySelector("#fo_sc i").className="red-tip":document.querySelector("#fo_sc i").className="",c.initLeftState.middle!=e.middle?document.querySelector("#fo_ra i").className="red-tip":document.querySelector("#fo_ra i").className="",c.initLeftState.right!=e.right?document.querySelector("#fo_lo i").className="red-tip":document.querySelector("#fo_lo i").className=""},toSeatDetail:function(){for(var a=document.querySelectorAll(".seat-detail"),b=ticketDouble,c=0;c<a.length;c++)this.addHandler(a[c],"click",function(){document.location.href="ticket_seat_choose.html?setId="+this.getAttribute("data-set-id")+"&RouteType="+b.backParaObj.RouteType+"&hasTax="+b.backParaObj.hasTax+"&CabinClass="+b.backParaObj.CabinClass+"&NumofAdult="+b.backParaObj.NumofAdult+"&NumofChild="+b.backParaObj.NumofChild+"&interNationalOrDomestic="+b.backParaObj.interNationalOrDomestic})},storageUtil:{set:function(a,b){var c=window.localStorage;c.setItem(a,JSON.stringify({data:b}))},get:function(a){var b=window.localStorage,c=b.getItem(a),d=JSON.parse(c);return JSON.stringify(d.data)}},renderHandler:function(a){var b=ticketDouble,c=document.querySelector(".air-tickets-detail-wrapper"),d=document.querySelector(".flight-result-tip"),e="",f=document.querySelectorAll(".air-tickets-detail-wrapper li"),a=a,g=window.localStorage;e=b.isClearAll,document.querySelector("#preloader").style.display="none",a.success&&200==a.code&&a.data.flightInfos.length>0?(document.querySelector(".tip-button-para").style.display="none",d.style.display="none",b.lastBackData=a,b.pageNo=a.data.pageNo,b.pageCount=a.data.pageCount,g.setItem("flightListData",JSON.stringify(a.data.flightInfos)),b.changeFlightList(a,e),b.taxDeal(a.data.flightInfos)):0==a.success&&a.message.indexOf("greater")>-1?(document.querySelector(".no-flight-word").innerHTML="未搜到航班信息，请扩大搜索范围!",document.querySelector(".tip-button-para").style.display="block",c.innerHTML="",d.style.display="block",b.timer8=window.setTimeout(function(){d.style.display="none",window.clearTimeout(b.timer8),b.timer8=null},3e3)):f||(d.style.display="none",document.querySelector("#preloader").style.display="none",document.querySelector(".tip-button-para").style.display="block")},loadMoreData:function(){var a=ticketDouble,b=document.getElementById("loadMore");a.pageNo>=a.pageCount?($("#loadMore").fadeOut(1e3),jAlert('<div class="no-more-flight-tip">没有更多航班信息了</div>',"",function(){})):a.pageNo<a.pageCount&&(a.isClearAll=!1,a.backParaObj.pageNo=Number(a.backParaObj.pageSize)/10,a.backParaObj.pageNo++,a.backParaObj.pageSize=10,b.innerHTML="正在加载...",a.tAjax(this.requestUrl,a.backParaObj,"3001",3,a.renderHandler,!0))},handler1:function(a){var b=ticketDouble;b.backParaObj=a,document.querySelector("#preloader").style.display="block",b.tAjax(b.requestUrl,b.backParaObj,"3001",3,b.renderHandler)},handler2:function(a){var b=ticketDouble;b.backParaObj=a,b.changeFlightList(b.lastBackData,!0)},init:function(){var a=this.parseUrlPara(document.location.search,!0);document.querySelector(".set-place").innerHTML=a.fromCity,document.querySelector(".to-place").innerHTML=a.toCity,this.tripType=a.interNationalOrDomestic,a.NumofAdult=parseInt(a.NumofAdult),a.NumofChild=parseInt(a.NumofChild),a.PriorityRule=parseInt(a.PriorityRule),a.pageNo=parseInt(a.pageNo),a.pageSize=parseInt(a.pageSize),this.backParaObj=a,this.isClearAll=!0,this.dateInit(a),this.toSeatDetail(),this.tAjax(this.requestUrl,a,"3001",3,this.renderHandler),conditionalFiltering.init(this.tripType,this.backParaObj.RouteType,this.backParaObj,this.handler1,this.handler2,this),this.taxHandler(),this.initLeftState=this.checkTip(),this.loadMoreBtnEvent()}};ticketDouble.init();