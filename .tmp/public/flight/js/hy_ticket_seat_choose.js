/*! asiatravel FE team at-h5-nodejs-----2016-05-19T15:21:43 */
var ticketSeatChoose={requestUrl:"",addHandler:function(a,b,c){document.addEventListener?ticketSeatChoose.addHandler=function(a,b,c){a.addEventListener(b,c,!1)}:document.attachEvent?ticketSeatChoose.addHandler=function(a,b,c){a.attachEvent("on"+b,function(){c.call(a)})}:ticketSeatChoose.addHandler=function(a,b,c){a["on"+b]=c},ticketSeatChoose.addHandler(a,b,c)},tAjax:function(a,b,c,d,e){var f=this,g={Parameters:b,ForeEndType:d,Code:c};a=a?a:f.requestUrl,vlm.loadJson(a,JSON.stringify(g),e)},storageUtil:{set:function(a,b){var c=window.localStorage;c.setItem(a,JSON.stringify({data:b}))},get:function(a){var b=window.localStorage,c=b.getItem(a),d=JSON.parse(c);return null!=d?d.data:void 0}},test:function(a){},loadingFade:function(){$(window).load(function(){$("#status-f").fadeOut(),$("#preloader").delay(400).fadeOut("medium")})},addEvent:function(){var a=document.querySelector("#reserve-button"),b=document.querySelector("#change-explain"),c=document.querySelector(".ticket-shadow"),d=document.querySelector(".detail-word");this.addHandler(a,"click",function(){var a=ticketSeatChoose,b=0==a.curFlightListData.totalTaxAmountADT?a.curFlightListData.totalFareAmountExc*parseInt(a.assistInfo.NumofAdult):a.curFlightListData.totalFareAmountExc*parseInt(a.assistInfo.NumofAdult)+(a.curFlightListData.totalFareAmountCHD+a.curFlightListData.totalTaxAmountCHD)*parseInt(a.assistInfo.NumofChild),c={WapOrder:{SetID:a.currentFlightData.setID,CacheID:a.currentFlightData.cacheID,CityCodeFrom:a.currentFlightData.cityCodeFrom,CityCodeTo:a.currentFlightData.cityCodeTo,NumofAdult:a.assistInfo.NumofAdult,NumofChild:0==a.curFlightListData.totalTaxAmountADT?0:a.assistInfo.NumofChild,RouteType:a.assistInfo.RouteType,CabinClass:a.assistInfo.CabinClass,SourceType:"H5"},TravellerInfo:[],ContactDetail:{},CurrencyCode:"CNY",TotalPrice:b};a.reverseInformationCache=c,a.testLogin()}),this.addHandler(b,"click",function(a){var a=a||window.event;document.all?a.cancelBubble=!0:a.stopPropagation(),jTiper('<p style="padding:15px 15px 0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0">退改签规则，以航司为准!</p><p style="padding:15px 15px 0">退改签规则，以航司为准!</p>',"退改签说明",function(){})}),d&&this.addHandler(d,"click",function(a){$("#preloader").show(),$("#status-f").show(),$("#status-f").delay(400).fadeOut("medium"),$("#preloader").delay(400).fadeOut("medium"),c.style.display="block",document.querySelector(".ticket-detail-modal").style.display="block"}),this.addHandler(c,"click",function(a){var a=a||window.event,b=a.target||a.srcElement;"ticket-shadow"==b.className&&(c.style.display="none",document.querySelector(".ticket-detail-modal").style.display="none")})},testLogin:function(){vlm.checkLogin("ticketSeatChoose.testLogin")&&(ticketSeatChoose.reverseInformationCache.WapOrder.MemberId=window.localStorage.memberid,ticketSeatChoose.storageUtil.set("reverseInformationCache",ticketSeatChoose.reverseInformationCache),window.top.location.href="../flight/ticket_order.html")},returnDate:function(a){var b=/(\d{4})-(\d{2})-(\d{2})T\d{2}:\d{2}:\d{2}/.exec(a),c=b[1]+"-"+b[2]+"-"+b[3],d=new Date(c.replace(/-/g,"/")).getDay(),e="";switch(d){case 0:e="周日";break;case 1:e="周一";break;case 2:e="周二";break;case 3:e="周三";break;case 4:e="周四";break;case 5:e="周五";break;case 6:e="周六";break;default:return""}return array=a.split("-"),array[1]=array[1]<10?"0"+parseInt(array[1]):parseInt(array[1]),array[2]=array[2]<10?"0"+parseInt(array[2]):parseInt(array[2]),'<span class="month-day">'+b[1]+"-"+b[2]+"-"+b[3]+'</span><span class="week-day-item">'+e+"</span>"},timeCut:function(a){var b=/\d{4}-\d{2}-\d{2}T(\d{2}):(\d{2}):\d{2}/g,c=b.exec(a);return c[1]+":"+c[2]},returnTransferCity:function(a){var b="";return a.length<2?b="":2==a.length?b='<span class="air-port-word">转'+a[0].cityNameTo+"</span>":a.length>=3&&(b='<span class="air-port-word">中转'+(a.length-1)+"次</span>"),b},createGoTripHtml:function(a){var b,c,d,e=ticketSeatChoose,f=a.flightLeaveSpacingDay>=1?"+"+a.flightLeaveSpacingDay+"天":"",g="",h="",i="";if(i=0==a.isLeaveShareFlight?"":'<div class="right"><span>实际乘坐</span><span>'+a.segmentsLeave[0].operatingCarrierName+"</span><span>"+a.segmentsLeave[0].planeName+"</span></div>",null==a.segmentsReturn){c=1==a.isLeaveStop?' | <span class="green-word">经停</span></span>':"";for(var j=0,k=a.segmentsLeave.length;k>j;j++)if(a.segmentsLeave[j].techStopTotal>=1){h='<span class="air-port-word">经停'+a.segmentsLeave[j].techStopAirportName+"</span>";break}d=1==a.isLeaveShareFlight?'<span> | </span><span class="green-word">共享</span></span>':"",b=a.segmentsLeave.length<=1?"":'<span class="detail-word">详情<i></i></span>',g='<div class="go-trip no-return-trip"><div class="top-line top-pad-no""></span>'+e.returnDate(a.flightLeaveStartDate)+'<span class="start">'+a.cityNameFrom+'</span><span class="line">-</span><span class="end">'+a.cityNameTo+"</span>"+b+'</div><div class="time-airport-info"><div class="start-time-info"><span class="time-number">'+e.timeCut(a.flightLeaveStartDate)+'</span><span class="air-port-word">'+a.segmentsLeave[0].airportNameFrom+a.segmentsLeave[0].termDepart+'</span></div><div class="total-time-info"><span class="time-hour-minute">'+parseInt(a.segmentsLeaveTotalTravelTime/60)+"h"+a.segmentsLeaveTotalTravelTime%60+'m</span><span class="arrow-time"></span>'+h+e.returnTransferCity(a.segmentsLeave)+'</div><div class="end-time-info"> <span class="tip-add-days-seat">'+f+'</span><span class="time-number">'+e.timeCut(a.flightLeaveEndDate)+'</span><span class="air-port-word-right">'+a.segmentsLeave[a.segmentsLeave.length-1].airportNameTo+a.segmentsLeave[a.segmentsLeave.length-1].termArrive+'</span></div></div><div class="bottom-word"><div class="left"><span>'+a.segmentsLeave[0].airCorpName+"</span><span>| "+a.segmentsLeave[0].airCorpCode+a.segmentsLeave[0].flightNo+"</span><span> | </span><span>"+a.segmentsLeave[0].planeName+"</span></span>"+c+d+"</div>"+i+"</div></div>"}else c="",h=1==a.isLeaveStop?'<span class="air-port-word">经停'+a.segmentsLeave[0].techStopAirportName+"</span>":"",d=1==a.isLeaveShareFlight?'<span> | </span><span class="green-word">共享</span></span>':"",b=a.segmentsLeave.length<=1&&a.segmentsReturn.length<=1?"":'<span class="detail-word">详情<i></i></span>',g='<div class="go-trip"><div class="top-line"><span class="icon-go"></span>'+e.returnDate(a.flightLeaveStartDate)+'<span class="start">'+a.cityNameFrom+'</span><span class="line">-</span><span class="end">'+a.cityNameTo+"</span>"+b+'</div><div class="time-airport-info"><div class="start-time-info"><span class="time-number">'+e.timeCut(a.flightLeaveStartDate)+'</span><span class="air-port-word">'+a.segmentsLeave[0].airportNameFrom+a.segmentsLeave[0].termDepart+'</span></div><div class="total-time-info"><span class="time-hour-minute">'+parseInt(a.segmentsLeaveTotalTravelTime/60)+"h"+a.segmentsLeaveTotalTravelTime%60+'m</span><span class="arrow-time"></span>'+h+e.returnTransferCity(a.segmentsLeave)+'</div><div class="end-time-info"> <span class="tip-add-days-seat">'+f+'</span><span class="time-number">'+e.timeCut(a.flightLeaveEndDate)+'</span><span class="air-port-word-right">'+a.segmentsLeave[a.segmentsLeave.length-1].airportNameTo+a.segmentsLeave[a.segmentsLeave.length-1].termArrive+'</span></div></div><div class="bottom-word"><div class="left"><span>'+a.segmentsLeave[0].airCorpName+"</span><span> | </span><span>"+a.segmentsLeave[0].airCorpCode+a.segmentsLeave[0].flightNo+"</span><span> | </span><span>"+a.segmentsLeave[0].planeName+"</span></span>"+c+d+"</div>"+i+"</div></div>";return g},createBackTripHtml:function(a){var b="",c="",d="",e="";if(e=0==a.isReturnShareFlight?"":'<div class="right"><span>实际乘坐</span><span>'+a.segmentsReturn[0].operatingCarrierName+"</span><span>"+a.segmentsReturn[0].planeName+"</span></div>",a.segmentsReturn){b=1==a.isReturnStop?' | <span class="green-word">经停</span></span>':"";for(var f=0,g=a.segmentsReturn.length;g>f;f++)if(a.segmentsReturn[f].techStopTotal>=1){d='<span class="air-port-word">经停'+a.segmentsReturn[f].techStopAirportName+"</span>";break}c=1==a.isReturnShareFlight?'<span> | </span><span class="green-word">共享</span></span>':"";var h=a.flightReturnSpacingDay>=1?"+"+a.flightReturnSpacingDay+"天":"",i="",j=this;i='<div class="back-trip"><div class="top-line"><span class="icon-back"></span>'+j.returnDate(a.flightReturnStartDate)+'<span class="start">'+a.cityNameTo+'</span><span class="line">-</span><span class="end">'+a.cityNameFrom+'</span></div><div class="time-airport-info"><div class="start-time-info"><span class="time-number">'+j.timeCut(a.flightReturnStartDate)+'</span><span class="air-port-word">'+a.segmentsReturn[0].airportNameFrom+a.segmentsReturn[0].termDepart+'</span></div><div class="total-time-info"><span class="time-hour-minute">'+parseInt(a.segmentsReturnTotalTravelTime/60)+"h"+a.segmentsReturnTotalTravelTime%60+'m</span><span class="arrow-time"></span>'+d+j.returnTransferCity(a.segmentsReturn)+'</div><div class="end-time-info"><span class="tip-add-days-seat">'+h+'</span><span class="time-number">'+j.timeCut(a.flightReturnEndDate)+'</span><span class="air-port-word-right">'+a.segmentsReturn[a.segmentsReturn.length-1].airportNameTo+a.segmentsReturn[a.segmentsReturn.length-1].termArrive+'</span></div></div><div class="bottom-word"><div class="left"><span>'+a.segmentsReturn[0].operatingCarrierName+"</span><span> | </span><span>"+a.segmentsReturn[0].operatingCarrierCode+a.segmentsReturn[0].flightNo+"</span><span> | </span><span>"+a.segmentsReturn[0].planeName+a.segmentsReturn[0].planeType+"</span></span>"+b+c+"</div>"+e+"</div></div>"}else i="";return i},createDetailModal:function(a){function b(a){var b,c="";return b=1==a.isLeaveShareFlight?'<span> | </span><span class="green-word">共享</span></span>':"",c+=null==a.segmentsReturn?'<li class="detail-start"><div class="top-line top-pad-no">'+e.returnDate(a.flightLeaveStartDate)+'<span class="start">'+a.cityNameFrom+'</span><span class="line">-</span><span class="end">'+a.cityNameTo+'</span><span class="detail-hour">'+parseInt(a.segmentsLeaveTotalTravelTime/60)+"h"+a.segmentsLeaveTotalTravelTime%60+"m</span></div>"+d(a.segmentsLeave,b)+"</li>":'<li class="detail-start"><div class="top-line"><span class="icon-go"></span>'+e.returnDate(a.flightLeaveStartDate)+'<span class="start">'+a.cityNameFrom+'</span><span class="line">-</span><span class="end">'+a.cityNameTo+'</span><span class="detail-hour">'+parseInt(a.segmentsLeaveTotalTravelTime/60)+"h"+a.segmentsLeaveTotalTravelTime%60+"m</span></div>"+d(a.segmentsLeave,b)+"</li>"}function c(a){var b,a=a,c="";return b=1==a.isReturnShareFlight?'<span> | </span><span class="green-word">共享</span></span>':"",a.segmentsReturn&&(c+='<li class="detail-start"><div class="top-line"><span class="icon-back"></span>'+e.returnDate(a.flightReturnStartDate)+'<span class="start">'+a.cityNameTo+'</span><span class="line">-</span><span class="end">'+a.cityNameFrom+'</span><span class="detail-hour">'+parseInt(a.segmentsReturnTotalTravelTime/60)+"h"+a.segmentsReturnTotalTravelTime%60+"m</span></div>"+d(a.segmentsReturn,b)+"</li>"),c}function d(a,b){var c="",d="",e="",f=ticketSeatChoose,g="";if(a)for(var h=0;h<a.length;h++){if(d="",transferHour="",leaveStopTag="",a[h+1]&&(transferHour=Math.abs(Date.parse(a[h+1].departDate)-Date.parse(a[h].arriveDate))/1e3/60,d='<div class="transit-city-hour">中转'+a[h].cityNameTo+" "+parseInt(transferHour/60)+"h"+transferHour%60+"m</div>"),a[h].techStopTotal>=1){var i=""!=a[h].techStopDepartDate&&""!=a[h].techStopArriveDate?Math.abs(Date.parse(a[h].techStopArriveDate)-Date.parse(a[h].techStopDepartDate))/1e3/60:"";leaveStopTag=""!=i?'<span class="leave-stop-word">经停'+a[h].techStopAirportName+'</span><span class="air-port-hour">'+parseInt(i/60)+"h"+i%60+"m</span>":'<span class="leave-stop-word">经停'+a[h].techStopAirportName+"</span>"}else leaveStopTag="";g=""==a[h].planeName?"":"<span>| "+a[h].planeName+"</span>",e=Math.floor((new Date(a[h].arriveDate)-new Date(a[h].departDate))/1e3/60/60/24)>=1?"+"+Math.floor((new Date(a[h].arriveDate)-new Date(a[h].departDate))/1e3/60/60/24)+"天":"",c+='<div class="go-trip start"><div class="time-airport-info"><div class="start-time-info"><span class="time-number">'+f.timeCut(a[h].departDate)+'</span><span class="air-port-word">'+a[h].airportNameFrom+a[h].termDepart+'</span></div><div class="total-time-info detail-time-info"><span class="arrow-time"></span>'+leaveStopTag+'</div><div class="end-time-info"><span class="tip-add-days-seat">'+e+'</span><span class="time-number">'+f.timeCut(a[h].arriveDate)+'</span><span class="air-port-word-right">'+a[h].airportNameTo+a[h].termArrive+'</span></div></div><div class="bottom-word"><span>'+a[h].airCorpName+"</span><span>| "+a[h].airCorpCode+a[h].flightNo+"</span>"+g+b+"</div></div>"+d}return c}var e=ticketSeatChoose,f='<div class="ticket-detail-modal" style="display: none;"><ul class="detail-outer">'+b(a)+c(a)+"</ul></div>";return f},parseUrlPara:function(a,b){var b=b||!1,c=/([^=&?]+)=([^=&?]+)/g,d={};return a.replace(c,function(){var a=arguments;d[a[1]]=b?decodeURIComponent(a[2]):a[2]}),d},createHtml:function(){var a=JSON.parse(window.localStorage.getItem("flightListData")),b={},c=this,d=this.assistInfo.setId,e=document.querySelector(".all-elements"),f={},g="";a.forEach(function(a){return a.setID==d?void(b=a):void 0}),f=b,this.curFlightListData=f,this.storageUtil.set("curFlightListData",f),this.currentFlightData=f;var h="Return"==this.assistInfo.RouteType?"direction-double":"direction-single",i="",j='<header class="big-title"><i class="fl" onclick="window.history.go(-1)"></i><span class="set-place">'+f.cityNameFrom+'</span><i class="'+h+'"></i><span class="to-place">'+f.cityNameTo+"</span></header>",k="";k="domestic"==this.assistInfo.interNationalOrDomestic?'<div class="money-show-data money-show-data-domestic"><span class="tag-one"> ￥</span><span class="money-number">'+f.totalFareAmountADT+"</span></div>":"true"==this.assistInfo.hasTax?'<div class="money-show-data"><span class="tag-one"> ￥</span><span class="money-number">'+f.totalFareAmountExc+"</span><p>含税费</p></div>":'<div class="money-show-data"><span class="tag-one"> ￥</span><span class="money-number">'+f.totalFareAmountADT+"</span><p>税费￥"+f.totalTaxAmountADT+"</p></div>";var l='<div class="air_content" style="background:#f5f4f9;"><ul class="air-tickets-detail berths"><li class="air-tickets-detail-berths">'+c.createGoTripHtml(f)+c.createBackTripHtml(f)+'</li></ul><div class="price-important"><div class="left-part"><h4>'+f.segmentsLeave[0].cabinClassName+'</h4><p><span class="change" id="change-explain">退改签说明</span>'+i+"</p></div>"+k+'<button type="button" id="reserve-button">预订</button></div></div>';g='<div class="ticket-shadow" style="display: none"></div><div class="buy-ticket-notice back-meal" style="display: none;"><div class="header back-meal-close"><span>退改签说明</span><span><i></i></span></div><div class="content-notice "><p>退改签规则，以航司为准!</p></div></div>',e.innerHTML=j+l+g+this.createDetailModal(f)},init:function(){this.assistInfo=this.parseUrlPara(document.location.search,!0),this.createHtml(),this.loadingFade(),this.addEvent()}};ticketSeatChoose.init();