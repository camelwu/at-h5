/*! asiatravel FE team at-h5-nodejs-----2016-05-19T15:21:43 */
!function(){function a(){$(window).load(function(){$("#status").fadeOut(),$("#preloader").delay(400).fadeOut("medium")})}function b(){function a(){for(var a=g.RoomDetails,b=0,c=0,d=0;d<a.length;d++)b+=parseInt(a[d].adult),a[d].childWithOutBed&&(c+=a[d].childWithOutBed.length),a[d].childWithBed&&(c+=a[d].childWithBed.length);0==c&&$(".order-tsl2 b").remove(),$(".chi-tot").html(c),$(".adu-tot").html(b);var e={};return e.adunum=b,e.chinum=c,e}var b=template("order-flight",f);$(".order-plane").html(b);var c=template("order-hot",g);$(".order-hotel").html(c);var d="￥"+g.priceDetail.totalAmount;$(".card1").html(d);var e=template("totamount-det",g);$(".hf_detail_fare").html(e),a();var h=a();window.localStorage.peotot=h.adunum+h.chinum,window.localStorage.adunum=h.adunum,window.localStorage.chinum=h.chinum,$(".hf_det_mask").on("click",function(){$(".hf_det_mask").hide(),$(".detail-fale").removeClass("open"),$(".hf_detail_fare").css("bottom","-80px")}),$(document).on("click",".order-tsl3",function(){$("#status").show().fadeOut(),$("#preloader").show().delay(400).fadeOut("medium"),vlm.f_choice("order-twrap","f","traver","",!0,!0,h.adunum,h.chinum,null,f.flightInfo.flightLeaveStartDate)}),$(document).on("click",".hf_add_contact",function(){$("#status").show().fadeOut(),$("#preloader").show().delay(400).fadeOut("medium"),vlm.f_choice("hf-add-msg","f","contact","",!1,!1,null,null,null,null)}),$(".order-detail").click(function(){"-80px"==$(".hf_detail_fare").css("bottom")?($(".hf_det_mask").show(),$(".detail-fale").addClass("open"),$(".hf_detail_fare").css("bottom","47px")):($(".hf_det_mask").hide(),$(".detail-fale").removeClass("open"),$(".hf_detail_fare").css("bottom","-80px"))})}function c(){var a=!0;$(".con-alike").click(function(){if(localStorage.travellerInfo_selected){var b=JSON.parse(localStorage.travellerInfo_selected);a?($(this).css("backgroundPosition","-3px -52px"),$(".hf_con_lastname").val(b[0].LastName),$(".hf_con_firstname").val(b[0].FirstName),a=!1):($(this).css("backgroundPosition","-37px -52px"),$(".hf_con_lastname").val(""),$(".hf_con_firstname").val(""),$(".hf_con_cell").val(""),$(".hf_con_email").val(""),a=!0)}})}function d(a){a.onclick=function(){var a={Parameters:{SetID:g.SetID,CacheID:g.CacheID,CityCodeFrom:g.CityCodeFrom,CityCodeTo:g.CityCodeTo,DepartDate:g.DepartDate,ReturnDate:g.ReturnDate,HotelID:g.HotelID,RoomID:g.RoomID,MemberId:localStorage.memberid,ContactDetail:{SexCode:"Ms",FirstName:$(".hf_con_firstname").val(),LastName:$(".hf_con_lastname").val(),Email:$(".hf_con_email").val(),CountryNumber:$(".tel-btn span").html().substring(1),MobilePhone:$(".hf_con_cell").val()},CurrencyCode:g.CurrencyCode,TotalPrice:g.priceDetail.totalAmount},ForeEndType:3,Code:"50100004"};a.Parameters.RoomDetails=g.RoomDetails;for(var b=[],c=JSON.parse(localStorage.travellerInfo_selected),d=0;d<c.length;d++){var f={},h={};h.FirstName=c[d].FirstName,h.LastName=c[d].LastName,h.PassengerType=c[d].PassengerType,h.DateOfBirth=c[d].DateOfBirth,f.IdNumber=c[d].CertificateInfo.IdNumber,f.IdCountry=c[d].CertificateInfo.IdCountry,f.idType=c[d].CertificateInfo.IdType,f.IdActivatedDate=c[d].CertificateInfo.IdActivatedDate,h.CertificateInfo=f,h.SexCode=c[d].SexCode,h.CountryCode=c[d].CountryCode,b.push(h)}if(a.Parameters.TravellerInfo=b,$(".order-tlist2").length!=window.localStorage.peotot)return void jAlert("请添加出行人");var i=$(".hf_con_lastname");if(!vlm.Utils.validate.engName(i.val()))return void jAlert("请您输入英文的联系人姓");var j=$(".hf_con_firstname");if(!vlm.Utils.validate.engName(j.val()))return void jAlert("请您输入英文的联系人名");var k=$(".hf_con_cell")[0].value,l=$(".hf_con_email")[0].value;return vlm.Utils.validate.mobileNo(k)?vlm.Utils.validate.email(l)?(vlm.loading(),void vlm.loadJson("",JSON.stringify(a),e)):void jAlert("请输入正确的邮箱"):void jAlert("请输入正确的手机号")}}function e(a){var b=a;vlm.loadend(),b.success?window.location.href="../payment/payment.html?bookingRefNo="+b.data.bookingRefNo+"&type=FlightHotle":jAlert(b.message)}a();var f=JSON.parse(sessionStorage.flightHotelAllData).data,g=JSON.parse(localStorage.createOrderParaPart).data;b(),c();var h=document.querySelector(".order-submit");d(h)}();