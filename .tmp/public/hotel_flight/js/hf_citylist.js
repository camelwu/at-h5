/*! asiatravel FE team at-h5-nodejs-----2016-05-19T15:21:43 */
!function(a){a(document).ready(function(){window.addEventListener("load",function(){FastClick.attach(document.body)},!1)})}(jQuery),function(){var a,b={},c={},d={},e={},f=0,g={},h={};$("html,body").animate({scrollTop:0});var i=(vlm.parseUrlPara(window.location.href),"");$(".origin").click(function(){i=".origin",f=0,MT.LoadingShow(),e=JSON.parse(localStorage.getItem("hf_hotcity")),b=MT.XCache()?JSON.parse(localStorage.getItem("originCity")):c,MT.CreateCityList(b),MT.CreateHotCityList("origin",e),$(".all-elementcity").show(),$("#js_oversea").show(),MT.getCityHistory()}),$(".destination").click(function(){i=".destination",f=1,MT.LoadingShow(),e=JSON.parse(localStorage.getItem("hf_hotcity")),b=MT.XCache()?JSON.parse(localStorage.getItem("destinationCity")):c,MT.CreateCityList(b),MT.CreateHotCityList("destination",e),$(".all-elementcity").show(),$("#js_oversea").show(),MT.getCityHistory()}),MT.LoadingShow=function(){$("#preloader").show(),$("#status").show()},MT.LoadingHide=function(){$("#preloader").hide(),$("#status").hide()},$(".js-backpage").click(function(){$(".all-elementcity").hide(),$("#js_oversea").hide()}),MT.setCity=function(a,b,c){$(a).html(b),$(a).attr("data-citycode",c),$(".all-elementcity").hide(),$("#js_oversea").hide(),$(".pop_box_dis").hide(),$("body").attr("style","")},MT.getCity=function(){var a,b;a=localStorage.getItem("ac_city1"),b=localStorage.getItem("ac_city2"),a&&(a=JSON.parse(a),$(".origin").html(a[a.length-1].toString().split(":")[0]),$(".origin").attr("data-citycode",a[a.length-1].toString().split(":")[1])),b&&(b=JSON.parse(b),$(".destination").html(b[b.length-1].toString().split(":")[0]),$(".destination").attr("data-citycode",b[b.length-1].toString().split(":")[1]))},MT.ByCitylist=function(a,b){return a.fullSpellingName.replace(/(^\s*)|(\s*$)/g,"").substr(0,1).toUpperCase().charCodeAt(0)-b.fullSpellingName.replace(/(^\s*)|(\s*$)/g,"").substr(0,1).toUpperCase().charCodeAt(0)},MT.SplitCitiesArrayU2=function(a){for(var b,c,d=a,e=[],f=0,g=0;g<d.length-1;g++)b=d[g].fullSpellingName.replace(/(^\s*)|(\s*$)/g,"").substr(0,1).toUpperCase().charCodeAt(0),c=d[g+1].fullSpellingName.replace(/(^\s*)|(\s*$)/g,"").substr(0,1).toUpperCase().charCodeAt(0),b!=c&&(e.push(d.slice(f,g+1)),f=g+1);return e},MT.CreateCityList=function(a){$("#js_oversea > *").remove();var b=$('<li><span class="gui-city-t">历史选择</span><ul class="city-tags city-content1" id="historySea"></ul></li><li><span class="gui-city-t">热门城市</span><ul id="js_ExHotCity" class="city-tags city-content1"></ul></li>');$("#js_oversea").append(b);var c,d,e,f,g=a;d=MT.SplitCitiesArrayU2(g);for(var h=0;h<d.length;h++){var i=d[h][0].fullSpellingName.replace(/(^\s*)|(\s*$)/g,"").substr(0,1);c=$("<li id='"+i+"'></li>"),$("<span  class='gui-city-t'></span>").html(i).appendTo(c),e=$("<ul class='city-tags'></ul>"),e.appendTo(c),f=document.createDocumentFragment();for(var j=0;j<d[h].length;j++){var k=document.createElement("li");k.setAttribute("data-key",d[h][j].cityCode),k.setAttribute("data-value",d[h][j].fullSpellingName.replace(/(^\s*)|(\s*$)/g,"")),k.textContent=d[h][j].cityName,f.appendChild(k)}e.html(f).find("li").click(MT.ClickTags),$("#js_oversea").append(c)}MT.CharColumn("CharColumn",d)},MT.CreateHotCityList=function(a,b){if(b){var c;"destination"==a?(c=document.createDocumentFragment(),$.each(b.hotCitysInternational,function(a,b){var d=document.createElement("li");d.setAttribute("class","hot-city"),d.setAttribute("data-key",b.cityCode),d.textContent=b.cityName,c.appendChild(d)})):(c=document.createDocumentFragment(),$.each(b.hotCitysCN,function(a,b){var d=document.createElement("li");d.setAttribute("class","hot-city"),d.setAttribute("data-key",b.cityCode),d.textContent=b.cityName,c.appendChild(d)})),$("#js_ExHotCity").html(c).find("li").click(MT.ClickTags)}MT.LoadingHide()},MT.CharColumn=function(a,b){$("#"+a+" > *").remove();var c,d,e=$("#"+a);$("<li data-key='cur' data-value='当前'>历史</li>").appendTo(e),$("<li data-key='hot' data-value='热门'>热门</li>").appendTo(e);for(var f=0;f<b.length;f++){var g=b[f][0].fullSpellingName.substr(0,1);c=$("<li data-key='"+g+"' data-value='"+g+"'></li>"),d=$("<span class='tags' data-value='"+g+"'><span> ").html(g),d.appendTo(c),c.appendTo(e)}$("#CharColumn>li").each(function(a){$("#CharColumn>li").eq(a).click(function(){var b=$("#js_oversea>li").eq(a).offset().top;$("html,body").animate({scrollTop:b-44},300)})})},MT.setXCache=function(a){var b;b=a.data.updateTime.replace(/T\d{2}:\d{2}:\d{2}/,""),b=b.replace(/-/g,"/"),localStorage.setItem("XCacheTime",b)},MT.getXCache=function(a){var b,c,d;return(b=localStorage.getItem("XCacheTime"))?(c=new Date,c=c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate(),c=new Date(c),d=new Date(b),c>d?(localStorage.XCache="",!1):(localStorage.XCache=1,!0)):void MT.setXCache(a)},MT.isXCacheTime=function(a,b){a=new Date(a),b=new Date(b),a>b?localStorage.XCache="":localStorage.XCache=1},MT.getCityList=function(){var b,c;b=new Date,b=b.getFullYear()+"/"+(b.getMonth()+1)+"/"+b.getDate(),c=localStorage.getItem("XCacheTime"),MT.isXCacheTime(b,c),MT.getCity(),MT.XCache()?vlm.init():(a={Parameters:{},ForeEndType:3,Code:"50100010"},g={Parameters:{CityType:"1",LastTime:"2016-04-15"},ForeEndType:3,Code:"50100008"},h={Parameters:{CityType:"2",LastTime:"2016-04-15"},ForeEndType:3,Code:"50100008"},vlm.loadJson("",JSON.stringify(a),MT.CallbackExHotCity),vlm.loadJson("",JSON.stringify(h),MT.DestinationCallbackCityList),vlm.loadJson("",JSON.stringify(g),MT.OriginCallbackCityList))},MT.CallbackExHotCity=function(a){var b=a;b.success?(e=b.data,localStorage.setItem("hf_hotcity",JSON.stringify(e))):jAlert(b.message,"提示")},MT.OriginCallbackCityList=function(a){var b=a,d=!1;b.success?(d=MT.getXCache(b),d||MT.setXCache(b),c=b.data.citys.sort(MT.ByCitylist),localStorage.setItem("originCity",JSON.stringify(c))):jAlert(b.message,"提示")},MT.DestinationCallbackCityList=function(a){var b=a;b.success?(isXCache=MT.getXCache(b),isXCache||MT.setXCache(b),d=b.data.citys.sort(MT.ByCitylist),localStorage.setItem("destinationCity",JSON.stringify(d))):jAlert(b.message,"提示")},MT.getCityHistory=function(){var a;if(0==f&&(a=localStorage.getItem("ac_city1")),1==f&&(a=localStorage.getItem("ac_city2")),a=JSON.parse(a)){$("#historySea li").remove();for(var b=a.length-1;b>=0;b--){$('<li class="hot-city">').attr("data-key",a[b].toString().split(":")[1]).html(a[b].toString().split(":")[0]).appendTo("#historySea")}$("#historySea li").click(function(){var a=$(this).attr("data-key"),b=$(this).html();MT.setHistoryCity(b,a),MT.getCityHistory(),MT.setCity(i,b,a)})}},MT.setHistoryCity=function(a,b){var c;0==f&&(c=localStorage.getItem("ac_city1")),1==f&&(c=localStorage.getItem("ac_city2"));var d=[a+":"+b],e=[];if(c){c=JSON.parse(c);for(var g=c.length-1;g>=0;g--)if(c[g].toString().split(":")[1]===b)return e=c[g],MT.remove(c,g),c.push(e),e=c,0==f&&localStorage.setItem("ac_city1",JSON.stringify(e)),void(1==f&&localStorage.setItem("ac_city2",JSON.stringify(e)));c.length>2&&c.shift(),c.push(d),e=c,0==f&&localStorage.setItem("ac_city1",JSON.stringify(e)),1==f&&localStorage.setItem("ac_city2",JSON.stringify(e))}else e.push(d),0==f&&localStorage.setItem("ac_city1",JSON.stringify(e)),1==f&&localStorage.setItem("ac_city2",JSON.stringify(e))},MT.remove=function(a,b,c){var d=a.slice((c||b)+1||a.length);return a.length=0>b?a.length+b:b,a.push.apply(a,d)},MT.ClickTags=function(a){var b=$(this).attr("data-key"),c=$(this).html();MT.setHistoryCity(c,b),MT.getCityHistory(),MT.setCity(i,c,b)},$("#inputbox-btn").click(function(){$(".pop_box_dis,.pop_box .empty_history").show(),$("#seach_up").focus(),$("body").css("overflow-y","hidden"),data=b}),$(".pop_box #js_back_btn,.pop_box a.cancelBtn").click(function(){$(".pop_box_dis,.pop_box .not_exist,span#close_empty").hide(),$("#seach_up").val(""),$("#pop_list").html(""),$("body").attr("style","")});var j=!1;$("#seach_up").bind("input propertychange",function(){$("span#close_empty").show(),j&&$(".pop_box #pop_list:first").remove(),$(".pop_box .empty_history").hide();var a=$("#seach_up").val();a=a.toLowerCase();for(var b="",c=0;c<data.length;c++)(data[c].countryCode.toLowerCase()+data[c].cityCode.toLowerCase()+data[c].fullSpellingName.toLowerCase()+data[c].cityName+pinyin.getCamelChars(data[c].cityName).toLowerCase()).indexOf(a)>-1&&(b+="<li><p data-key="+data[c].cityCode+" data-value="+data[c].countryCode.toLowerCase()+data[c].cityCode.toLowerCase()+data[c].fullSpellingName+data[c].cityName+pinyin.getCamelChars(data[c].cityName).toLowerCase()+">"+data[c].cityName+"</p></li>");$("<ul>",{id:"pop_list",html:b}).addClass("pop_list").appendTo(".pop_box"),$("#pop_list").find("li>p").click(MT.ClickTags),""==$("#pop_list").html()?$(".pop_box .not_exist").show():$(".pop_box .not_exist").hide(),""==$("#seach_up").val()?($("#pop_list").html(""),$("span#close_empty").hide()):$("span#close_empty").show(),j=!0}),$(".pop_box #f").click(function(){$("#seach_up").val(""),$("#pop_list").html(""),$("#seach_up").focus(),$(".pop_box #pop_list").remove(),$(".pop_box .not_exist,span#close_empty").hide()}),$("span#close_empty").click(function(){$("span#close_empty").hide(),$("#seach_up").val("")}),$(".pop_box a.empty_history").click(function(){$(".pop_box .empty_history").hide()}),MT.getCityList()}();