/*! asiatravel FE team at-h5-nodejs-----2016-05-19T16:09:38 */
var val=vlm.parseUrlPara(window.location.href),changeFlightInfo,oldFlightInfo,type,filterSign=!1,flightList={requestUrl:"",getWeekDay:function(a){var b=a.substr(0,10).replace(/-/g,"/"),c="周"+"日一二三四五六".split("")[new Date(b).getDay()];return c},formatDate:function(a,b){a.indexOf("T")>-1&&(a=a.replace("T"," "),a.indexOf("-")>-1&&(a=a.replace(/-/g,"/")),a=new Date(a));var c=function(a){return a+="",a.replace(/^(\d)$/,"0$1")},d={yyyy:a.getFullYear(),yy:a.getFullYear().toString().substring(2),M:a.getMonth()+1,MM:c(a.getMonth()+1),d:a.getDay(),dd:c(a.getDate()),hh:c(a.getHours()),mm:c(a.getMinutes()),ss:c(a.getSeconds())};return b||(b="yyyy-MM-dd hh:mm:ss"),b.replace(/([a-z])(\1)*/gi,function(a){return d[a]})},replaceElement:function(a,b,c){for(var d=0;d<a.length;d++)a[d]==b&&(a[d]=c);return a},getFlightList:function(){var a=this;$("#departData").html(a.formatDate(oldFlightInfo.departDate,"MM-dd")),$("#returnData").html(a.formatDate(oldFlightInfo.returnDate,"MM-dd")),$("#departWeek").html(a.getWeekDay(a.formatDate(oldFlightInfo.departDate,"d"))),$("#returnWeek").html(a.getWeekDay(a.formatDate(oldFlightInfo.returnDate,"d")));var b=function(a){var b=a,d=flightList,e=b.data;if(b.success&&"200"==b.code&&e.flightInfoListGroup.length>0){$(".go_place").html(e.flightInfoListGroup[0].flightInfoList[0].cityNameFrom),$(".to_place").html(e.flightInfoListGroup[0].flightInfoList[0].cityNameTo);var f=$("#tplFlightList").html(),g=ejs.render(f,e);document.getElementById("fligtList").innerHTML=g,filterSign||(filterSign=!0,c(e));for(var h=document.getElementsByClassName("airway"),i=0;i<h.length;i++)h[i].getAttribute("data-airwaySetID")==changeFlightInfo.flightSetID&&(h[i].getElementsByClassName("hft_icon")[0].className="hft_icon cho_gou");$(".seat_detail").click(function(){$(this).find("b").addClass("cho_gou").parents().siblings().find("b").removeClass("cho_gou");for(var a=JSON.parse(sessionStorage.hftFlightHotelTourInfo),b=$(this).attr("data-setID"),c=0;c<e.flightInfoListGroup.length;c++)for(var d=0;d<e.flightInfoListGroup[c].flightInfoList.length;d++)e.flightInfoListGroup[c].flightInfoList[d].setID==b&&(a.flightInfo=e.flightInfoListGroup[c].flightInfoList[d],a.airwaySetID=e.flightInfoListGroup[c].flightInfoList[d].setID,a.airwayCacheID=e.flightInfoListGroup[c].flightInfoList[d].cacheID);sessionStorage.hftFlightHotelTourInfo=JSON.stringify(a),a=JSON.parse(sessionStorage.hftFlightHotelTourInfo),window.location.href="hft_choose.html"+window.location.search})}else d.noResult()},c=function(c){var d={hotelPosition:{title:"航空公司",c:"flight_company",type:3,s:1,key:"airways",listData:c.airways},hotelSort:{title:"快速排序",c:"foot_sort",type:1,s:1,key:"sortTypes",listData:c.sortTypes},hotelScreen:{title:"筛选",c:"foot_screen",type:2,s:2,key:"filters",listData:c.filters}},e=function(c){changeFlightInfo.flightSetID=c.airways.airwaySetID,changeFlightInfo.flightCacheID=c.airways.airwayCacheID,changeFlightInfo.sortFields=c.sortTypes,changeFlightInfo.filterFields=c.filters,a.tAjax("",changeFlightInfo,"60100005","3",b)};footer&&(footer.data=d,footer.callback=e),footer.filters.init()};this.tAjax("",oldFlightInfo,"60100005","3",b)},tAjax:function(a,b,c,d,e){var f=this,g={Parameters:b,ForeEndType:d,Code:c};a=a||f.requestUrl,vlm.loadJson(a,JSON.stringify(g),e)},noResult:function(){var a,b=document.createElement("div");b.className="flight_hotel_no_result",b.innerHTML='<div class="header" style="box-shadow: none;"><a id="pageBack" href="javascript:window.history.go(-1);" class="header_back"><i class="icon_back"></i></a><h3>自由行</h3></div><div class="no_result_search"><p>没有找到符合条件的产品</p></div> </div>',document.body.appendChild(b),a=document.querySelector(".flight_hotel_no_result")},init:function(){changeFlightInfo=JSON.parse(sessionStorage.hftChangeFlightPara),oldFlightInfo=JSON.parse(sessionStorage.hftChangeFlightPara),this.getFlightList()}};flightList.init();