/*! asiatravel FE team at-h5-nodejs-----2016-05-19T16:09:38 */
!function(){"use strict";function a(){$(window).load(function(){$("#status").fadeOut(),$("#preloader").delay(400).fadeOut("medium")})}function b(){function a(){for(var a=f.roomDetails,b=0,c=0,d=0;d<a.length;d++)b+=parseInt(a[d].adult),a[d].childWithOutBed&&(c+=a[d].childWithOutBed.length),a[d].childWithBed&&(c+=a[d].childWithBed.length);0==c&&$(".order_tsl2 b").remove(),$(".chi_tot").html(c),$(".adu_tot").html(b);var e={};return e.adunum=b,e.chinum=c,e}if(2==g){var b=$("#orderTour").html(),c=ejs.render(b,e);$("#hftTourTab").html(c)}else 1==g?$(".tour_section").remove():jAlert("资源选择页url:type=undefined");var d=$("#orderFlight").html(),h=ejs.render(d,e);$("#flightCirTab").html(h);var i=$("#orderHotel").html(),j=ejs.render(i,f);$("#hftHotelTab").html(j);var k=$("#orderFare").html(),l=ejs.render(k,f);$("#fareDetail").html(l);var m="￥"+f.totalPrice;$(".num1 >i").html(m),$(".hft_det_mask").on("click",function(){$(".hft_det_mask").hide(),$(".detail_fale").removeClass("open"),$(".hft_detail_fare").css("bottom","-8rem")});var n=!0;$(".num_tip").on("click",function(){n?($(".hft_det_mask").show(),$(".detail_fale").addClass("open"),$(".hft_detail_fare").css("bottom",".98rem"),n=!1):($(".hft_det_mask").hide(),$(".detail_fale").removeClass("open"),$(".hft_detail_fare").css("bottom","-8rem"),n=!0)}),a();var o=a();window.localStorage.hft_peotot=o.adunum+o.chinum,window.localStorage.hft_adunum=o.adunum,window.localStorage.hft_chinum=o.chinum,$(document).on("click",".add_traveller",function(){$("#status").show().fadeOut(),$("#preloader").show().delay(400).fadeOut("medium"),vlm.f_choice("orderTraveller","f","traver","",!0,!0,o.adunum,o.chinum,null,e.flightInfo.flightLeaveStartDate)})}function c(a){a.onclick=function(){var a={Parameters:{cityCodeFrom:f.cityCodeFrom,packageID:f.packageID,departDate:f.departDate,returnDate:f.returnDate,setID:f.setID,cacheID:f.cacheID,hotelID:f.hotelID,roomID:f.roomID,contactDetail:{sexCode:"Ms",firstName:$(".hft_con_firstname").val(),lastName:$(".hft_con_lastname").val(),email:$(".hft_con_email").val(),countryNumber:$(".tel-btn span").html().substring(1),mobilePhone:$(".hft_con_cell").val()},currencyCode:f.currencyCode,totalPrice:f.totalPrice,memberID:localStorage.memberid},foreEndType:2,code:"60100010"};if(2==g){a.Parameters.track=f.track;for(var b=[],c=0;c<e.tours.length;c++){var h=e.tours[c],i={};i.tourID=h.tourID,i.travelDate=h.travelDates[0];for(var j=[],k=0;k<h.tourSessions.length;k++){var l={};1==h.tourSessions[k].isSelected&&(l.tourSession=h.tourSessions[k].tourSessionName),j.push(l)}i.tourSession=j[0].tourSession,b.push(i)}a.Parameters.tours=b,a.foreEndType=2,a.code=60100010}else a.foreEndType=3,a.code=50100004;a.Parameters.RoomDetails=f.roomDetails;var m=[];if(localStorage.travellerInfo_selected){for(var n=JSON.parse(localStorage.travellerInfo_selected),c=0;c<n.length;c++){var o={},p={};p.firstName=n[c].FirstName,p.lastName=n[c].LastName,p.passengerType=n[c].PassengerType,p.dateOfBirth=n[c].DateOfBirth,o.idNumber=n[c].CertificateInfo.IdNumber,o.idCountry=n[c].CertificateInfo.IdCountry,o.idType=n[c].CertificateInfo.IdType,o.idActivatedDate=n[c].CertificateInfo.IdActivatedDate,p.certificateInfo=o,p.sexCode=n[c].SexCode,p.countryCode=n[c].CountryCode,m.push(p)}a.Parameters.travellerInfo=m}if($(".order_tlist2").length!=localStorage.hft_peotot)return void jAlert("请添加出行人");var q=$(".hft_con_lastname");if(!vlm.Utils.validate.engName(q.val()))return void jAlert("请您输入英文的联系人姓");var r=$(".hft_con_firstname");if(!vlm.Utils.validate.engName(r.val()))return void jAlert("请您输入英文的联系人名");var s=$(".hft_con_cell")[0].value,t=$(".hft_con_email")[0].value;return vlm.Utils.validate.mobileNo(s)?vlm.Utils.validate.email(t)?(vlm.loading(),void vlm.loadJson(vlm.apiWithDeviceID,JSON.stringify(a),d)):void jAlert("请输入正确的邮箱"):void jAlert("请输入正确的手机号")}}function d(a){var b=a;vlm.loadend(),b.success?window.location.href="../payment/payment.html?bookingRefNo="+b.data.bookingRefNo+"&type=FlightHotelTour":jAlert(b.message)}a();var e=JSON.parse(sessionStorage.hftFlightHotelTourInfo),f=JSON.parse(sessionStorage.hftCreateOrderPara);f.hotelName=e.hotelInfo.hotelName;var g=vlm.getpara("type"),h=window.location.href.split("?")[1];$("#hftFreeBack").click(function(){window.location.href="../hotel_flight_tour/hft_choose.html?"+h}),b();var i=document.querySelector(".order_submit");c(i)}();