/*! asiatravel FE team at-h5-nodejs-----2016-05-19T15:21:43 */
"use strict";var hftChoose={addHandler:function(a,b,c){document.addEventListener?this.addHandler=function(a,b,c){a.addEventListener(b,c,!1)}:document.attachEvent?this.addHandler=function(a,b,c){a.attachEvent("on"+b,function(){c.call(a)})}:this.addHandler=function(a,b,c){a["on"+b]=c},this.addHandler(a,b,c)},tAjax:function(a,b,c,d,e,f){var g=this,h={Parameters:b,ForeEndType:d,Code:c};a=a?a:g.requestUrl,f?vlm.loadJson(a,JSON.stringify(h),e,!1,!1,f):vlm.loadJson(a,JSON.stringify(h),e)},testLogin:function(){var a=window.sessionStorage,b=hftChoose;b.createOrderPara.memberID=window.localStorage.getItem("memberid"),a.setItem("hftCreateOrderPara",JSON.stringify(b.createOrderPara)),b.timer0=setTimeout(function(){window.clearTimeout(b.timer0),b.timer0=null,window.location.href=2==b.type?"../hotel_flight_tour/hft_order.html?type="+b.type+"&packageId="+b.initParaObj.packageID:"../hotel_flight_tour/hft_order.html?type="+b.type},500)},getCurrentStyle:function(a){var b=null;return b=window.getComputedStyle?window.getComputedStyle(a,null):a.currentStyle},addEvent:function(){var a=document.querySelector(".top_info i"),b=document.querySelector(".moreFlight"),c=document.querySelector(".moreHotel"),d=this,e=document.querySelector(".flightOuter"),f=document.querySelector(".hotelImgInfo"),g=document.querySelector(".priceTotal i"),h=document.querySelector(".preserve"),i=document.querySelector(".header_back"),j=null,k=null,l=document.querySelector(".priceDetailInfo"),m=document.querySelector(".roomUl"),n=document.querySelector(".check-more-room"),o=document.querySelector(".shadow"),p=window.sessionStorage;d.curChosenTourInfo={tourId:"",chosenDate:""},2==d.type&&(j=document.querySelector(".tourOuter"),k=document.querySelector(".chooseDate"),this.addHandler(j,"click",function(a){var a=a||window.event,b=a.target||a.srcElement;if("I"==b.tagName){d.curChosenTourInfo.tourId=b.parentNode.parentNode.getAttribute("data-tour-id"),k.style.transition="all 400ms ease-in",k.style.webkitTransition="all 400ms linear",o.style.display="block",k.style.bottom=".90rem",d.dateWrap=b.parentNode;var c=[],e=[],f="",g="",h=d.curData.tours,i=b.parentNode.parentNode.getAttribute("data-tour-id"),j=[];Array.prototype.distinct=function(){for(var a=function(b,c){var d=!0;if(!b||!c)return!1;for(var e in b){if(!c[e])return!1;if("object"==typeof b[e])d=a(b[e],c[e]);else if(b[e]!==c[e])return!1}return d},b=[],c={},d=0,e=this.length;e>d;d++)a(c[typeof this[d]+this[d]],this[d])||(b.push(this[d]),c[typeof this[d]+this[d]]=this[d]);return b};for(var l=function(){var a=arguments[0],b=[],c=[];return arguments[0].forEach(function(a,c){b.push(a.substring(0,7)),b=b.distinct()}),b.forEach(function(a){var b={name:a};b.values=[],c.push(b)}),c.forEach(function(b){a.forEach(function(a){a.substring(0,7)==b.name&&b.values.push(a)})}),c},m=0;m<h.length;m++)if(h[m].tourID==i){c=h[m].tourSessions,e=h[m].travelDates;break}j=l(e),f=$("#template_date_session").html(),g=ejs.render(f,{data:j}),$(".chooseDate").eq(0).html(g),d.dateArrayShow()}else"tour-list-title"==b.className&&(document.location.href="../hotel_flight_tour/hft_scenic_content.html?tourId="+b.parentNode.getAttribute("data-tour-id")+"&packageId="+d.initParaObj.packageID)}),this.addHandler(k,"click",function(a){var b,c,e,f,a=a||window.event,g=a.target||a.srcElement;if(c=document.querySelectorAll(".monthsDate"),k.style.transition="all 400ms ease-in",k.style.webkitTransition="all 400ms linear","取消"==g.innerHTML)o.style.display="none",k.style.bottom="-126%";else if("确定"==g.innerHTML){for(var h=0;h<c.length;h++)if("block"==d.getCurrentStyle(c[h]).display){e=c[h].querySelectorAll("span");break}for(var i=0;i<e.length;i++)if("active"==e[i].className){d.curChooseDate=e[i].getAttribute("data-date");break}d.curChosenTourInfo.chosenDate=d.curChooseDate,p.setItem("tourChosenInfo",JSON.stringify(d.curChosenTourInfo)),d.dateWrap.innerHTML='<span data-date="'+d.curChooseDate+'">'+d.returnDay(d.curChooseDate)+"</span><i></i>",o.style.display="none",k.style.bottom="-126%";var j=d.curData.tours,l=[],m="";m=d.dateWrap.parentNode.getAttribute("data-tour-id"),j.forEach(function(a){var b={};b.tourID=a.tourID,b.optionCode=a.selectOptionCode,b.travelDateSpecified=a.travelDateMandatory,m==a.tourID?b.travelDate=d.curChooseDate:b.travelDate=a.selectTravelDate,l.push(b)}),d.getNewPricePara.tours=l,d.getNewPricePara.flightCacheID=d.curData.flightInfo.cacheID,d.getNewPricePara.flightSetID=d.curData.flightInfo.setID,d.getNewPricePara.selectedHotelID=d.curData.hotelInfo.hotelID,d.getNewPricePara.selectedRoomID=d.roomPriceInfo.roomID,d.tAjax("",d.getNewPricePara,"60100009",3,d.renderHandler_)}else if("SPAN"==g.tagName&&g.getAttribute("data-m")){b=g.parentNode.querySelectorAll(".month-title");for(var n=0;n<b.length;n++)b[n].className=b[n]==g?"month-title active":"month-title";for(var q=0;q<c.length;q++)c[q].getAttribute("data-md")==g.getAttribute("data-m")?(c[q].className="monthsDate show",f=c[q].querySelectorAll("span")):c[q].className="monthsDate";for(var r=0;r<f.length;r++)f[r].className=0==r?"active":""}else if("SPAN"==g.tagName&&g.getAttribute("data-date")){d.curChooseDate=g.getAttribute("data-date"),b=g.parentNode.querySelectorAll("span");for(var s=0;s<b.length;s++)b[s].className=b[s]==g?"active":""}})),n&&"block"==d.getCurrentStyle(n).display&&this.addHandler(n,"click",function(){var a=this.innerText,b={},c="",e="",f=0;c=$("#template_room").html(),b.hotelInfo={},a.indexOf("查看")>-1?(b.hotelInfo.rooms=d.curData.hotelInfo.rooms,e=ejs.render(c,b),$(".roomUl").eq(0).html(e),this.innerHTML='收起更多房型<span class="check-more-up"></span>'):a.indexOf("收起")>-1&&(b.hotelInfo.rooms=d.curData.hotelInfo.rooms.slice(0,2),e=ejs.render(c,b),$(".roomUl").eq(0).html(e),f=d.curData.hotelInfo.rooms.length-2,this.innerHTML='查看更多房型<span class="letter-space">('+f+')</span><span class="check-more-down"></span>')}),this.addHandler(a,"click",function(){window.location.href=1==d.type?"index.html?type="+d.type:"hft_scenic_list.html?="+d.type}),this.addHandler(i,"click",function(){window.location.href=1==d.type?"index.html?type="+d.type:"hft_scenic_list.html?="+d.type}),this.addHandler(b,"click",function(){var a=d.curData.tours,b={},c=[];b={cityCodeFrom:d.initParaObj.cityCodeFrom,cityCodeTo:d.initParaObj.cityCodeTo,departDate:d.initParaObj.departDate,returnDate:d.initParaObj.returnDate,roomDetails:d.initParaObj.roomDetails,flightCacheID:d.curData.flightInfo.cacheID,flightSetID:d.curData.flightInfo.setID},2==d.type?(a.forEach(function(a){var b={};b.tourID=a.tourID,b.travelDate=a.selectTravelDate,b.optionCode=a.selectOptionCode,b.travelDateSpecified=a.travelDateMandatory,c.push(b)}),b.tours=c,b.packageID=d.initParaObj.packageID):(b.airwaySetID=d.curData.flightInfo.setID,b.airwayCacheID=d.curData.flightInfo.cacheID,b.SortFields=[0],b.ScreenFields=[0],b.FlightStartTime=0),p.setItem("hftChangeFlightPara",JSON.stringify(b)),d.timer1=setTimeout(function(){window.clearTimeout(d.timer1),d.timer1=null,window.location.href=2==d.type?"hft_flight_list.html?type="+d.type+"&packageId="+d.initParaObj.packageID:"hf_flight_list.html?type="+d.type},500)}),this.addHandler(c,"click",function(){var a=d.curData.tours,b={},c=[];b={flightCacheID:d.curData.flightInfo.cacheID,flightSetID:d.curData.flightInfo.setID,cityCodeFrom:d.initParaObj.cityCodeFrom,cityCodeTo:d.initParaObj.cityCodeTo,departDate:d.initParaObj.departDate,returnDate:d.initParaObj.returnDate,roomDetails:d.initParaObj.roomDetails,selectedHotelID:d.curData.hotelInfo.hotelID,selectedRoomID:d.roomPriceInfo.roomID,sortFields:[0],pageNo:1,pageSize:20},2==d.type&&(a.forEach(function(a){var b={};b.tourID=a.tourID,b.travelDate=a.selectTravelDate,b.optionCode=a.selectOptionCode,b.travelDateSpecified=a.travelDateMandatory,c.push(b)}),b.packageID=d.initParaObj.packageID,b.tours=c),p.setItem("hftChangeHotelPara",JSON.stringify(b)),d.timer2=setTimeout(function(){window.clearTimeout(d.timer2),d.timer2=null,window.location.href=2==d.type?"hft_hotel_list.html?type="+d.type+"&packageId="+d.initParaObj.packageID:"hf_hotel_list.html?type="+d.type},500)}),this.addHandler(e,"click",function(){window.location.href=2==d.type?"hft_flightDetail.html?type="+d.type+"&packageId="+d.initParaObj.packageID:"hft_flightDetail.html?type="+d.type}),this.addHandler(f,"click",function(){var a={},b=d.curData.tours,c=[];a={cityCodeFrom:d.initParaObj.cityCodeFrom,cityCodeTo:d.initParaObj.cityCodeTo,departDate:d.initParaObj.departDate,returnDate:d.initParaObj.returnDate,selectedHotelID:d.curData.hotelInfo.hotelID,selectedRoomID:d.roomPriceInfo.roomID,hotelID:d.curData.hotelInfo.hotelID,roomDetails:d.initParaObj.roomDetails,flightCacheID:d.curData.flightInfo.cacheID,flightSetID:d.curData.flightInfo.setID},2==d.type?(b.forEach(function(a){var b={};b.tourID=a.tourID,b.travelDate=a.selectTravelDate,b.optionCode=a.selectOptionCode,b.travelDateSpecified=a.travelDateMandatory,c.push(b)}),a.tours=c,a.packageID=d.initParaObj.packageID):a.hotelAdditionalPrice=d.roomPriceInfo.addtionalPrice,p.setItem("hftHotelDetailPara",JSON.stringify(a)),d.timer3=setTimeout(function(){window.clearTimeout(d.timer3),d.timer3=null,window.location.href=2==d.type?"hft_hotel_detail.html?type="+d.type+"&packageId="+d.initParaObj.packageID+"&selectedRoomId="+d.roomPriceInfo.roomID:"hf_hotel_detail.html?type="+d.type+"&selectedRoomId="+d.roomPriceInfo.roomID},500)}),this.addHandler(h,"click",function(){var a=null,b={},c=[];b={cityCodeFrom:d.initParaObj.cityCodeFrom,cityCodeTo:d.initParaObj.cityCodeTo,departDate:d.initParaObj.departDate,returnDate:d.initParaObj.returnDate,setID:d.curData.flightInfo.setID,cacheID:d.curData.flightInfo.cacheID,hotelID:d.curData.hotelInfo.hotelID,roomID:d.roomPriceInfo.roomID,roomDetails:d.initParaObj.roomDetails,currencyCode:"CNY",totalPrice:d.roomPriceInfo.totalAmount,memberID:"",priceRoomInfo:d.roomPriceInfo,track:{browserType:"",deviceID:""}},2==d.type&&(a=d.curData.tours,a.forEach(function(a){var b={};b.tourID=a.tourID,b.travelDate=a.selectTravelDate,b.tourSession=a.tourSessions,c.push(b)}),b.tours=c,b.packageID=d.initParaObj.packageID),d.createOrderPara=b,d.testLogin()}),this.addHandler(g,"click",function(a){var b,a=a||window.event,c=a.target||a.srcElement;"I"==c.tagName&&(b=d.getCurrentStyle(o).display,l.style.transition="all 400ms ease-in",l.style.webkitTransition="all 400ms linear","block"==b?(o.style.display="none",c.className="detail_fare",l.style.bottom="-126%"):(o.style.display="block",c.className="detail_fare open",l.style.bottom=".89rem"))}),this.addHandler(m,"click",function(a){var b,a=a||window.event,c=a.target||a.srcElement;if("BUTTON"==c.tagName){var e=this.querySelectorAll("button");b=c.parentNode.parentNode.getAttribute("data-room-id"),d.createPriceEle(b);for(var f=0;f<e.length;f++)e[f].innerHTML=e[f]==c?"已选择":"选择",e[f].className=e[f]==c?"hasChooseButton":"noChooseButton"}})},dateArrayShow:function(){for(var a,b=document.querySelectorAll(".month-title"),c=document.querySelectorAll(".monthsDate"),d=0;d<b.length;d++)b[d].className=0==d?"month-title active":"month-title";for(var e=0;e<c.length;e++)c[e].getAttribute("data-md")==b[0].getAttribute("data-m")?(c[e].className="monthsDate show",a=c[e].querySelectorAll("span")):c[e].className="monthsDate";for(var f=0;f<a.length;f++)a[f].className=0==f?"active":""},renderHandler:function(){var a=arguments[0],b=hftChoose,c=null,d=window.sessionStorage,e={};1==a.success&&"200"==a.code?(c=a.data,e.airwayCacheID=c.airwayCacheID,e.airwaySetID=c.airwaySetID,b.curData=c,d.setItem("hftFlightHotelTourInfo",JSON.stringify(c)),d.setItem("originAirIds",JSON.stringify(e)),b.createTags(c).createPriceEle().addEvent(),$("#status").fadeOut(),$("#preloader").delay(400).fadeOut("medium")):(b.noResult(),jAlert(a.message))},renderHandler_:function(){var a=arguments[0],b=hftChoose;if(200==a.code&&1==a.success){var c=(a.data.totalAmount,[]),d=JSON.parse(window.sessionStorage.getItem("tourChosenInfo"));c=b.curData.tours,d&&c.forEach(function(a){a.tourID==d.tourId&&(a.selectTravelDate=d.chosenDate)}),b.curData.tours=c,b.roomPriceInfo=a.data.prices,b.curData.hotelInfo.rooms=a.data.roomsPrice,b.renderHandler({success:1,code:200,data:b.curData})}else b.noResult(),jAlert(a.message)},renderHandler_f:function(){var a=arguments[0],b=hftChoose;200==a.code&&1==a.success?(b.curData.hotelInfo=a.data.hotelInfo,b.curData.flightInfo=a.data.flightInfo,b.curData.airwayCacheID=a.data.airwayCacheID,b.curData.airwaySetID=a.data.airwaySetID,b.renderHandler({success:1,code:200,data:b.curData})):(b.noResult(),jAlert(a.message))},noResult:function(){$("#status").fadeOut(),$("#preloader").delay(400).fadeOut("medium");var a=function(){var a=document.querySelector(".header_back");d.addHandler(a,"click",function(){window.location.href=1==d.type?"index.html?type="+d.type:"hft_scenic_list.html?type="+d.type})},b="",c="",d=hftChoose;b=$("#template_no_result").html(),c=ejs.render(b,{}),$(".all_elements").eq(0).html(c),a()},createPriceEle:function(){var a="",b=null,c=hftChoose,d=null,e="",f=document.querySelector(".priceTotal span"),g=document.querySelector(".priceDetailInfo");return a=this.urlParseObj.selectedRoomId||arguments[0],d=c.curData.hotelInfo.rooms,a?d.forEach(function(c,d){return c.roomID==a?void(b=c):void 0}):b=d[0],c.roomPriceInfo=b,b.prices.forEach(function(a,b){1==a.category?e+='<p>成人<span class="price-num-price">￥<span>'+a.amount+"X"+a.quantity+"</span></span></p>":2==a.category&&(e+='<p>儿童<span class="price-num-price">￥<span>'+a.amount+"X"+a.quantity+"</span></span></p>")}),f.innerHTML=b.totalAmount,g.innerHTML=e,c},returnDay:function(){var a=[],b=arguments[0];return a=b.split("-"),a[1]=a[1]<10?"0"+parseInt(a[1]):parseInt(a[1]),a[2]=a[2]<10?"0"+parseInt(a[2]):parseInt(a[2]),a[1]+"月"+a[2]+"日"},setWeekItems:function(){var a=arguments[0].replace(/T.*/,""),b=new Date(a.replace(/-/g,"/")).getDay(),c="";switch(b){case 0:c="周日";break;case 1:c="周一";break;case 2:c="周二";break;case 3:c="周三";break;case 4:c="周四";break;case 5:c="周五";break;case 6:c="周六"}return c},setChineseStar:function(){var a=arguments[0].substr(0,1),b="";switch(a.charCodeAt(0)){case 49:b="一星级";break;case 50:b="二星级";break;case 51:b="三星级";break;case 52:b="四星级";break;case 53:b="五星级";break;case 54:b="六星级";break;case 55:b="七星级"}return b},createTags:function(){var a=arguments[0],b=hftChoose,c="",d="",e="",f="";return c=$("#template").html(),d=ejs.render(c,a),$(".all_elements").eq(0).html(d),2==b.type&&(e=$("#template_tour").html(),f=ejs.render(e,a),$(f).insertAfter("#hotel")),b},parseUrlPara:function(a,b){var b=b||!1,c=/([^=&?]+)=([^=&?]+)/g,d={};return a.replace(c,function(){var a=arguments;d[a[1]]=b?decodeURIComponent(a[2]):a[2]}),d},tourParaObjHandler:function(){var a=[],b=arguments[0];return b.tours.forEach(function(b){var c={};c.tourID=b.tourID,c.travelDate=b.selectTravelDate,c.optionCode="",c.travelDateSpecified=b.travelDateMandatory,a.push(c)}),a},init:function(){var a=JSON.parse(window.localStorage.getItem("searchInfo")),b={},c={},d=window.sessionStorage,e={},f={};e=JSON.parse(d.getItem("originAirIds")),f=JSON.parse(d.getItem("hftFlightHotelTourInfo")),c=this.parseUrlPara(document.location.search,!0);var g={cityCodeFrom:a.FromCity,cityCodeTo:a.ToCity,departDate:a.DepartDate,returnDate:a.ReturnDate,roomDetails:a.RoomInfo};for(var h in g)b[h]=g[h];this.getNewPricePara=b,this.initParaObj=g,this.urlParseObj=c,this.type=c.type,this.curData=f,this.cacheOtherInfo={adult:a.AdultNum,child:a.ChildNum,cityNameForm:a.FromCityNameCN,cityNameTo:a.ToCityNameCN},e&&f?e.airwaySetID!=f.airwaySetID||e.airwayCacheID!=f.airwayCacheID?(this.initParaObj.flightSetID=f.airwaySetID,this.initParaObj.flightCacheID=f.airwayCacheID,"2"==this.type?(this.initParaObj.tours=this.tourParaObjHandler(f),this.initParaObj.packageID=c.packageId,this.getNewPricePara.packageID=this.initParaObj.packageID,this.tAjax("",this.initParaObj,"60100006",3,this.renderHandler_f)):"1"==this.type&&(delete this.initParaObj.packageID,this.tAjax("",this.initParaObj,"50100001",3,this.renderHandler))):("2"==this.type&&(this.initParaObj.packageID=c.packageId,this.getNewPricePara.packageID=this.initParaObj.packageID),this.renderHandler({code:200,success:1,data:f})):"2"==this.type?(this.initParaObj.packageID=c.packageId,this.getNewPricePara.packageID=this.initParaObj.packageID,this.tAjax("",this.initParaObj,"60100004",3,this.renderHandler)):"1"==this.type&&(delete this.initParaObj.packageID,this.tAjax("",this.initParaObj,"50100001",3,this.renderHandler))}};hftChoose.init();