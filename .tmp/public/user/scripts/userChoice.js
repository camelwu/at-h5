/*! asiatravel FE team at-h5-nodejs-----2016-05-19T15:21:43 */
function mycallback(ret){travJson=eval("("+ret+")");var blank=$("#blank")[0];if(travJson.success)if(0==travJson.data.length)blank.style.display="block";else{blank.style.display="none";var content=$("#content")[0],UL=document.createElement("ul");UL.className="often-traveler",UL.style.borderTop="1px solid #dedede",UL.style.marginTop="10px";for(var i=0;i<travJson.data.length;i++){array[i]=travJson.data[i].traveller.travellerId,arrayId[i]=travJson.data[i].traveller.Id;var li=document.createElement("li");li.className="eve-traveler";var b=document.createElement("b");b.className="bu_icon user-edits",b.style.marginTop=li.clientHeight+20+"px",b.addEventListener("click",updateTra),li.appendChild(b);var ul=document.createElement("ul");ul.className="often_user";var ul_li1=document.createElement("li");ul_li1.innerHTML=travJson.data[i].traveller.idName+travJson.data[i].traveller.lastName+"/"+travJson.data[i].traveller.firstName,ul.appendChild(ul_li1);var ul_li2=document.createElement("li");"1"==travJson.data[i].listTravellerIdInfo[0].idType?ul_li2.innerHTML="护照 "+travJson.data[i].listTravellerIdInfo[0].idNumber:"2"==travJson.data[i].listTravellerIdInfo[0].idType?ul_li2.innerHTML="身份证 "+travJson.data[i].listTravellerIdInfo[0].idNumber:"3"==travJson.data[i].listTravellerIdInfo[0].idType?ul_li2.innerHTML="出生证明 "+travJson.data[i].listTravellerIdInfo[0].idNumber:"4"==travJson.data[i].listTravellerIdInfo[0].idType?ul_li2.innerHTML="港澳通行证 "+travJson.data[i].listTravellerIdInfo[0].idNumber:"5"==travJson.data[i].listTravellerIdInfo[0].idType?ul_li2.innerHTML="军官证 "+travJson.data[i].listTravellerIdInfo[0].idNumber:"6"==travJson.data[i].listTravellerIdInfo[0].idType?ul_li2.innerHTML="驾驶证 "+travJson.data[i].listTravellerIdInfo[0].idNumber:"7"==travJson.data[i].listTravellerIdInfo[0].idType?ul_li2.innerHTML="台胞证 "+travJson.data[i].listTravellerIdInfo[0].idNumber:"8"==travJson.data[i].listTravellerIdInfo[0].idType?ul_li2.innerHTML="回乡证 "+travJson.data[i].listTravellerIdInfo[0].idNumber:ul_li2.innerHTML="其他 "+travJson.data[i].listTravellerIdInfo[0].idNumber,ul.appendChild(ul_li2);var ul_li3=document.createElement("li");ul_li3.innerHTML="手机号 "+travJson.data[i].traveller.mobilePhone,ul.appendChild(ul_li3),li.appendChild(ul),li.setAttribute("index",i),UL.appendChild(li)}content.appendChild(UL)}else alert(travJson.message)}function mycallback_addtrav(ret){var myJson=eval("("+ret+")");myJson.success?document.getElementById("addForm").submit():alert(myJson.message)}function mycallback_deltrav(ret){var myJson=eval("("+ret+")");myJson.success?window.location.href="user-oftenInfo.html":alert(myJson.message)}function mycallback_uptrav(ret){var myJson=eval("("+ret+")");myJson.success?document.getElementById("updateForm").submit():alert(myJson.message)}function updateTra(){var a=window.event.srcElement,b=a.parentElement;index=b.getAttribute("index");var c=$("#uptra_page")[0];c.style.display="block";var d=document.getElementById("updateForm").getElementsByTagName("input"),e=$("#cardType")[0],f=$("#countryName")[0],g=$("#man2")[0],h=$("#woman2")[0];d[0].value=travJson.data[index].traveller.idName,d[1].value=travJson.data[index].traveller.lastName,d[2].value=travJson.data[index].traveller.firstName,d[3].value=travJson.data[index].traveller.idNumber,d[5].value=travJson.data[index].traveller.email,"1"==travJson.data[index].listTravellerIdInfo[0].idType?e.innerHTML="护照":"2"==travJson.data[index].listTravellerIdInfo[0].idType?e.innerHTML="身份证":"3"==travJson.data[index].listTravellerIdInfo[0].idType?e.innerHTML="出生证明":"4"==travJson.data[index].listTravellerIdInfo[0].idType?e.innerHTML="港澳通行证":"5"==travJson.data[index].listTravellerIdInfo[0].idType?e.innerHTML="军官证":"6"==travJson.data[index].listTravellerIdInfo[0].idType?e.innerHTML="驾驶证":"7"==travJson.data[index].listTravellerIdInfo[0].idType?e.innerHTML="台胞证":"8"==travJson.data[index].listTravellerIdInfo[0].idType?e.innerHTML="回乡证":e.innerHTML="其他",f.innerHTML=travJson.data[index].traveller.countryName,"Mr"==travJson.data[index].traveller.sexCode?(g.className="icon-h traveler-sex1",h.className="icon-h traveler-sex2"):(g.className="icon-h traveler-sex2",h.className="icon-h traveler-sex1")}function showAddAir_page(){var a=document.getElementById("addAir-page");a.style.display="block"}function closeAddAir_page(){var a=document.getElementById("addAir-page");a.style.display="none"}function showChild_page(){var a=document.getElementById("childen-page");a.style.display="block"}function closeChild_page(){var a=document.getElementById("childen-page");a.style.display="none"}function choseSex(){var a,b,c=$("#man")[0];"icon-h traveler-sex1"==c.className?(a="Mr",b="男"):(a="Mrs",b="女")}function input_ulist(a){var b=JSON.parse(a),c=template(tpl_u,b.data);$("#allList").html(c)}function redicturl(){window.opener?window.close():window.history.go(-1)}var index,array=[],arrayId=[],travJson;$(function(){function a(a,b){a.onclick=function(){b.style.display="block"}}function b(a,b){a.onclick=function(){b.style.display="none"}}function c(a){a.onclick=function(){var a,b=document.getElementById("addForm").getElementsByTagName("input"),c=document.getElementById("postCard").innerHTML;if(""==b[1].value||""==b[2].value)return void alert("英文姓名为必填信息");a="护照"==c?"1":"身份证"==c?"2":"出生证明"==c?"3":"港澳通行证"==c?"4":"军人证"==c?"5":"驾驶证"==c?"6":"台胞证"==c?"7":"回乡证"==c?"8":"9";var d,e,f=$("#man")[0];"icon-h traveler-sex1"==f.className?(d="Mr",e="男"):(d="Mrs",e="女");var g=$("#mobile-cell-add")[0].value,i=$("#email-cell-add")[0].value;if(vlm.Utils.validate.mobileNo(g)&&vlm.Utils.validate.email(i)){var j={Parameters:'{"Traveller":{"IdName":"'+b[0].value+'","LastName":"'+b[1].value+'","FirstName":"'+b[2].value+'","CountryCode":"CN","CountryName":"中国","SexCode":"'+d+'","SexName":"'+e+'","DateOfBirth":"1932-06-15","Email":"'+b[5].value+'","MemberId":"'+h+'","MobilePhone":"'+b[4].value+'"},"ListTravellerIdInfo":[{"IdType":2,"IdNumber":"'+b[3].value+'","IdCountry":"CN","IdActivatedDate":"2016-02-13"}]}',ForeEndType:3,Code:"0071"};vlm.loadJson("",JSON.stringify(j),mycallback_addtrav)}else alert("请输入正确的邮箱和电话号码")}}function d(a){a.onclick=function(){var a,b=array[index],c=arrayId[index],d=document.getElementById("updateForm").getElementsByTagName("input"),e=document.getElementById("cardType").innerHTML;document.getElementById("countryName").innerHTML;if(""==d[1].value||""==d[2].value)return void alert("英文姓名为必填信息");var f,g,i=$("#man2")[0];"icon-h traveler-sex1"==i.className?(f="Mr",g="男"):(f="Mrs",g="女"),a="护照"==e?"1":"身份证"==e?"2":"出生证明"==e?"3":"港澳通行证"==e?"4":"军人证"==e?"5":"驾驶证"==e?"6":"台胞证"==e?"7":"回乡证"==e?"8":"9";var j=$("#mobile-cell")[0].value,k=$("#email-cell")[0].value;if(vlm.Utils.validate.mobileNo(j)&&vlm.Utils.validate.email(k)){var l={Parameters:'{"Traveller":{"TravellerId":'+b+',"IdName":"'+d[0].value+'","LastName":"'+d[1].value+'","FirstName":"'+d[2].value+'","CountryCode":"CN","CountryName":"中国","SexCode":"'+f+'","SexName":"'+g+'","DateOfBirth":"1932-06-15","Email":"'+d[5].value+'","MemberId":"'+h+'","MobilePhone":"'+d[4].value+'"},"ListTravellerIdInfo":[{"Id":'+c+',"TravellerId":'+b+',"IdType":2,"IdNumber":"'+d[3].value+'","IdCountry":"CN","IdActivatedDate":"2016-02-13"}]}',ForeEndType:3,Code:"0072"};vlm.loadJson("",JSON.stringify(l),mycallback_uptrav)}else alert("请输入正确的手机号和邮箱")}}function e(a){a.onclick=function(){var a=array[index],b=(arrayId[index],{Parameters:'{"travellerId":'+a+"}",ForeEndType:3,Code:"0073"});vlm.loadJson("",JSON.stringify(b),mycallback_deltrav)}}var f=location.href;if(-1!=f.indexOf("user-oftenInfo")){var g=$("#menu")[0];g.style.display="none";var h=localStorage.memberid||sessionStorage.memberid,i={Parameters:'{"memberId":'+h+"}",ForeEndType:3,Code:"0074"};vlm.loadJson("",JSON.stringify(i),mycallback);var j=$("#addtra_page")[0],k=$("#addUser")[0],l=$("#add_quit")[0],m=$("#uptra_page")[0],n=$("#update_quit")[0],o=$("#name_state")[0],p=$("#aname_state")[0],q=$("#fillName_page")[0],r=$("#close_name")[0];a(k,j),a(o,q),a(p,q),b(l,j),b(n,m),b(r,q);var s=$("#add_finish")[0];c(s);var t=$("#upadate_finish")[0];d(t);var u=$("#delTra")[0];e(u)}}),function(){for(var a=document.querySelectorAll(".sex-cho-wrap"),b=0;b<a.length;b++)!function(c){var d=a[c].querySelectorAll("b");for(j=0;j<d.length;j++)d[j].onclick=function(){for(b=0;b<d.length;b++)d[b].className="icon-h traveler-sex2";this.className="icon-h traveler-sex1"}}(b)}(),vlm.init(),localStorage.cc="1364324823748234";var tpl_u=['<li class="eve-traveler">','<b class="icon user-choice{% if(localStorage.cc==listTravellerIdInfo[0]["idNumber"]){ %}1{% }else{ %}2{% } %}"></b>','<b class="icon user-edit"></b>','<ul class="often_user">','<li>{%=traveller["idName"]%}{%=traveller["firstName"]%}</li>','<li>身份证 <span>{%=listTravellerIdInfo[0]["idNumber"]%}</span></li>',"</ul>","</li>"].join(""),sdata={Parameters:"{\"memberId\":'494258'}",ForeEndType:3,Code:"0074"};vlm.loadJson("",JSON.stringify(sdata),input_ulist),$("#chn-name .foreign").click(function(){$("#chn-name").hide(),$("#eng-name").show()}),$("#eng-name .chn").click(function(){$("#chn-name").show(),$("#eng-name").hide()}),$(".name-notes").click(function(){$(".fillName-page").show()}),$(".name-eng-note").click(function(){$(".fillName-page").show()}),$(".name-illustrate").click(function(){$("#fillName-page").hide()}),$(".con-mobile-list li").click(function(){redicturl()}),document.querySelector(".header-back").onclick=function(){redicturl()};var myDate1=new Scroller({id:"birth-cont",type:"birth",cont:"week_span2"}),myDate2=new Scroller({id:"time-cont",type:"birth",cont:"week_span2"}),myDate2=new Scroller({id:"postCard",type:"card",cont:"week_span2"}),myDate3=new Scroller({id:"birth-cont-edit",type:"birth",cont:"week_span2"}),myDate3=new Scroller({id:"time-cont-edit",type:"birth",cont:"week_span2"}),myDate3=new Scroller({id:"cardType",type:"card",cont:"week_span2"}),myDate4=new Scroller({id:"birth-cont-per",type:"birth",cont:"week_span2"}),userSub={state:"",parseUrlPara:function(a,b){var b=b||!1,c=/([^=&?]+)=([^=&?]+)/g,d={};return a.replace(c,function(){var a=arguments;d[a[1]]=b?decodeURIComponent(a[2]):a[2]}),d},addHandler:function(a,b,c){return document.addEventListener?this.addHandler=function(a,b,c){a.addEventListener(b,c,!1)}:document.attachEvent?this.addHandler=function(a,b,c){a.attachEvent("on"+b,function(){c.call(a)})}:this.addHandler=function(a,b,c){a["on"+b]=c},this.addHandler(a,b,c),this},eventBind:function(){var a=document.querySelector(".header-quit"),b=this,c=document.querySelector(".often-traveler.list-traveler"),d=document.querySelector(".often-traveler.choosed-traveler"),e=document.querySelector(".adult-number"),f=this;this.addHandler(a,"click",function(){"edit"==b.state&&(window.opener?window.close():window.history.go(-1))}).addHandler(c,"click",function(){var a=a||window.event,b=a.target||a.srcElement;"icon user-edit"==b.className?document.querySelector("#addAir-page").style.display="block":"icon user-choice2"==b.className&&(b.className="icon user-choice1",c.removeChild(b.parentNode),d.appendChild(b.parentNode),e.innerHTML=d.querySelectorAll("li").length+"/"+f.ruleNUmber.NumofAdult)}),this.addHandler(d,"click",function(){var a=a||window.event,b=a.target||a.srcElement;"icon user-edit"==b.className&&(document.querySelector("#addAir-page").style.display="block")})},showBox:function(){},init:function(){var a=this.parseUrlPara(document.location.search,!0);this.ruleNUmber=a,this.state=a.type,"edit"==this.state&&(document.querySelector("#addAir-page").style.display="block"),this.eventBind()}};userSub.init();