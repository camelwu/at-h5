/*! asiatravel FE team at-h5-nodejs-----2016-05-19T15:21:43 */
!function(){var a,b,c,d;(function(){var e={Visa:{id:1,name:"Visa信用卡"},Master:{id:20,name:"万事达信用卡"},Paypal:{id:21,name:"万事达信用卡"},UnionPayCNY:{id:28,name:"万事达信用卡"},AliPayCNY:{id:27,name:"万事达信用卡"}},f={Hotle:{id:1,name:"酒店",detailCode:"0013",payMentCode:"0012"},Flight:{id:2,name:"机票",detailCode:"3006",payMentCode:"3004"},Scenic:{id:3,name:"景点",detailCode:"0095",payMentCode:"0093"},Tour:{id:4,name:"酒+景",detailCode:"0095",payMentCode:"0203"},FlightHotle:{id:5,name:"机+酒",detailCode:"50100007",payMentCode:"50100005"},FlightHotelTour:{id:6,name:"机+酒+景",detailCode:"60100013",payMentCode:"60100011"}},g={bindPaymentTypeEvent:function(){$(".p-pay li").on("click",function(){c=$(this).attr("data-paymentmode"),d=$(this).attr("data-cardtype"),"CreditCard"==c?($(".paymentype-session").hide(),$(".credit-session").show()):k(),$(".credit-session input").attr("value","")}),$(".credit-session .icon_back").on("click",function(){$(".paymentype-session").show(),$(".credit-session").hide()}),$(".tel_tip").on("click",function(){$(".jpop_box_tic").show()}),$(".jpop_box_tic span,.jpop_box_tic a").click(function(){$(".jpop_box_tic").hide()}),$(".p-but").on("click",function(){k()})},expityDateInit:function(){new Scroller({id:"jp_limit_time",type:"cardExpirationDate",cont:"cardExpirationDate1",callback:function(){var a=document.getElementById("jp_limit_time"),b=a.getAttribute("data-expire"),c=(new Date).getTime();b=new Date(b).getTime(),c>b&&$.alerts.alert("有效期应大于当前日期，请重新选择!",null,null,"确定")}})}},h=function(b,c,d,e){var f;if(null!=c&&void 0!=c&&"undefined"!==c){f=1==b.id?{CultureName:"en-US",BookingReferenceNo:c}:{BookingRefNo:c};var f={Parameters:f,ForeEndType:d,Code:b.detailCode};vlm.loadJson("",JSON.stringify(f),e)}else{var g=JSON.parse(localStorage.getItem("user_order_storage12345"));vlm.init();var h={data:g};l(a,h)}},i=function(){return{cardAddressPostalCode:$(".cardAddressPostalCode").val(),bankName:$(".bankName").val(),countryNumber:$(".phone ").attr("data-code"),cardAddressCity:$(".cardAddressCity").val(),cardHolderName:$(".cardHolderName").val(),cardExpiryDate:$(".cardExpiryDate").attr("data-expire"),cardNumber:$(".cardNumber").val(),MobilePhone:$(".MobilePhone").val(),cardType:d,cardSecurityCode:$(".cardSecurityCode").val(),cardCountryCode:$(".CardCountryCode ").attr("data-code"),cardAddressCountryCode:$(".CardIssuanceCountryCode").attr("data-code"),cardAddress:$(".cardAddress").val()}},j=function(){var a=i();return vlm.Utils.validate.isNoEmpty(a.cardHolderName)?vlm.Utils.validate.isNoEmpty(a.countryNumber)?vlm.Utils.validate.isNoEmpty(a.cardSecurityCode)?vlm.Utils.validate.isNoEmpty(a.cardExpiryDate)?vlm.Utils.validate.bankAccountNo(a.cardNumber)?vlm.Utils.validate.safecode(a.cardSecurityCode)?vlm.Utils.validate.isNoEmpty(a.cardAddressCity)?vlm.Utils.validate.isNoEmpty(a.cardAddress)?vlm.Utils.validate.isNoEmpty(a.cardAddressPostalCode)?vlm.Utils.validate.isNoEmpty(a.bankName)?vlm.Utils.validate.isNoEmpty(a.MobilePhone)?!0:(jAlert("手机号不能为空！","",null,"确认"),!1):(jAlert("发卡银行不能为空！","",null,"确认"),!1):(jAlert("邮政编码不能为空！","",null,"确认"),!1):(jAlert("账单地址不能不空！","",null,"确认"),!1):(jAlert("账单城市不能不空！","",null,"确认"),!1):(jAlert("安全码3位数字！","",null,"确认"),!1):(jAlert("信用卡卡号错误！","",null,"确认"),!1):(jAlert("有效期不能为空！","",null,"确认"),!1):(jAlert("安全码不能为空！","",null,"确认"),!1):(jAlert("信用卡不能为空！","",null,"确认"),!1):(jAlert("持卡人姓名不能为空！","",null,"确认"),!1)},k=function(){var f;if(1==a.id){var g=i(),h=[];if(null==b||void 0==b){if("CreditCard"==c){var k=j();if(!k)return}for(var l=JSON.parse(localStorage.getItem("user_order_storage12345")),m=0;m<=l.guestName.length-1;m++){var n={};n.guestFirstName=l.guestName[m].GuestFirstName,n.guestLastName=l.guestName[m].GuestLastName,h.push(n)}var o;Parameters={availability:!0,bankName:g.bankName,browserType:"",cardBillingAddress:"werty",cardHolderName:g.cardHolderName,creditCardExpiryDate:g.cardExpiryDate,cardIssuanceCountry:g.cardCountryCode,cardSecurityCode:g.cardSecurityCode,creditCardNumber:g.cardNumber,cardBillingAddress:"werty",countryNumber:"86",MobilePhone:"13520591255",cardAddressCity:"北京",cardAddressPostalCode:"122132",cardCountryCode:"CN",creditCardType:e[d].id,cashVoucherDetails:"",checkInDate:l.dateInfo.CheckInDate+"T00:00:00",checkOutDate:l.dateInfo.CheckOutDate+"T00:00:00",cookieID:1,guestContactNo:l.GuestContactNo,guestEmail:l.GuestEmail,guestNameList:h,guestRequest:"",guestTitle:"Mr",hotelCode:l.HotelGenInfo.hotelCode,hotelName:l.HotelGenInfo.hotelName,iPAddress:"",memberId:localStorage.memberid,nationlityCode:"",numOfChild:0,numOfGuest:l.NumOfRoom,numOfRoom:l.NumOfRoom,residenceCode:"",roomCode:l.roomCode,roomName:l.roomName,roomTypeCode:l.RoomTypeCode,roomTypeName:l.RoomTypeName,sessionID:"",totalPrice:l.totalPriceCNY*parseInt(l.NumOfRoom),trck:""},o={Code:a.payMentCode,Parameters:Parameters,ForeEndType:3}}else Parameters={bankName:g.bankName,bookingReferenceNo:b,cardBillingAddress:"",cardHolderName:g.cardHolderName,cardIssuanceCountry:g.cardIssuanceCountry,cardSecurityCode:g.cardSecurityCode,cashVoucherDetails:"",creditCardExpiryDate:g.cardExpiryDate,creditCardNumber:g.cardNumber,creditCardType:d,paymentGatewayID:"0",CardIssuanceCountry:$(".CardIssuanceCountryCode").attr("data-code")},o={Code:"0014",Parameters:Parameters,ForeEndType:3}}else{if("CreditCard"==c){var k=j();if(!k)return;f={cardInfo:i(),bookingRefNo:b,currencyCode:"CNY",totalPrice:$(".total_price").html(),paymentMode:c}}else f={bookingRefNo:b,currencyCode:"CNY",totalPrice:$(".total_price").html(),paymentMode:c};var o={Code:a.payMentCode,Parameters:f,ForeEndType:3}}vlm.loadJson("",JSON.stringify(o),function(b){b.success?1==a.id?(vlm.loading(),void 0==b.data[0]?location.href=b.data.paymentRedirectURL:location.href=b.data[0].paymentRedirectURL):location.href=b.data.paymentRedirectURL:jAlert(b.message)})},l=function(a,c){var d=template("pd_list",c);if($("#pd_list").html(d),5==a.id){var e=template("tpl_flighthotel_detail",c.data);$(".payment-type-list").append(e)}else if(1==a.id){null==b?(c.data.totalPrice=c.data.calcuTotalPriceCNY,c.data.hotelName=c.data.HotelGenInfo.hotelNameLocale,c.data.roomType=c.data.RoomTypeName,c.data.noOfRooms=c.data.NumOfRoom,c.data.checkInDate=c.data.dateInfo.CheckInDate,c.data.checkOutDate=c.data.dateInfo.CheckOutDate,c.data.totalNight=c.data.dateInfo.totalNight):(c.data[0].hotelName=c.data[0].hotelName,c.data[0].totalNight=1,c.data[0].totalPrice=parseInt(c.data[0].totalRoomRate));var e=template("tpl_hotel_detail",c.data);$(".payment-type-list").append(e)}else if(2==a.id){c.data.totalPrice=c.data.totalFlightPrice;var e=template("tpl_flight_detail",c.data);$(".payment-type-list").append(e)}else if(3==a.id){for(var f=0,h=0,i=0,j=0;j<c.data.chargeDetails.length;j++)"ADULT"==c.data.chargeDetails[j].category?(h+=parseInt(c.data.chargeDetails[j].quantity),f+=c.data.chargeDetails[j].totalAmount):"CHILD"==c.data.chargeDetails[j].category&&(i+=parseInt(c.data.chargeDetails[j].quantity),f+=c.data.chargeDetails[j].totalAmount);c.data.totalPrice=f,c.data.numofAdult=h,c.data.numofChild=i;var e=template("tpl_scenic_detail",c.data);$(".payment-type-list").append(e)}else if(4==a.id){for(var f=0,h=0,i=0,j=0;j<c.data.chargeDetails.length;j++)"ADULT"==c.data.chargeDetails[j].category?(h+=1,f+=c.data.chargeDetails[j].totalAmount):"CHILD"==c.data.chargeDetails[j].category&&(i+=1,f+=c.data.chargeDetails[j].totalAmount);c.data.totalPrice=f,c.data.numofAdult=h,c.data.numofChild=i;var e=template("tpl_tour_detail",c.data);$(".payment-type-list").append(e)}else if(6==a.id){for(var h=0,i=0,j=0;j<c.data.chargeDetails.length;j++)"ADULT"==c.data.chargeDetails[j].category?h+=parseInt(c.data.chargeDetails[j].quantity):"CHILD"==c.data.chargeDetails[j].category&&(i+=parseInt(c.data.chargeDetails[j].quantity));c.data.numofAdult=h,c.data.numofChild=i;var e=template("tpl_flighthoteltour_detail",c.data);$(".payment-type-list").append(e)}var k=$(e).find(".order-price i").html();$(".total_price").html(k),g.bindPaymentTypeEvent()},m=function(){a=f[vlm.getpara("type")],b=vlm.getpara("bookingRefNo"),g.expityDateInit(),h(a,b,3,function(b){vlm.init(),b.success?l(a,b):jAlert("网络请求错误！")})};return{InitPage:m()}})()}();