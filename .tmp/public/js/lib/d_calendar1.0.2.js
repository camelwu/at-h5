/*! asiatravel FE team at-h5-nodejs-----2016-05-19T15:21:43 */
function Calender(){arguments.length&&(this.initialize.apply(this,arguments),this.result=[])}_CalF={$:function(a,b){var c,d,e,f=[],g=a.substring(1);if(b=b||document,"string"==typeof a)switch(a.charAt(0)){case"#":return document.getElementById(g);case".":if(b.getElementsByClassName)return b.getElementsByClassName(g);for(c=_CalF.$("*",b),d=c.length,e=0;d>e;e++)c[e].className.indexOf(g)>-1&&f.push(c[e]);return f;default:return b.getElementsByTagName(a)}},bind:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},getPos:function(a){var b=document.documentElement.scrollLeft||document.body.scrollLeft,c=document.documentElement.scrollTop||document.body.scrollTop;return pos=a.getBoundingClientRect(),{top:pos.top+c,right:pos.right+b,bottom:pos.bottom+c,left:pos.left+b}},addClass:function(a,b){b.className=b.className+" "+a},removeClass:function(a,b){var c=new RegExp("(^|\\s+)"+a+"(\\s+|$)","g");b.className=b.className.replace(c,"")},stopPropagation:function(a){a=a||window.event,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}},Calender.prototype={constructor:Calender,_word:{hotel:["入住","离店"],flight:["去程","回程"]},_tempmonth:['<span class="prevmonth">prevmonth</span>','<span class="nextmonth">nextmonth</span>'],_tempweek:['<dl class="ca_week">','<dt class="date_title">日</dt>','<dt class="date_title">一</dt>','<dt class="date_title">二</dt>','<dt class="date_title">三</dt>','<dt class="date_title">四</dt>','<dt class="date_title">五</dt>','<dt class="date_title">六</dt>',"</dl>"],_template:["<dl>",'<dt class="title-date">',"</dt>","<dd></dd>","</dl>"],initialize:function(a){this.type=a.type||"hotel",this.format=a.format||"yyyy-mm-dd",this.id=a.id,this.num=a.num,this.sClass1=a.sClass1,this.id2=a.id2,this.fn=a.fn,this.time=a.time,this.op=0,this.input=_CalF.$("#"+this.id),this.inputEvent(),this.outClick()},createContainer:function(a){var b=_CalF.$("#"+this.id+"-date");b&&b.parentNode.removeChild(b);var c=this.container=document.createElement("div");if(c.id=this.id+"-date",c.style.position="absolute",c.style.zIndex=100,"input"===this.input.tagName){var d=_CalF.getPos(this.input);c.style.left=d.left+"px",c.style.top=d.bottom-1+"px",_CalF.bind(c,"click",this.stopPropagation)}else{c.style.background="#f5f4f9",c.style.overflow="auto",c.style.width=c.style.height="100%",c.style.left="0",c.style.top="0",c.style.paddingBottom="118px";var e=this.header=document.createElement("div");e.id=this.id+"-header",e.className="header",e.style.zIndex=101,e.innerHTML='<a href="javascript:void(0);" class="header-back"><i class="icons go-back"></i></a><h3>选择日期</h3>',document.body.appendChild(e);var f=document.createElement("div");f.className="calendar",f.style.marginTop="45px",f.innerHTML=this._tempweek.join(""),c.appendChild(f);var g=this.tiper=document.createElement("div");g.id=this.id+"-tiper",g.className="tipers",g.innerHTML="请选择入住日期",c.appendChild(g)}document.body.appendChild(c)},drawDate:function(a){var b,c,e,f,g,h,i,j,k,l,n=[],o=new Date,p=o.getFullYear(),q=o.getMonth(),r=o.getDate();for(this.dateWarp=b=document.createElement("div"),b.className="calendar",b.innerHTML=this._template.join(""),this.year=f=a.getFullYear(),this.month=g=a.getMonth()+1,this.date=h=a.getDate(),this.titleDate=c=_CalF.$(".title-date",b)[0],tims=this.time,l=document.createTextNode(f+"年"+g+"月"),c.appendChild(l),e=_CalF.$("dd",b)[0],i=new Date(f,g,0).getDate(),j=new Date(f,g-1,1).getDay(),k=0;j>k;k++)n.push("<a>&nbsp;</a>");for(k=1;i>=k;k++)p>f?n.push('<a class="disabled">'+k+"</a>"):f==p?q+1>g?n.push('<a class="live disabled">'+k+"</a>"):g==q+1?r>k?n.push('<a class="live disabled">'+k+"</a>"):(m=10>g?"0"+g:g,d=10>k?"0"+k:k,tims[f+"-"+m+"-"+d]?k==r?pstr='<a class="live" data-day="'+f+"-"+g+"-"+k+'"><span class="live_circle">今天</span><span class="live_txt"><span class="live_txt">'+tims[f+"-"+m+"-"+d]+"</span></a>":pstr='<a class="live" data-day="'+f+"-"+g+"-"+k+'"><span class="live_circle">'+k+'</span><span class="live_txt">'+tims[f+"-"+m+"-"+d]+"</span></a>":k==r?pstr='<a class="live" data-day="'+f+"-"+g+"-"+k+'">今天</a>':pstr='<a class="live" data-day="'+f+"-"+g+"-"+k+'">'+k+"</a>",n.push(pstr)):g==q+2?(m=10>g?"0"+g:g,d=10>k?"0"+k:k,tims[f+"-"+m+"-"+d]?pstr='<a class="live" data-day="'+f+"-"+g+"-"+k+'"><span class="live_circle">'+k+'</span><span class="live_txt">'+tims[f+"-"+m+"-"+d]+"</span></a>":pstr='<a class="live" data-day="'+f+"-"+g+"-"+k+'">'+k+"</a>",n.push(pstr)):n.push('<a class="live" data-day="'+f+"-"+g+"-"+k+'">'+k+"</a>"):f>p&&n.push('<a class="live" data-day="'+f+"-"+g+"-"+k+'">'+k+"</a>");e.innerHTML=n.join(""),this.container.appendChild(b);var s=!!window.ActiveXObject&&!window.XMLHttpRequest;s&&b.appendChild(this.createIframe()),this.linkOn()},drawLastDate:function(a){var b,c,d,e,f,g,h,i,j,k,l=[],m=new Date,n=(m.getFullYear(),m.getMonth(),m.getDate());for(this.dateWarp=b=document.createElement("div"),b.className="calendar",b.innerHTML=this._template.join(""),this.year=e=a.getFullYear(),this.month=f=a.getMonth()+1,this.date=g=a.getDate(),this.titleDate=c=_CalF.$(".title-date",b)[0],tims=this.time,k=document.createTextNode(e+"年"+f+"月"),c.appendChild(k),d=_CalF.$("dd",b)[0],h=new Date(e,f,0).getDate(),i=new Date(e,f-1,1).getDay(),j=0;i>j;j++)l.push("<a>&nbsp;</a>");for(j=1;h>=j;j++)n>=j?l.push('<a class="live" data-day="'+e+"-"+f+"-"+j+'">'+j+"</a>"):l.push('<a class="disabled">'+j+"</a>");d.innerHTML=l.join(""),this.container.appendChild(b);var o=!!window.ActiveXObject&&!window.XMLHttpRequest;o&&b.appendChild(this.createIframe()),this.linkOn()},createIframe:function(){var a=document.createElement("iframe");return a.src="about:blank",a.style.position="absolute",a.style.zIndex="-1",a.style.left="-1px",a.style.top=0,a.style.border=0,a.style.filter="alpha(opacity= 0 )",a.style.width=this.container.offsetWidth+"px",a.style.height=this.container.offsetHeight+"px",a},removeDate:function(){var a=_CalF.$("#"+this.id+"-header");a&&a.parentNode.removeChild(a);var b=_CalF.$("#"+this.id+"-date");b&&b.parentNode.removeChild(b)},btnEvent:function(){var a=this,b=_CalF.$(".prevmonth",this.dateWarp)[0],c=_CalF.$(".nextmonth",this.dateWarp)[0];b.onclick=function(){var b=new Date(a.year,a.month-2,a.date);a.drawDate(b)},c.onclick=function(){var b=new Date(a.year,a.month,a.date);a.drawDate(b)}},linkOn:function(){var a,b=_CalF.$(".live",this.dd),c=b.length,d=this;for(a=0;c>a;a++)b[a].index=a,b[a].onclick=function(){"input"===d.input.tagName?($(this).css("border","1px solid #ff6a2f").css("z-index","9999999"),$(this).siblings().css("border","").css("z-index","")):this.className.indexOf("disabled")>-1||(0==d.op?(d.tiper.innerHTML="请选择"+d._word[d.type][1]+"日期",d.linkReset(this.index),$(this).html('<span class="live_circle">'+this.innerHTML+'</span><span class="live_txt">'+d._word[d.type][d.op]+"</span>"),$(this).addClass("disabled"),d.op++):($(this).html('<span class="live_circle">'+this.innerHTML+'</span><span class="live_txt">'+d._word[d.type][d.op]+"</span>"),d.op>=1?d.op=0:null,d.linkOver()))}},linkOver:function(){for(var a,b=$("#"+this.id+"-date .live_circle"),c=(b.length,this),d=[],e={},f=_CalF.$("input",c.input),g=b[0].parentNode.getAttribute("data-day").split("-"),h=b[1].parentNode.getAttribute("data-day").split("-"),a=0;a<g.length;a++)g[a]=g[a]<10?"0"+g[a]:g[a];for(var a=0;a<h.length;a++)h[a]=h[a]<10?"0"+h[a]:h[a];g=g.join("-"),h=h.join("-"),f.length||(f=_CalF.$("."+this.sClass1,c.input));var i=_CalF.$("#"+this.id2,c.input);if("INPUT"==f[0].tagName)for(a=0;2>a;a++)d.push(b[a].parentNode.getAttribute("data-day")),f[a].value=b[a].parentNode.getAttribute("data-day");else d.push(g),d.push(h),f[0].innerHTML=g,f[1].innerHTML=h;var j=d[0].split("-")[0],k=d[0].split("-")[1]-1,l=d[0].split("-")[2],m=d[1].split("-")[0],n=d[1].split("-")[1]-1,o=d[1].split("-")[2];i&&(i.innerHTML=Math.round((new Date(m,n,o)-new Date(j,k,l))/864e5)),e[d[0]]=this._word[c.type][0],e[d[1]]=this._word[c.type][1],this.time=e,c.removeDate(),"function"==typeof c.fn&&c.fn()},linkReset:function(a){var b=this,c=$(".live_circle"),d=c.length,e=_CalF.$(".live",this.dd),f=e.length;if(0==b.op){for(var g=0;d>g;g++){var h=c[g].parentNode.getAttribute("data-day"),i=h.split("-");c[g].parentNode.innerHTML=i[i.length-1]}for(g=0;a>g;g++)_CalF.addClass("disabled",e[g]);for(g=a+30;f>g;g++)_CalF.addClass("disabled",e[g]);return!1}},inputEvent:function(){var a=this,b=new Date,c=b.getFullYear(),d=b.getMonth();b.getDate();_CalF.bind(this.input,"click",function(){a.createContainer();for(var b=0;b<a.num;b++)if(b==a.num-1){var e=new Date(c,d+b,1);a.drawLastDate(e)}else{var e=new Date(c,d+b,1);a.drawDate(e)}})},outClick:function(){var a=this;_CalF.bind(document,"click",function(b){b=b||window.event;var c=b.target||b.srcElement;(c.className.indexOf("header-back")>-1||c.className.indexOf("go-back")>-1)&&a.removeDate()})}};