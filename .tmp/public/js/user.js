/*! asiatravel FE team at-h5-nodejs-----2016-05-19T15:21:43 */
require.config({baseUrl:"../js/lib",paths:{jquery:"jquery",vlm:"vlm",plugins:"plugins",Scroller:"scroller"},$:["jquery"],shim:{plugins:{deps:["jquery"],init:function(){return{WOW:WOW,FastClick:FastClick,owlCarousel:owlCarousel,countdown:countdown,swipebox:swipebox,ScrollIt:ScrollIt,Snap:Snap}}},scroller:{deps:["jquery","plugins"],exports:"Scroller"}}}),require(["jquery","vlm","scroller"],function(a,b,c){function d(b){l=b;var c=a("#blank")[0];if(l.success)if(0==l.data.length)c.style.display="block";else{c.style.display="none";var d=a("#content")[0],f=document.createElement("ul");f.className="often-traveler",f.style.borderTop="1px solid #dedede",f.style.marginTop="10px";for(var g=0;g<l.data.length;g++){var h=l.data[g].listTravellerIdInfo.length;if(0==h)m[g]="",n[g]="",a("#country-name").html("");else{m[g]=l.data[g].listTravellerIdInfo[0].travellerId,n[g]=l.data[g].listTravellerIdInfo[0].id;var i=getCountryName(l.data[g].listTravellerIdInfo[0].idCountry);void 0==i?a("#country-name").html():a("#country-name").html(i.CountryName)}var j=document.createElement("li");j.className="eve-traveler",j.setAttribute("idtype",m[g]);var k=document.createElement("b");k.className="user-edits",k.style.marginTop=j.clientHeight+20+"px",j.appendChild(k);var o=document.createElement("ul");o.className="often_user";var p=document.createElement("li");p.innerHTML=l.data[g].traveller.idName+l.data[g].traveller.lastName+"/"+l.data[g].traveller.firstName,o.appendChild(p),k.parentNode.addEventListener("click",e);var q=document.createElement("li");0!=l.data[g].listTravellerIdInfo.length&&("1"==l.data[g].listTravellerIdInfo[0].idType?q.innerHTML="护照 "+l.data[g].listTravellerIdInfo[0].idNumber:"2"==l.data[g].listTravellerIdInfo[0].idType?q.innerHTML="身份证 "+l.data[g].listTravellerIdInfo[0].idNumber:"3"==l.data[g].listTravellerIdInfo[0].idType?q.innerHTML="出生证明 "+l.data[g].listTravellerIdInfo[0].idNumber:"4"==l.data[g].listTravellerIdInfo[0].idType?q.innerHTML="港澳通行证 "+l.data[g].listTravellerIdInfo[0].idNumber:"5"==l.data[g].listTravellerIdInfo[0].idType?q.innerHTML="军官证 "+l.data[g].listTravellerIdInfo[0].idNumber:"6"==l.data[g].listTravellerIdInfo[0].idType?q.innerHTML="驾驶证 "+l.data[g].listTravellerIdInfo[0].idNumber:"7"==l.data[g].listTravellerIdInfo[0].idType?q.innerHTML="台胞证 "+l.data[g].listTravellerIdInfo[0].idNumber:"9"==l.data[g].listTravellerIdInfo[0].idType?q.innerHTML="回乡证 "+l.data[g].listTravellerIdInfo[0].idNumber:q.innerHTML="其他 "+l.data[g].listTravellerIdInfo[0].idNumber),o.appendChild(q);var r=document.createElement("li");r.innerHTML="手机号 "+l.data[g].traveller.mobilePhone,o.appendChild(r),j.appendChild(o),j.setAttribute("index",g),f.appendChild(j)}d.appendChild(f)}else alert(l.message)}function e(b){function c(a){var b=a.split("-");return b=0==b[1].charAt(0)&&0==b[2].charAt(0)?b[0]+"年-"+b[1].charAt(1)+"月-"+b[2].charAt(1)+"日":0==b[1].charAt(0)&&0!=b[2].charAt(0)?b[0]+"年-"+b[1].charAt(1)+"月-"+b[2]+"日":0!=b[1].charAt(0)&&0==b[2].charAt(0)?b[0]+"年-"+b[1]+"月-"+b[2].charAt(1)+"日":b[0]+"年-"+b[1]+"月-"+b[2]+"日"}function d(b){1==b&&(a("#content-wrap").css("visibility","visible"),e.style.display="none")}k="often_user"==a(b.target).parent().attr("class")||"user-edits"==a(b.target).attr("class")?a(b.target).parents(".eve-traveler").attr("index"):a(b.target).attr("index");var e=a("#uptra_page")[0];e.style.display="block";var f,g,h,i,j,m,n,p,q,r,s,t,u=document.getElementById("updateForm").getElementsByTagName("input"),v=a("#cardType")[0],w=a("#countryName")[0],x=a("#man2")[0],y=a("#woman2")[0];f=u[0].value=l.data[k].traveller.idName,g=u[1].value=l.data[k].traveller.lastName,h=u[2].value=l.data[k].traveller.firstName;var z=getTelCode(l.data[k].traveller.countryCode);if(void 0==z?a("#uptra_page .phone-pre").html("+86"):a("#uptra_page .phone-pre").html("+"+z.TelCode),a("#uptra_page .country-btn").eq(0).attr("data-code",l.data[k].listTravellerIdInfo[0].idCountry),0!=l.data[k].listTravellerIdInfo.length){i=u[3].value=l.data[k].listTravellerIdInfo[0].idNumber,n=a("#time-cont-edit")[0].innerHTML=l.data[k].listTravellerIdInfo[0].idActivatedDate.substring(0,10);var A=l.data[k].listTravellerIdInfo[0].idActivatedDate.substring(0,10);a("#time-cont-edit")[0].setAttribute("data-cache",c(A)),q="1"==l.data[k].listTravellerIdInfo[0].idType?v.innerHTML="护照":"2"==l.data[k].listTravellerIdInfo[0].idType?v.innerHTML="身份证":"3"==l.data[k].listTravellerIdInfo[0].idType?v.innerHTML="出生证明":"4"==l.data[k].listTravellerIdInfo[0].idType?v.innerHTML="港澳通行证":"5"==l.data[k].listTravellerIdInfo[0].idType?v.innerHTML="军官证":"6"==l.data[k].listTravellerIdInfo[0].idType?v.innerHTML="驾驶证":"7"==l.data[k].listTravellerIdInfo[0].idType?v.innerHTML="台胞证":"9"==l.data[k].listTravellerIdInfo[0].idType?v.innerHTML="回乡证":v.innerHTML="其他"}p=a("#birth-cont-edit")[0].innerHTML=l.data[k].traveller.dateOfBirth.substring(0,10);var B=l.data[k].traveller.dateOfBirth.substring(0,10);a("#birth-cont-edit")[0].setAttribute("data-cache",c(B)),j=u[4].value=l.data[k].traveller.mobilePhone,m=u[5].value=l.data[k].traveller.email,t=l.data[k].traveller.sexCode,r=w.innerHTML=l.data[k].traveller.countryName;var C=l.data[k].listTravellerIdInfo[0].idCountry;s=getCountryName(C).CountryName,a("#country-name").html(s),"Mr"==l.data[k].traveller.sexCode?(x.className="icon-h traveler-sex1",y.className="icon-h traveler-sex2"):(x.className="icon-h traveler-sex2",y.className="icon-h traveler-sex1"),o.onclick=function(){for(var b=[f,g,h,i,j,m],c=0;c<u.length;c++)if(b[c]!=u[c].value)return void jConfirm("当前编辑的内容未保存，确定退出编辑?","",d);return p!=a("#birth-cont-edit")[0].innerHTML||n!=a("#time-cont-edit")[0].innerHTML||q!=a("#cardType").html()||s!=a("#country-name").html()||r!=a("#countryName").html()?void jConfirm("当前编辑的内容未保存，确定退出编辑?","",d):"Mr"==t&&"icon-h traveler-sex1"==a("#woman2").attr("class")||"Mrs"==t&&"icon-h traveler-sex2"==a("#woman2").attr("class")?void jConfirm("当前编辑的内容未保存，确定退出编辑?","",d):void(e.style.display="none")}}function f(a){var b=a;b.success?document.getElementById("addForm").submit():alert(b.message)}function g(a){var b=a;b.success?window.location.href="user-oftenInfo.html":alert(b.message)}function h(a){var b=a;b.success?document.getElementById("updateForm").submit():alert(b.message)}function i(){function b(){if(void 0!=l)for(var a=l.data[k].listTravellerIdInfo,b=0;b<a.length;b++)if(1==a[b].idType)return a[b].idNumber}function b(){if(void 0!=l)for(var a=l.data[k].listTravellerIdInfo,b=0;b<a.length;b++)if(2==a[b].idType)return a[b].idNumber}if("护照"==a(".date-selected").html()){var c=b();a(".postNum").val(c)}else if("身份证"==a(".date-selected").html()){var c=b();a(".postNum").val(c)}}b.init();var k,l,m=[],n=[],o=a("#update_quit")[0];a(function(){function c(c){function d(b){if(1==b){for(var c=0;c<e.length;c++)e[c].value="";a("#time-cont").html(""),a("#birth-cont").html("1990-01-01"),a(".country-btn").html("中国"),a(".country-btn").attr("data-code","CN"),a(".country-btn").attr("data-tel-code","86"),a("#man").attr("class","icon-h traveler-sex1"),a("#woman").attr("class","icon-h traveler-sex2"),q.style.display="none"}}c.onclick=function(){var c,d=document.getElementById("addForm").getElementsByTagName("input"),e=document.getElementById("postCard").innerHTML,g=d[0].value;if(!b.Utils.validate.chiName(g))return void jAlert("请输入正确的中文名");var h=d[1].value;if(!b.Utils.validate.engName(h))return void jAlert("请输入正确的英文姓");var i=d[2].value;if(!b.Utils.validate.engName(i))return void jAlert("请输入正确的英文名");if(""==d[1].value||""==d[2].value)return void jAlert("英文姓名为必填信息");if(c="护照"==e?"1":"身份证"==e?"2":"出生证明"==e?"3":"港澳通行证"==e?"4":"军官证"==e?"5":"驾驶证"==e?"6":"台胞证"==e?"7":"回乡证"==e?"9":"10",""==d[3].value)return void jAlert("请输入证件号");var j,k,l=a("#man")[0];"icon-h traveler-sex1"==l.className?(j="Mr",k="男"):(j="Mrs",k="女"),a("#mobile-cell-add")[0].value=a("#mobile-cell-add")[0].value.replace(/^\s*/,"");var m=a("#mobile-cell-add")[0].value;a("#email-cell-add")[0].value=a("#email-cell-add")[0].value.replace(/^\s*/,"");var n=a("#email-cell-add")[0].value;if(!b.Utils.validate.mobileNo(m))return void jAlert("请输入正确的手机号");if(!b.Utils.validate.email(n))return void jAlert("请输入正确的邮箱");var p={Parameters:'{"Traveller":{"IdName":"'+d[0].value+'","LastName":"'+d[1].value+'","FirstName":"'+d[2].value+'","CountryCode":"'+a("#addtra_page .country-btn").eq(1).attr("data-code")+'","CountryName":"'+a("#addtra_page .country-btn").eq(1).html()+'","SexCode":"'+j+'","SexName":"'+k+'","DateOfBirth":"'+a("#birth-cont").html()+'","Email":"'+d[5].value+'","MemberId":"'+o+'","MobilePhone":"'+d[4].value+'"},"ListTravellerIdInfo":[{"IdType":'+c+',"IdNumber":"'+d[3].value+'","IdCountry":"'+a("#addtra_page .country-btn").eq(0).attr("data-code")+'","IdActivatedDate":"'+a("#time-cont").html()+'"}]}',ForeEndType:3,Code:"0071"};b.loadJson("",JSON.stringify(p),f)};var e=document.getElementById("addForm").getElementsByTagName("input");r.onclick=function(){for(var b=0;4>b;b++)if(""!=e[b].value)return void jConfirm("当前编辑的内容未保存，确定退出编辑?","",d);return"护照"!=a("#postCard").html()||""!=a("#time-cont").html()||"1990-01-01"!=a("#birth-cont").html()||"中国"!=a(".country-btn").eq(0).html()||"中国"!=a(".country-btn").eq(1).html()||""!=e[4].value||""!=e[5].value||"icon-h traveler-sex1"==a("#woman").attr("class")?void jConfirm("当前编辑的内容未保存，确定退出编辑?","",d):void(q.style.display="none")}}function e(c){c.onclick=function(){a("#preloader").remove();var c,d=m[k],e=n[k],f=document.getElementById("updateForm").getElementsByTagName("input"),g=document.getElementById("cardType").innerHTML,i=(document.getElementById("countryName").innerHTML,f[0].value);if(!b.Utils.validate.chiName(i))return void jAlert("请输入正确的中文名");var j=f[1].value;if(!b.Utils.validate.engName(j))return void jAlert("请输入正确的英文姓");var l=f[2].value;if(!b.Utils.validate.engName(l))return void jAlert("请输入正确的英文名");if(""==f[1].value||""==f[2].value)return void jAlert("英文姓名为必填信息");if(""==f[3].value)return void jAlert("请输入证件号");var p,q,r=a("#man2")[0];"icon-h traveler-sex1"==r.className?(p="Mr",q="男"):(p="Mrs",q="女"),c="护照"==g?"1":"身份证"==g?"2":"出生证明"==g?"3":"港澳通行证"==g?"4":"军官证"==g?"5":"驾驶证"==g?"6":"台胞证"==g?"7":"回乡证"==g?"9":"10",a("#mobile-cell")[0].value=a("#mobile-cell")[0].value.replace(/^\s*/,"");var s=a("#mobile-cell")[0].value;a("#email-cell")[0].value=a("#email-cell")[0].value.replace(/^\s*/,"");var t=a("#email-cell")[0].value;if(!b.Utils.validate.mobileNo(s))return void jAlert("请输入正确的手机号");if(!b.Utils.validate.email(t))return void jAlert("请输入正确的邮箱");var u={Parameters:'{"Traveller":{"TravellerId":'+d+',"IdName":"'+f[0].value+'","LastName":"'+f[1].value+'","FirstName":"'+f[2].value+'","CountryCode":"'+a("#uptra_page .country-btn").eq(1).attr("data-code")+'","CountryName":"'+a("#uptra_page .country-btn").eq(1).html()+'","SexCode":"'+p+'","SexName":"'+q+'","DateOfBirth":"'+a("#birth-cont-edit").html()+'","Email":"'+f[5].value+'","MemberId":"'+o+'","MobilePhone":"'+f[4].value+'"},"ListTravellerIdInfo":[{"Id":'+e+',"TravellerId":'+d+',"IdType":'+c+',"IdNumber":"'+f[3].value+'","IdCountry":"'+a("#uptra_page .country-btn").eq(0).attr("data-code")+'","IdActivatedDate":"'+a("#time-cont-edit").html()+'"}]}',ForeEndType:3,Code:"0072"};b.loadJson("",JSON.stringify(u),h)}}function i(a){a.onclick=function(){function a(a){if(1==a){var d={Parameters:'{"travellerId":'+c+"}",ForeEndType:3,Code:"0073"};b.loadJson("",JSON.stringify(d),g)}}var c=m[k];jConfirm("确认删除该旅客?","",a)}}var j=location.href;if(-1!=j.indexOf("user-oftenInfo")){var l=a("#menu")[0];l.style.display="none";var o=localStorage.memberid,p={Parameters:'{"memberId":'+o+"}",ForeEndType:3,Code:"0074"};b.loadJson("",JSON.stringify(p),d);var q=a("#addtra_page")[0],r=(a("#addUser")[0],a("#add_quit")[0]);a("#uptra_page")[0],a("#fillName_page")[0];a("#addUser").click(function(){return a(".eve-traveler").length>=50?void jAlert("超过常旅客人数上限，请删除一些再添加吧!"):void a("#addtra_page").show()});var s=a("#add_finish")[0];c(s);var t=a("#upadate_finish")[0];e(t);var u=a("#delTra")[0];i(u)}});for(var p=document.querySelectorAll(".sex-cho-wrap"),q=0;q<p.length;q++)!function(a){var b=p[a].querySelectorAll("b");for(j=0;j<b.length;j++)b[j].onclick=function(){for(q=0;q<b.length;q++)b[q].className="icon-h traveler-sex2";this.className="icon-h traveler-sex1"}}(q);new c({id:"birth-cont",type:"birth",cont:"uuun1"}),new c({id:"time-cont",type:"validity",cont:"uuun2"}),new c({id:"postCard",type:"card",cont:"uuu",callback:i}),new c({id:"birth-cont-edit",type:"birth",cont:"eee1"}),new c({id:"time-cont-edit",type:"validity",cont:"eee2"}),new c({id:"cardType",type:"card",cont:"eee3",callback:i}),new c({id:"birth-cont-per",type:"birth",cont:"ppp"});a("#aname_state").click(function(){a("#content-wrap").css("visibility","hidden"),a("#addtra_page").css("visibility","hidden"),a("#fillName_page").show()}),a("#close_name").click(function(){a("#content-wrap").css("visibility","visible"),a("#addtra_page").css("visibility","visible"),a("#fillName_page").hide()}),a("#name_state").click(function(){a("#content-wrap").css("visibility","hidden"),a("#uptra_page").css("visibility","hidden"),a("#fillName_page").show()}),a("#close_name").click(function(){a("#content-wrap").css("visibility","visible"),a("#uptra_page").css("visibility","visible"),a("#fillName_page").hide()})});